(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6c3607bb"],{"0472":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.visible?n("div",{staticClass:"drawer"},[n("transition",{attrs:{name:"mask"}},[e.show?n("div",{staticClass:"mask",on:{click:function(t){return t.stopPropagation(),e.closeDrawer(t)}}}):e._e()]),e._v(" "),n("transition",{attrs:{name:"fade"}},[e.show?n("div",{staticClass:"box"},[e._t("default")],2):e._e()])],1):e._e()},i=[],o={name:"Drawer",props:{visible:{type:Boolean,default:!1}},data:function(){return{show:!1}},watch:{visible:function(e){var t=this;setTimeout((function(){t.show=e}),30)}},methods:{closeDrawer:function(){var e=this;this.show=!1,setTimeout((function(){e.$emit("update:visible",!1)}),300)}}},s=o,r=(n("68ae"),n("2877")),l=Object(r["a"])(s,a,i,!1,null,"0dd3e6a0",null);t["a"]=l.exports},"08c7":function(e,t,n){},"0a0a":function(e,t,n){"use strict";n("65e6")},"0dae":function(e,t,n){"use strict";n("793c")},1451:function(e,t,n){},"156b":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"editor",class:{fullscreen:e.isFullscreen}},[e.isFullscreen?n("div",{staticClass:"group-button"},[n("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.fullScreen(!0)}}},[e._v("退出全屏")]),e._v(" "),n("el-button",{attrs:{size:"mini"},on:{click:e.setWordWrap}},[e._v("自动换行："+e._s(e.wordWrap?"on":"off"))]),e._v(" "),n("p",[e._v('（点击 "退出全屏" 或者使用 ESC 可以取消全屏）')])],1):e._e(),e._v(" "),n("monaco",{ref:"monaco",staticClass:"monaco",attrs:{language:e.language,code:e.code,custom:e.custom,options:e.options},on:{mounted:e.onMounted,codeChange:e.onCodeChange}})],1)},i=[],o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"test",style:e.style})},s=[],r=(n("ac6a"),n("6b54"),n("c5f6"),n("f7fe")),l=n.n(r),c=n("a2a8"),d=n.n(c),u={props:{width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:"100%"},code:{type:String,default:"// code \n"},srcPath:{type:String,default:""},language:{type:String,default:"javascript"},theme:{type:String,default:"vs"},options:{type:Object,default:function(){}},highlighted:{type:Array,default:function(){return[{number:0,class:""}]}},changeThrottle:{type:Number,default:0},custom:{type:Boolean,default:!1}},data:function(){return{defaults:{selectOnLineNumbers:!0,roundedSelection:!1,readOnly:!1,cursorStyle:"line",automaticLayout:!1,glyphMargin:!0,minimap:{enabled:!1},wordWrap:"off"}}},computed:{style:function(){var e=this.width,t=this.height,n=-1!==e.toString().indexOf("%")?e:"".concat(e,"px"),a=-1!==t.toString().indexOf("%")?t:"".concat(t,"px");return{width:n,height:a}},editorOptions:function(){return Object.assign({},this.defaults,this.options,{value:this.code,language:this.language,theme:this.theme})}},watch:{highlighted:{handler:function(e){this.highlightLines(e)},deep:!0}},mounted:function(){this.fetchEditor()},destroyed:function(){this.destroyMonaco()},methods:{highlightLines:function(e){var t=this;this.editor&&e.forEach((function(e){var n=e.class,a=t.$el.querySelector(".".concat(n));a&&a.classList.remove(n);var i=parseInt(e.number);if(!(!t.editor&&i<1||isNaN(i))){var o=t.$el.querySelector('.view-lines [linenumber="'.concat(i,'"]'));o&&o.classList.add(n)}}))},editorHasLoaded:function(e,t){var n=this;this.editor=e,this.monaco=t,this.editor.onDidChangeModelContent((function(t){return n.codeChangeHandler(e,t)})),this.$emit("mounted",e)},codeChangeHandler:function(e){this.codeChangeEmitter||(this.codeChangeEmitter=l()((function(e){this.$emit("codeChange",e)}),this.changeThrottle)),this.codeChangeEmitter(e)},fetchEditor:function(){d.a.load(this.srcPath,this.createMonaco)},createMonaco:function(){this.editor=window.monaco.editor.create(this.$el,this.editorOptions),this.editorHasLoaded(this.editor,window.monaco)},destroyMonaco:function(){"undefined"!==typeof this.editor&&this.editor.dispose()},getCustom:function(e){e.languages.register({id:"mySpecialLanguage"}),e.languages.setMonarchTokensProvider("mySpecialLanguage",{tokenizer:{root:[[/START RequestId:|Event RequestId:|END RequestId:|Report RequestId:/,"custom-notice"],[/2020-12-01T12:51:13.926Z/,"custom-date"],[/\[info.*/,"custom-error"],[/Duration:158ms Memory:256MB MemUsage:39.230469MB/,"custom-error"]]}}),e.editor.defineTheme("myCoolTheme",{base:"vs",inherit:!1,rules:[{token:"custom-info",foreground:"808080"},{token:"custom-error",foreground:"ff5a5f",fontStyle:"bold"},{token:"custom-notice",foreground:"FFA500"},{token:"custom-date",foreground:"008800"}]}),e.languages.registerCompletionItemProvider("mySpecialLanguage",{provideCompletionItems:function(){var t=[{label:"simpleText",kind:e.languages.CompletionItemKind.Text,insertText:"simpleText"},{label:"testing",kind:e.languages.CompletionItemKind.Keyword,insertText:"testing(${1:condition})",insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet},{label:"ifelse",kind:e.languages.CompletionItemKind.Snippet,insertText:["if (${1:condition}) {","\t$0","} else {","\t","}"].join("\n"),insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"If-Else Statement"}];return{suggestions:t}}}),this.editor=e.editor.create(this.$el,{theme:"myCoolTheme",value:this.getCode(),language:"mySpecialLanguage",selectOnLineNumbers:!1,roundedSelection:!0,readOnly:!1,automaticLayout:!0,lineNumbers:!1,glyphMargin:!1,showFoldingControls:"always",formatOnPaste:!1,formatOnType:!1,folding:!1})},getCode:function(){return"START RequestId: e5041498-33d3-11eb-a9c8-525400be5245\nEvent RequestId: e5041498-33d3-11eb-a9c8-525400be5245\n2020-12-01T12:51:13.926Z\te5041498-33d3-11eb-a9c8-525400be5245\tbefore 这是一个测试日志\n2020-12-01T12:51:13.926Z\te5041498-33d3-11eb-a9c8-525400be5245\t这是字符串错误日志\n2020-12-01T12:51:13.926Z\te5041498-33d3-11eb-a9c8-525400be5245\t{ a: 11111, b: '11111' }\n2020-12-01T12:51:13.926Z\te5041498-33d3-11eb-a9c8-525400be5245\tafter 这是一个测试日志\n \nEND RequestId: e5041498-33d3-11eb-a9c8-525400be5245\nReport RequestId: e5041498-33d3-11eb-a9c8-525400be5245 Duration:158ms Memory:256MB MemUsage:39.230469MB"}}},h=u,p=n("2877"),f=Object(p["a"])(h,o,s,!1,null,null,null),m=f.exports,v=5e3,b={name:"Editor",components:{monaco:m},props:{value:{type:[String,Object],default:function(){return""}},readOnly:{type:Boolean,default:!1},mode:{type:String,default:""},cacheId:{type:String,default:""},language:{type:String,default:"json"},custom:{type:Boolean,default:!1}},data:function(){return{isFullscreen:!1,code:"",wordWrap:!1,options:{selectOnLineNumbers:!0,roundedSelection:!1,automaticLayout:!0,lineNumbers:!0,glyphMargin:!0,showFoldingControls:"always",formatOnPaste:!0,formatOnType:!0,folding:!0}}},watch:{value:function(e){this.setValue(e,!1)},readOnly:function(e){},cacheId:function(e){this._lastCacheTimestamp[e]=Date.now()}},created:function(){this.options.readOnly=this.readOnly},mounted:function(){},methods:{onMounted:function(e){this.editor=e,this.setValue(this.value,!1),this.editor.updateOptions(this.options),this._lastCacheTimestamp={},this.cacheId&&(this._lastCacheTimestamp[this.cacheId]=Date.now())},onCodeChange:function(e){this.cacheId&&this.cacheId.length>0&&this.cacheData(e.getValue())},getStringValue:function(){return this.editor.getValue()},getValue:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.mode&&"application/json"!==this.mode)return this.editor.getValue();var t=this.editor.getValue();return e||(t=JSON.stringify(t)),t},setValue:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];"string"===typeof e&&(e=JSON.parse(e)),t||"string"!==typeof e&&(e=JSON.stringify(e,"",4)),this.code=t?JSON.stringify(e,null,2):e,this.editor&&this.editor.setValue(this.code)},refresh:function(){},format:function(){this.editor.setValue(JSON.stringify(JSON.parse(this.getValue()),null,2))},fullScreen:function(e){e?this.minEditor():this.maxEditor()},maxEditor:function(){this.isFullscreen=!0;var e=this.$refs.monaco.$el;this.originSize={width:e.clientWidth,height:e.clientHeight},this.editor.layout({height:document.body.clientHeight,width:document.body.clientWidth})},minEditor:function(){this.isFullscreen=!1,this.editor.layout({height:this.originSize.height,width:this.originSize.width})},setWordWrap:function(){this.wordWrap=!this.wordWrap,this.editor.updateOptions({wordWrap:this.wordWrap?"on":"off"}),this.$emit("wordWrap",this.wordWrap)},hasCache:function(){var e=this.getCache();return e&&e.data.length>0},getCache:function(){if(!navigator.cookieEnabled||!window.localStorage)return null;var e=localStorage.getItem(this.cacheId);return e?JSON.parse(e):null},cacheData:function(e){if(!navigator.cookieEnabled||!window.localStorage)return null;this.canCache()&&(localStorage.setItem(this.cacheId,JSON.stringify({data:e,time:Date.now()})),this._lastCacheTimestamp[this.cacheId]=Date.now())},restoreCache:function(){if(this.cacheId){var e=this.getCache();this.setValue(e.data,"application/json"===this.mode)}},clearCache:function(){localStorage.removeItem(this.cacheId)},canCache:function(){return Math.abs(Date.now()-this._lastCacheTimestamp[this.cacheId])>v}}},g=b,_=(n("7cba"),Object(p["a"])(g,a,i,!1,null,null,null));t["a"]=_.exports},"1c52":function(e,t,n){},"393c":function(e,t,n){"use strict";n("458c")},"458c":function(e,t,n){},"48d5":function(e,t,n){},"5fed":function(e,t,n){"use strict";n("1c52")},"630b":function(e,t,n){"use strict";n("6459")},6459:function(e,t,n){},"65e6":function(e,t,n){},"68ae":function(e,t,n){"use strict";n("48d5")},"69be":function(e,t,n){"use strict";n("821e")},"6a90":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"database-container"},[n("Card",{staticClass:"database-card",attrs:{"show-head":!1,padding:"0"}},[n("div",{staticClass:"database-wrapper"},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"database-nav"},[n("div",{staticClass:"database-header"},[n("p",{staticClass:"database-header__title"},[e._v("数据表")]),e._v(" "),n("div",{staticClass:"database-header__icon",on:{click:e.addTable}},[n("el-tooltip",{attrs:{effect:"dark",content:"新建数据表",placement:"top"}},[n("i",{staticClass:"el-icon-plus"})])],1),e._v(" "),n("div",{staticClass:"database-header__icon",on:{click:e.refresh}},[n("el-tooltip",{attrs:{effect:"dark",content:"刷新",placement:"top"}},[n("i",{staticClass:"el-icon-refresh"})])],1),e._v(" "),n("div",{staticClass:"database-header__icon",on:{click:function(t){e.batchVisible=!0}}},[n("el-tooltip",{attrs:{effect:"dark",content:"批量删除数据表",placement:"top"}},[n("i",{staticClass:"el-icon-delete"})])],1)]),e._v(" "),n("div",{staticClass:"database-nav-content"},[n("div",{ref:"scrollView",staticClass:"database-nav-box"},[n("DatabaseNav",{ref:"nav",attrs:{"nav-list":e.navList,active:e.activeIndex,"is-tcb":e.is_tcb},on:{change:e.navChange,del:e.del,rename:e.rename}})],1),e._v(" "),n("custom-validate",{ref:"customValidate"})],1)]),e._v(" "),e.navList.length>0?n("div",{staticClass:"database-content"},[n("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.tabclick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:"数据",name:"0"}},[n("div",{staticClass:"database-content-warpper"},[e.impExpData.type?n("div",{staticClass:"database-tips",class:{success:"SUCCESS"===e.impExpData.Status,error:"FAILED"===e.impExpData.Status}},["WAITING"===e.impExpData.Status?[n("span",{staticClass:"el-icon-refresh"}),e._v(" 文件"+e._s("imp"===e.impExpData.mode?"导入":"导出")+"过程中,请不要切换页面或者刷新页面,否则任务可能会被中断\n                ")]:"RUNNING"===e.impExpData.Status?[n("span",{staticClass:"el-icon-circle-check"}),e._v(" 文件"+e._s("imp"===e.impExpData.mode?"导入":"导出")+"过程中,请不要切换页面或者刷新页面,否则任务可能会被中断\n                ")]:"SUCCESS"===e.impExpData.Status?[n("span",{staticClass:"el-icon-circle-check"}),e._v(" "),"imp"===e.impExpData.mode?[e._v("\n                    数据导入成功，成功 "+e._s(e.impExpData.SuccessCount)+" 条，失败 "+e._s(e.impExpData.FailedCount)+" 条\n                  ")]:[e._v("\n                    数据导出成功，成功 "+e._s(e.impExpData.ExportedCount)+" 条\n                  ")]]:"FAILED"===e.impExpData.Status?[n("span",{staticClass:"el-icon-circle-check"}),e._v(" 数据"+e._s("imp"===e.impExpData.mode?"导入":"导出")+"失败\n                ")]:e._e()],2):e._e(),e._v(" "),n("div",{staticClass:"database-content-header"},[n("div",{staticClass:"function-header"},[n("el-button",{attrs:{disabled:e.databaseLoading||e.loading,type:"primary",size:"mini"},on:{click:e.add}},[e._v("添加记录")]),e._v(" "),e.is_tcb?e._e():n("el-button",{attrs:{disabled:e.databaseLoading||e.loading,type:"primary",size:"mini"},on:{click:e.dataImport}},[e._v("导入")]),e._v(" "),e.is_tcb?e._e():n("el-button",{attrs:{disabled:e.databaseLoading||e.loading,type:"primary",size:"mini"},on:{click:e.dataExport}},[e._v("导出")]),e._v(" "),n("el-button",{attrs:{loading:e.databaseLoading||e.loading,size:"mini"},on:{click:e.updateTable}},[e._v("刷新")]),e._v(" "),n("p",{staticClass:"header-info"},[e._v("HBuilderX中可使用更方便的JQL查询器 "),n("a",{staticClass:"to-link",attrs:{target:"_black",href:"https://uniapp.dcloud.net.cn/uniCloud/jql-runner"}},[e._v("详见")])])],1),e._v(" "),n("div",{staticClass:"function-header"},[n("form",{on:{submit:function(t){return t.preventDefault(),e.serachChange(t)}}},[n("el-input",{staticClass:"function-header-margin",attrs:{size:"mini",placeholder:'请按 "field":"value" 的格式进行搜索',"prefix-icon":"el-icon-search"},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}}),e._v(" "),n("input",{staticClass:"function-header-button",attrs:{type:"submit",value:"搜索"}})],1)])]),e._v(" "),n("div",{staticClass:"database-content-box"},[0!==e.dataBaseData.length?[e._l(e.dataBaseData,(function(t,a){return n("div",{key:a,staticClass:"database-content__card"},[n("el-card",{attrs:{shadow:"hover"}},[n("div",{staticClass:"database-content__card-box"},[n("div",{staticClass:"database-content__card-box-wrapper"},[n("treeCard",{key:t._id+(new Date).getTime(),attrs:{trees:t}})],1),e._v(" "),n("div",{staticClass:"database-content__buttongroup"},[n("el-button",{staticStyle:{"margin-right":"10px"},attrs:{disabled:e.databaseLoading||e.loading,type:"primary",size:"mini"},on:{click:function(n){return e.manage(t,a)}}},[e._v("管理")]),e._v(" "),n("el-popconfirm",{attrs:{"confirm-button-text":"确认删除","cancel-button-text":"取消",placement:"bottom-end",icon:"el-icon-question","icon-color":"red",title:"请确认是否删除此条记录，删除后不可恢复"},on:{onConfirm:function(n){return e.deleteData(t,a)}}},[n("el-button",{attrs:{slot:"reference",disabled:e.databaseLoading||e.loading,type:"danger",size:"mini"},slot:"reference"},[e._v("删除")])],1)],1)])])],1)})),e._v(" "),e.pageData.total>10?n("div",{staticClass:"database-pagination"},[n("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper","current-page":e.pageData.page,"page-sizes":e.pageData.sizes,"page-size":e.pageData.size,total:e.pageData.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1):e._e()]:n("div",{staticClass:"database-content__card"},[n("el-card",{attrs:{shadow:"hover"}},[n("p",{staticClass:"noData"},[e._v(" "+e._s(e.databaseLoading||e.loading?"数据加载中...":"无记录数据"))])])],1)],2)])]),e._v(" "),n("el-tab-pane",{attrs:{label:"索引",name:"1"}},[n("span",{attrs:{slot:"label"},slot:"label"},[e._v("索引"),e.noFillIn?n("span",{staticStyle:{color:"red","font-size":"18px","margin-left":"3px"}},[e._v("*")]):e._e()]),e._v(" "),n("div",{staticClass:"database-content-warpper"},[n("div",{staticClass:"database-content-header"},[n("div",[n("el-button",{attrs:{disabled:e.databaseIndexLoading,type:"primary",size:"mini"},on:{click:e.addIndexDrawer}},[e._v("添加索引")]),e._v(" "),n("el-button",{attrs:{loading:e.databaseIndexLoading,size:"mini"},on:{click:e.updateIndex}},[e._v("刷新")]),e._v(" "),n("a",{staticClass:"to-link",staticStyle:{"margin-left":"10px"},attrs:{target:"_black",href:"https://uniapp.dcloud.net.cn/uniCloud/db-index"}},[e.noFillIn?n("span",[e._v("当前未设置索引，")]):e._e(),e._v("点击查看索引使用文档")])],1)]),e._v(" "),n("div",{staticClass:"database-content-box",staticStyle:{"padding-bottom":"15px"}},[n("el-table",{ref:"ruleForm",staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"",border:"","empty-text":e.databaseIndexLoading?"数据加载中...":"暂无数据"}},[n("el-table-column",{attrs:{prop:"name",label:"索引名称",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{label:"索引属性",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["_id_"===t.row.name?n("div",[e._v("唯一")]):n("div",[e._v(e._s(t.row.unique?"唯一":"非唯一"))])]}}],null,!1,3502091521)}),e._v(" "),e.is_tcb?e._e():n("el-table-column",{attrs:{label:"是否稀疏索引",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.sparse?n("div",[e._v("是")]):n("div",[e._v("否")])]}}],null,!1,1943905875)}),e._v(" "),n("el-table-column",{attrs:{prop:"address",label:"索引字段",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.keys,(function(t,a){return n("div",{key:a},[n("span",{staticStyle:{"margin-right":"10px"}},[e._v(e._s(t.name))]),e._v(" "),"1"===t.direction?n("el-tag",{attrs:{type:"info",size:"mini"}},[e._v("升序")]):e._e(),e._v(" "),"-1"===t.direction?n("el-tag",{attrs:{type:"info",size:"mini"}},[e._v("降序")]):e._e(),e._v(" "),"2dsphere"===t.direction?n("el-tag",{attrs:{type:"info",size:"mini"}},[e._v("地理位置")]):e._e()],1)}))}}],null,!1,2256681846)}),e._v(" "),n("el-table-column",{attrs:{prop:"address",label:"操作",align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return"_id_"!==t.row.name?n("el-button",{attrs:{disabled:e.databaseIndexLoading,type:"danger",size:"mini"},on:{click:function(n){return e.delIndexData(t.row)}}},[e._v("删除")]):n("span",[e._v("-")])}}],null,!0)})],1)],1)])]),e._v(" "),n("el-tab-pane",{key:e.schemaTimer,attrs:{label:"表结构",name:"3"}},[n("json-schema",{ref:"jsonSchema"})],1)],1)],1):e._e(),e._v(" "),0!==e.navList.length||e.databaseLoading||e.loading?e._e():n("div",{staticClass:"database-content"},[n("div",{staticClass:"database-content_no-data"},[n("p",[e._v("您还没有创建数据表，点击创建一个吧")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.addTable}},[e._v("创建数据表")])],1)])])]),e._v(" "),n("el-dialog",{attrs:{title:"批量删除数据表",visible:e.batchVisible,width:"600px"},on:{"update:visible":function(t){e.batchVisible=t}}},[n("div",{staticStyle:{"margin-bottom":"15px"}},[n("el-button",{attrs:{loading:e.batchloading,disabled:0===e.names.length,size:"mini",type:"danger"},on:{click:e.batchDel}},[e._v("批量删除数据表")])],1),e._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.batchloading,expression:"batchloading"}],ref:"table",attrs:{size:"mini",border:"",data:e.navList,stripe:"","row-key":"name"},on:{"selection-change":e.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection",align:"center",selectable:e.selectable,"reserve-selection":"",width:"40"}}),e._v(" "),n("el-table-column",{attrs:{property:"name",align:"center",label:"数据表名"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",width:"150",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{loading:e.loading,size:"mini",type:"danger"},on:{click:function(n){return e.del({detail:{name:t.row.name},index:t.$index})}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),n("drawer",{ref:"drawer",attrs:{visible:e.drawer},on:{"update:visible":function(t){e.drawer=t}}},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.databaseLoading,expression:"databaseLoading"}],staticClass:"drawer-wrapper"},[n("div",{staticClass:"drawer-title"},[n("span",[e._v(e._s(e.isAdd?"添加记录":"管理记录"))]),e._v(" "),n("div",{staticClass:"drawer-button",on:{click:e.drawerClose}},[n("i",{staticClass:"el-icon-close"})])]),e._v(" "),n("el-form",{staticClass:"drawer-form",attrs:{"label-position":"top","label-width":"100px"}},[n("el-form-item",{attrs:{label:"记录ID"}},[n("el-input",{attrs:{disabled:"",placeholder:"使用系统自动生成的ID"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"记录内容"}},[n("div",{staticClass:"drawer-form-button"},[n("el-button",{attrs:{size:"mini"},on:{click:e.fullScreen}},[e._v("全屏")]),e._v(" "),n("el-button",{attrs:{size:"mini"},on:{click:e.setWordWrap}},[e._v("自动换行："+e._s(e.wordWrap?"on":"off"))])],1),e._v(" "),n("div",{staticClass:"drawer-json"},[n("editor",{ref:"jsonEditor",attrs:{value:e.collectionData},on:{wordWrap:e.wordWrapChange}})],1),e._v(" "),n("p",{staticClass:"database-tip"},[e._v("此界面不能删除字段，如需删除字段请在云函数内执行，参考：\n            "),n("a",{staticClass:"opendb-link",attrs:{href:"https://uniapp.dcloud.net.cn/uniCloud/cf-database?id=remove-1",target:"_black"}},[e._v("https://uniapp.dcloud.net.cn/uniCloud/cf-database?id=remove-1")])]),e._v(" "),n("div",{staticClass:"drawer-wraning"},[n("p",[e._v("注意：请输入标准 JSON 代码，字符串需使用双引号")])])])],1),e._v(" "),n("div",{staticClass:"drawer-buttongroup"},[n("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确定")]),e._v(" "),n("el-button",{on:{click:e.drawerClose}},[e._v("取消")])],1)],1)]),e._v(" "),n("drawer",{ref:"drawerIndex",attrs:{visible:e.drawerIndex},on:{"update:visible":function(t){e.drawerIndex=t}}},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.databaseIndexLoading,expression:"databaseIndexLoading"}],staticClass:"drawer-wrapper"},[n("div",{staticClass:"drawer-title"},[n("span",[e._v("添加索引")]),e._v(" "),n("div",{staticClass:"drawer-button",on:{click:e.drawerClose}},[n("i",{staticClass:"el-icon-close"})])]),e._v(" "),n("el-form",{staticClass:"drawer-form",attrs:{"label-position":"top","label-width":"100px"}},[n("div",{staticClass:"index-info"},[n("p",[e._v("\n            云数据库创建唯一索引时，有一定的限制，见阿里文档：\n            "),n("a",{attrs:{href:"https://help.aliyun.com/document_detail/140736.html?spm=a2c4g.11186623.6.573.f71e3a06gbhTMJ。",target:"_black"}},[e._v("https://help.aliyun.com/document_detail/140736.html?spm=a2c4g.11186623.6.573.f71e3a06gbhTMJ。")])]),e._v(" "),n("p",[e._v("如果一个记录在一个唯一索引中没有索引字段的值，则该索引将为该记录存储一个空值。由于唯一约束限制，只会允许一个记录缺少索引字段。对多于一个以上的记录没有索引字段的值或缺少索引字段，索引构建将失败，提示重复键错误。")])]),e._v(" "),n("el-form-item",{attrs:{prop:"collection",label:"所属合集"}},[n("div",{attrs:{slot:"label"},slot:"label"},[n("span",{staticStyle:{color:"red"}},[e._v("*")]),e._v("所属合集\n          ")]),e._v(" "),n("el-input",{attrs:{disabled:"",placeholder:"使用系统自动生成的ID"},model:{value:e.IndexFormData.collection,callback:function(t){e.$set(e.IndexFormData,"collection",t)},expression:"IndexFormData.collection"}})],1),e._v(" "),n("el-form-item",{attrs:{prop:"options.name",label:"索引名称"}},[n("div",{attrs:{slot:"label"},slot:"label"},[n("span",{staticStyle:{color:"red"}},[e._v("*")]),e._v("索引名称\n          ")]),e._v(" "),n("el-input",{attrs:{maxlength:"30","show-word-limit":"",placeholder:"请添加索引名称"},model:{value:e.IndexFormData.options.name,callback:function(t){e.$set(e.IndexFormData.options,"name",t)},expression:"IndexFormData.options.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"索引属性",prop:"options.unique"}},[n("div",{attrs:{slot:"label"},slot:"label"},[n("span",{staticStyle:{color:"red"}},[e._v("*")]),e._v("索引属性\n          ")]),e._v(" "),n("el-radio-group",{model:{value:e.IndexFormData.options.unique,callback:function(t){e.$set(e.IndexFormData.options,"unique",t)},expression:"IndexFormData.options.unique"}},[n("el-radio",{attrs:{label:!0}},[e._v("唯一")]),e._v(" "),n("el-radio",{attrs:{label:!1}},[e._v("非唯一")])],1)],1),e._v(" "),e.is_tcb?e._e():n("el-form-item",{attrs:{label:"启用TTL",prop:"options.expireAfterSecondsCheck"}},[n("div",{attrs:{slot:"label"},slot:"label"},[n("p",{staticClass:"title-info"},[e._v("启用TTL")]),e._v(" "),n("p",{staticClass:"title-info info"},[e._v("启用后可以设置过期时间且索引字段只能添加一个")])]),e._v(" "),n("el-switch",{on:{change:e.expireAfterSecondSwitch},model:{value:e.IndexFormData.options.expireAfterSecondsCheck,callback:function(t){e.$set(e.IndexFormData.options,"expireAfterSecondsCheck",t)},expression:"IndexFormData.options.expireAfterSecondsCheck"}})],1),e._v(" "),e.IndexFormData.options.expireAfterSecondsCheck?n("el-form-item",{attrs:{label:"过期时间",prop:"options.expireAfterSecondsCheck"}},[n("div",{attrs:{slot:"label"},slot:"label"},[n("span",{staticStyle:{color:"red"}},[e._v("*")]),e._v("过期时间（单位秒）\n          ")]),e._v(" "),n("el-input-number",{attrs:{min:0,size:"mini"},model:{value:e.IndexFormData.options.expireAfterSeconds,callback:function(t){e.$set(e.IndexFormData.options,"expireAfterSeconds",t)},expression:"IndexFormData.options.expireAfterSeconds"}})],1):e._e(),e._v(" "),!e.is_tcb&&e.IndexFormData.options.unique?n("el-form-item",{attrs:{label:"是否稀疏索引",prop:"options.unique"}},[n("div",{attrs:{slot:"label"},slot:"label"},[n("span",{staticStyle:{color:"red"}},[e._v("*")]),e._v("是否稀疏索引 "),n("a",{staticClass:"opendb-link",staticStyle:{"font-size":"12px","margin-left":"10px"},attrs:{href:"https://uniapp.dcloud.net.cn/uniCloud/hellodb?id=dbindex",target:"_black"}},[e._v("什么是稀疏索引？")])]),e._v(" "),n("el-switch",{model:{value:e.IndexFormData.options.sparse,callback:function(t){e.$set(e.IndexFormData.options,"sparse",t)},expression:"IndexFormData.options.sparse"}})],1):e._e(),e._v(" "),n("el-form-item",{attrs:{label:"索引字段","label-position":"left"}},[n("div",{attrs:{slot:"label"},slot:"label"},[n("span",{staticStyle:{color:"red"}},[e._v("*")]),e._v("索引字段\n          ")]),e._v(" "),n("div",e._l(e.IndexFieldList,(function(t,a){return n("div",{key:a,staticClass:"drawer-index"},[n("el-input",{model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"indexData.value"}}),e._v(" "),n("el-select",{attrs:{placeholder:"请选择"},model:{value:t.name,callback:function(n){e.$set(t,"name",n)},expression:"indexData.name"}},[n("el-option",{attrs:{label:"升序",value:"1"}}),e._v(" "),n("el-option",{attrs:{label:"降序",value:"-1"}}),e._v(" "),n("el-option",{attrs:{label:"地理位置",value:"2dsphere"}})],1),e._v(" "),n("el-button",{on:{click:function(n){return e.delIndex(a,t)}}},[e._v("删除")])],1)})),0),e._v(" "),e.IndexFormData.options.expireAfterSecondsCheck&&e.IndexFieldList.length>0?e._e():n("el-button",{staticClass:"drawer-index-addbutton",attrs:{type:"primary"},on:{click:e.addIndex}},[e._v("添加索引字段")])],1)],1),e._v(" "),n("div",{staticClass:"drawer-buttongroup"},[n("el-button",{attrs:{type:"primary"},on:{click:e.confirmIndex}},[e._v("确定")]),e._v(" "),n("el-button",{on:{click:e.drawerClose}},[e._v("取消")])],1)],1)]),e._v(" "),n("drawer",{ref:"upload",attrs:{visible:e.drawerVisible},on:{"update:visible":function(t){e.drawerVisible=t}}},[n("import-export",{attrs:{"form-data":e.formData,"data-mode":e.dataMode},on:{uploadSuccess:e.uploadSuccess,close:e.drawrClose}})],1),e._v(" "),n("safety-rules",{ref:"safety",attrs:{dialog:e.dialogShow}}),e._v(" "),n("add-table",{ref:"addTableDialog",on:{refresh:e.getCollections,addTableByName:e.addTableByName}})],1)},i=[],o=(n("28a5"),n("20d6"),n("ac6a"),n("7f7f"),n("7514"),n("5530")),s=n("d9b9"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{},e._l(e.navList,(function(t,a){return n("div",{key:a,ref:t.name,refInFor:!0,staticClass:"database-nav_item",class:{active:e.activeIndex===a},on:{click:function(n){return e.tabSelect(t,a)}}},[n("p",{staticClass:"nav_item-text"},[e._v(e._s(t.name))]),e._v(" "),n("div",{staticClass:"database-nav_item-icon",on:{click:function(n){return n.stopPropagation(),e.rename(t,a)}}},[n("i",{staticClass:"el-icon-edit"})]),e._v(" "),n("div",{staticClass:"database-nav_item-icon",on:{click:function(n){return n.stopPropagation(),e.del(t,a)}}},[n("i",{staticClass:"el-icon-delete"})])])})),0)},l=[],c=(n("c5f6"),{name:"Card",props:{isTcb:{type:Boolean,default:!1},navList:{type:Array,default:function(){return[]}},active:{type:[Number,String],default:0}},data:function(){return{activeIndex:0}},watch:{active:{handler:function(e){this.activeIndex=e},immediate:!0}},methods:{tabSelect:function(e,t){this.activeIndex=t,this.$emit("change",{detail:e,index:t})},rename:function(e,t){this.$emit("rename",{detail:e,index:t})},del:function(e,t){this.$emit("del",{detail:e,index:t})}}}),d=c,u=(n("7233"),n("2877")),h=Object(u["a"])(d,r,l,!1,null,"698519a2",null),p=h.exports,f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"treecard"},[n("Tree",{attrs:{data:e.lists,props:e.defaultProps,"empty-text":"无记录数据"},on:{"node-click":e.handleNodeClick}}),e._v(" "),n("el-dialog",{attrs:{title:e.title,visible:e.dialogVisible,width:"70%",modal:!0,"destroy-on-close":!0,"close-on-click-modal":!0,"close-on-press-escape":!0,"before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("pre",{staticClass:"dialog-text"},[e._v(e._s(e.content))])])],1)},m=[],v=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"el-tree",class:{"el-tree--highlight-current":e.highlightCurrent,"is-dragging":!!e.dragState.draggingNode,"is-drop-not-allow":!e.dragState.allowDrop,"is-drop-inner":"inner"===e.dragState.dropType},attrs:{role:"tree"}},[e._l(e.root.childNodes,(function(t){return n("el-tree-node",{key:e.getNodeKey(t),attrs:{node:t,props:e.props,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,"render-content":e.renderContent},on:{"node-expand":e.handleNodeExpand}})})),e._v(" "),e.isEmpty?n("div",{staticClass:"el-tree__empty-block"},[n("span",{staticClass:"el-tree__empty-text"},[e._v(e._s(e.emptyText))])]):e._e(),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dragState.showDropIndicator,expression:"dragState.showDropIndicator"}],ref:"dropIndicator",staticClass:"el-tree__drop-indicator"})],2)},b=[],g=(n("6b54"),n("456d"),n("55dd"),n("53ca")),_=n("d4ec"),y=n("bee2"),k=n("eab7"),x="$treeNodeId",C=function(e,t){t&&!t[x]&&Object.defineProperty(t,x,{value:e.id,enumerable:!1,configurable:!1,writable:!1})},w=function(e,t){return e?t[e]:t[x]},D=function(e,t){var n=e;while(n&&"BODY"!==n.tagName){if(n.__vue__&&n.__vue__.$options.name===t)return n.__vue__;n=n.parentNode}return null},S=n("6bd7"),N=function(e){for(var t=!0,n=!0,a=!0,i=0,o=e.length;i<o;i++){var s=e[i];(!0!==s.checked||s.indeterminate)&&(t=!1,s.disabled||(a=!1)),(!1!==s.checked||s.indeterminate)&&(n=!1)}return{all:t,none:n,allWithoutDisable:a,half:!t&&!n}},T=function e(t){if(0!==t.childNodes.length){var n=N(t.childNodes),a=n.all,i=n.none,o=n.half;a?(t.checked=!0,t.indeterminate=!1):o?(t.checked=!1,t.indeterminate=!0):i&&(t.checked=!1,t.indeterminate=!1);var s=t.parent;s&&0!==s.level&&(t.store.checkStrictly||e(s))}},I=function(e,t){var n=e.store.props,a=e.data||{},i=n[t];if("function"===typeof i)return i(a,e);if("string"===typeof i)return a[i];if("undefined"===typeof i){var o=a[t];return void 0===o?"":o}},j=0,O=function(){function e(t){for(var n in Object(_["a"])(this,e),this.id=j++,this.text=null,this.checked=!1,this.indeterminate=!1,this.data=null,this.expanded=!1,this.parent=null,this.visible=!0,this.isCurrent=!1,t)t.hasOwnProperty(n)&&(this[n]=t[n]);this.level=0,this.loaded=!1,this.childNodes=[],this.loading=!1,this.parent&&(this.level=this.parent.level+1);var a=this.store;if(!a)throw new Error("[Node]store is required!");a.registerNode(this);var i=a.props;if(i&&"undefined"!==typeof i.isLeaf){var o=I(this,"isLeaf");"boolean"===typeof o&&(this.isLeafByUser=o)}if(!0!==a.lazy&&this.data?(this.setData(this.data),a.defaultExpandAll&&(this.expanded=!0)):this.level>0&&a.lazy&&a.defaultExpandAll&&this.expand(),Array.isArray(this.data)||C(this,this.data),this.data){var s=a.defaultExpandedKeys,r=a.key;r&&s&&-1!==s.indexOf(this.key)&&this.expand(null,a.autoExpandParent),r&&void 0!==a.currentNodeKey&&this.key===a.currentNodeKey&&(a.currentNode=this,a.currentNode.isCurrent=!0),a.lazy&&a._initDefaultCheckedNode(this),this.updateLeafState()}}return Object(y["a"])(e,[{key:"setData",value:function(e){var t;Array.isArray(e)||C(this,e),this.data=e,this.childNodes=[],t=0===this.level&&this.data instanceof Array?this.data:I(this,"children")||[];for(var n=0,a=t.length;n<a;n++)this.insertChild({data:t[n]})}},{key:"contains",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=function n(a){for(var i=a.childNodes||[],o=!1,s=0,r=i.length;s<r;s++){var l=i[s];if(l===e||t&&n(l)){o=!0;break}}return o};return n(this)}},{key:"remove",value:function(){var e=this.parent;e&&e.removeChild(this)}},{key:"insertChild",value:function(t,n,a){if(!t)throw new Error("insertChild error: child is required.");if(!(t instanceof e)){if(!a){var i=this.getChildren(!0);-1===i.indexOf(t.data)&&("undefined"===typeof n||n<0?i.push(t.data):i.splice(n,0,t.data))}Object(k["a"])(t,{parent:this,store:this.store}),t=new e(t)}t.level=this.level+1,"undefined"===typeof n||n<0?this.childNodes.push(t):this.childNodes.splice(n,0,t),this.updateLeafState()}},{key:"insertBefore",value:function(e,t){var n;t&&(n=this.childNodes.indexOf(t)),this.insertChild(e,n)}},{key:"insertAfter",value:function(e,t){var n;t&&(n=this.childNodes.indexOf(t),-1!==n&&(n+=1)),this.insertChild(e,n)}},{key:"removeChild",value:function(e){var t=this.getChildren()||[],n=t.indexOf(e.data);n>-1&&t.splice(n,1);var a=this.childNodes.indexOf(e);a>-1&&(this.store&&this.store.deregisterNode(e),e.parent=null,this.childNodes.splice(a,1)),this.updateLeafState()}},{key:"removeChildByData",value:function(e){for(var t=null,n=0;n<this.childNodes.length;n++)if(this.childNodes[n].data===e){t=this.childNodes[n];break}t&&this.removeChild(t)}},{key:"expand",value:function(e,t){var n=this,a=function(){if(t){var a=n.parent;while(a.level>0)a.expanded=!0,a=a.parent}n.expanded=!0,e&&e()};this.shouldLoadData()?this.loadData((function(e){e instanceof Array&&(n.checked?n.setChecked(!0,!0):n.store.checkStrictly||T(n),a())})):a()}},{key:"doCreateChildren",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.forEach((function(e){t.insertChild(Object(k["a"])({data:e},n),void 0,!0)}))}},{key:"collapse",value:function(){this.expanded=!1}},{key:"shouldLoadData",value:function(){return!0===this.store.lazy&&this.store.load&&!this.loaded}},{key:"updateLeafState",value:function(){if(!0!==this.store.lazy||!0===this.loaded||"undefined"===typeof this.isLeafByUser){var e=this.childNodes;!this.store.lazy||!0===this.store.lazy&&!0===this.loaded?this.isLeaf=!e||0===e.length:this.isLeaf=!1}else this.isLeaf=this.isLeafByUser}},{key:"setChecked",value:function(e,t,n,a){var i=this;if(this.indeterminate="half"===e,this.checked=!0===e,!this.store.checkStrictly){if(!this.shouldLoadData()||this.store.checkDescendants){var o=N(this.childNodes),s=o.all,r=o.allWithoutDisable;this.isLeaf||s||!r||(this.checked=!1,e=!1);var l=function(){if(t){for(var n=i.childNodes,o=0,s=n.length;o<s;o++){var r=n[o];a=a||!1!==e;var l=r.disabled?r.checked:a;r.setChecked(l,t,!0,a)}var c=N(n),d=c.half,u=c.all;u||(i.checked=u,i.indeterminate=d)}};if(this.shouldLoadData())return void this.loadData((function(){l(),T(i)}),{checked:!1!==e});l()}var c=this.parent;c&&0!==c.level&&(n||T(c))}}},{key:"getChildren",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(0===this.level)return this.data;var t=this.data;if(!t)return null;var n=this.store.props,a="children";return n&&(a=n.children||"children"),void 0===t[a]&&(t[a]=null),e&&!t[a]&&(t[a]=[]),t[a]}},{key:"updateChildren",value:function(){var e=this,t=this.getChildren()||[],n=this.childNodes.map((function(e){return e.data})),a={},i=[];t.forEach((function(e,t){var o=e[x],s=!!o&&Object(S["a"])(n,(function(e){return e[x]===o}))>=0;s?a[o]={index:t,data:e}:i.push({index:t,data:e})})),this.store.lazy||n.forEach((function(t){a[t[x]]||e.removeChildByData(t)})),i.forEach((function(t){var n=t.index,a=t.data;e.insertChild({data:a},n)})),this.updateLeafState()}},{key:"loadData",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!0!==this.store.lazy||!this.store.load||this.loaded||this.loading&&!Object.keys(n).length)e&&e.call(this);else{this.loading=!0;var a=function(a){t.loaded=!0,t.loading=!1,t.childNodes=[],t.doCreateChildren(a,n),t.updateLeafState(),e&&e.call(t,a)};this.store.load(this,a)}}},{key:"label",get:function(){return I(this,"label")}},{key:"key",get:function(){var e=this.store.key;return this.data?this.data[e]:null}},{key:"disabled",get:function(){return I(this,"disabled")}},{key:"nextSibling",get:function(){var e=this.parent;if(e){var t=e.childNodes.indexOf(this);if(t>-1)return e.childNodes[t+1]}return null}},{key:"previousSibling",get:function(){var e=this.parent;if(e){var t=e.childNodes.indexOf(this);if(t>-1)return t>0?e.childNodes[t-1]:null}return null}}]),e}(),E=function(){function e(t){var n=this;for(var a in Object(_["a"])(this,e),this.currentNode=null,this.currentNodeKey=null,t)t.hasOwnProperty(a)&&(this[a]=t[a]);if(this.nodesMap={},this.root=new O({data:this.data,store:this}),this.lazy&&this.load){var i=this.load;i(this.root,(function(e){n.root.doCreateChildren(e),n._initDefaultCheckedNodes()}))}else this._initDefaultCheckedNodes()}return Object(y["a"])(e,[{key:"filter",value:function(e){var t=this.filterNodeMethod,n=this.lazy,a=function a(i){var o=i.root?i.root.childNodes:i.childNodes;if(o.forEach((function(n){n.visible=t.call(n,e,n.data,n),a(n)})),!i.visible&&o.length){var s=!0;s=!o.some((function(e){return e.visible})),i.root?i.root.visible=!1===s:i.visible=!1===s}e&&(!i.visible||i.isLeaf||n||i.expand())};a(this)}},{key:"setData",value:function(e){var t=e!==this.root.data;t?(this.root.setData(e),this._initDefaultCheckedNodes()):this.root.updateChildren()}},{key:"getNode",value:function(e){if(e instanceof O)return e;var t="object"!==Object(g["a"])(e)?e:w(this.key,e);return this.nodesMap[t]||null}},{key:"insertBefore",value:function(e,t){var n=this.getNode(t);n.parent.insertBefore({data:e},n)}},{key:"insertAfter",value:function(e,t){var n=this.getNode(t);n.parent.insertAfter({data:e},n)}},{key:"remove",value:function(e){var t=this.getNode(e);t&&t.parent&&(t===this.currentNode&&(this.currentNode=null),t.parent.removeChild(t))}},{key:"append",value:function(e,t){var n=t?this.getNode(t):this.root;n&&n.insertChild({data:e})}},{key:"_initDefaultCheckedNodes",value:function(){var e=this,t=this.defaultCheckedKeys||[],n=this.nodesMap;t.forEach((function(t){var a=n[t];a&&a.setChecked(!0,!e.checkStrictly)}))}},{key:"_initDefaultCheckedNode",value:function(e){var t=this.defaultCheckedKeys||[];-1!==t.indexOf(e.key)&&e.setChecked(!0,!this.checkStrictly)}},{key:"setDefaultCheckedKey",value:function(e){e!==this.defaultCheckedKeys&&(this.defaultCheckedKeys=e,this._initDefaultCheckedNodes())}},{key:"registerNode",value:function(e){var t=this.key;if(t&&e&&e.data){var n=e.key;void 0!==n&&(this.nodesMap[e.key]=e)}}},{key:"deregisterNode",value:function(e){var t=this,n=this.key;n&&e&&e.data&&(e.childNodes.forEach((function(e){t.deregisterNode(e)})),delete this.nodesMap[e.key])}},{key:"getCheckedNodes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=[],a=function a(i){var o=i.root?i.root.childNodes:i.childNodes;o.forEach((function(i){(i.checked||t&&i.indeterminate)&&(!e||e&&i.isLeaf)&&n.push(i.data),a(i)}))};return a(this),n}},{key:"getCheckedKeys",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.getCheckedNodes(t).map((function(t){return(t||{})[e.key]}))}},{key:"getHalfCheckedNodes",value:function(){var e=[],t=function t(n){var a=n.root?n.root.childNodes:n.childNodes;a.forEach((function(n){n.indeterminate&&e.push(n.data),t(n)}))};return t(this),e}},{key:"getHalfCheckedKeys",value:function(){var e=this;return this.getHalfCheckedNodes().map((function(t){return(t||{})[e.key]}))}},{key:"_getAllNodes",value:function(){var e=[],t=this.nodesMap;for(var n in t)t.hasOwnProperty(n)&&e.push(t[n]);return e}},{key:"updateChildren",value:function(e,t){var n=this.nodesMap[e];if(n){for(var a=n.childNodes,i=a.length-1;i>=0;i--){var o=a[i];this.remove(o.data)}for(var s=0,r=t.length;s<r;s++){var l=t[s];this.append(l,n.data)}}}},{key:"_setCheckedKeys",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,a=this._getAllNodes().sort((function(e,t){return t.level-e.level})),i=Object.create(null),o=Object.keys(n);a.forEach((function(e){return e.setChecked(!1,!1)}));for(var s=0,r=a.length;s<r;s++){var l=a[s],c=l.data[e].toString(),d=o.indexOf(c)>-1;if(d){var u=l.parent;while(u&&u.level>0)i[u.data[e]]=!0,u=u.parent;l.isLeaf||this.checkStrictly?l.setChecked(!0,!1):(l.setChecked(!0,!0),t&&function(){l.setChecked(!1,!1);var e=function e(t){var n=t.childNodes;n.forEach((function(t){t.isLeaf||t.setChecked(!1,!1),e(t)}))};e(l)}())}else l.checked&&!i[c]&&l.setChecked(!1,!1)}}},{key:"setCheckedNodes",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.key,a={};e.forEach((function(e){a[(e||{})[n]]=!0})),this._setCheckedKeys(n,t,a)}},{key:"setCheckedKeys",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.defaultCheckedKeys=e;var n=this.key,a={};e.forEach((function(e){a[e]=!0})),this._setCheckedKeys(n,t,a)}},{key:"setDefaultExpandedKeys",value:function(e){var t=this;e=e||[],this.defaultExpandedKeys=e,e.forEach((function(e){var n=t.getNode(e);n&&n.expand(null,t.autoExpandParent)}))}},{key:"setChecked",value:function(e,t,n){var a=this.getNode(e);a&&a.setChecked(!!t,n)}},{key:"getCurrentNode",value:function(){return this.currentNode}},{key:"setCurrentNode",value:function(e){var t=this.currentNode;t&&(t.isCurrent=!1),this.currentNode=e,this.currentNode.isCurrent=!0}},{key:"setUserCurrentNode",value:function(e){var t=e[this.key],n=this.nodesMap[t];this.setCurrentNode(n)}},{key:"setCurrentNodeKey",value:function(e){if(null===e||void 0===e)return this.currentNode&&(this.currentNode.isCurrent=!1),void(this.currentNode=null);var t=this.getNode(e);t&&this.setCurrentNode(t)}}]),e}(),F=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:e.node.visible,expression:"node.visible"}],ref:"node",staticClass:"el-tree-node",class:{"is-expanded":e.expanded,"is-current":e.node.isCurrent,"is-hidden":!e.node.visible,"is-focusable":!e.node.disabled,"is-checked":!e.node.disabled&&e.node.checked},attrs:{role:"treeitem",tabindex:"-1","aria-expanded":e.expanded,"aria-disabled":e.node.disabled,"aria-checked":e.node.checked,draggable:e.tree.draggable},on:{click:function(t){return t.stopPropagation(),e.handleClick(t)},contextmenu:function(t){return e.handleContextMenu(t)},dragstart:function(t){return t.stopPropagation(),e.handleDragStart(t)},dragover:function(t){return t.stopPropagation(),e.handleDragOver(t)},dragend:function(t){return t.stopPropagation(),e.handleDragEnd(t)},drop:function(t){return t.stopPropagation(),e.handleDrop(t)}}},[n("div",{staticClass:"el-tree-node__content",style:{"padding-left":(e.node.level-1)*e.tree.indent+"px"}},[n("span",{class:[{"is-leaf":e.node.isLeaf,expanded:!e.node.isLeaf&&e.expanded},"el-tree-node__expand-icon",e.tree.iconClass?e.tree.iconClass:"el-icon-caret-right"],on:{click:function(t){return t.stopPropagation(),e.handleExpandIconClick(t)}}}),e._v(" "),e.showCheckbox?n("el-checkbox",{attrs:{indeterminate:e.node.indeterminate,disabled:!!e.node.disabled},on:{change:e.handleCheckChange},nativeOn:{click:function(e){e.stopPropagation()}},model:{value:e.node.checked,callback:function(t){e.$set(e.node,"checked",t)},expression:"node.checked"}}):e._e(),e._v(" "),e.node.loading?n("span",{staticClass:"el-tree-node__loading-icon el-icon-loading"}):e._e(),e._v(" "),n("node-content",{attrs:{node:e.node}})],1),e._v(" "),n("el-collapse-transition",[!e.renderAfterExpand||e.childNodeRendered?n("div",{directives:[{name:"show",rawName:"v-show",value:e.expanded,expression:"expanded"}],staticClass:"el-tree-node__children",attrs:{role:"group","aria-expanded":e.expanded}},e._l(e.node.childNodes,(function(t){return n("el-tree-node",{key:e.getNodeKey(t),attrs:{"render-content":e.renderContent,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,node:t},on:{"node-expand":e.handleChildNodeExpand}})})),1):e._e()])],1)},$=[],L=n("f308"),B=n("9c1a"),A=n("f6f4"),M={name:"ElTreeNode",componentName:"ElTreeNode",components:{ElCollapseTransition:L["a"],ElCheckbox:B["a"],NodeContent:{props:{node:{required:!0}},data:function(){return{isFold:!0,whitespace:"normal"}},render:function(e){var t=this.$parent,n=t.tree,a=this.node,i=a.data,o=a.store,s="#666",r="",l=80;switch(r=i.children?JSON.parse(i.value):i.value,Object(g["a"])(r)){case"string":s="rgb(102, 102, 102)";break;case"number":s="rgb(22,27,195)";break;case"boolean":s="rgb(12,38,156)";break;case"object":null===r&&(s="rgb(168,227,174)");break;default:s="#999"}var c=function(e){return e.value&&e.value.length>l?e.value.substr(0,l)+"...":e.children?e.value:JSON.stringify(e.value)},d=function(e,t){e.children||"string"===typeof e.value&&e.value.length>l&&(this.isFold=!this.isFold,this.isFold&&(this.whitespace="normal"),t&&(this.whitespace="pre-wrap\t"))},u="";if(!i.children&&"string"===typeof i.value&&i.value.length>l){var h="";this.isFold&&(h=e("span",{class:"render-fold",on:{click:d.bind(this,i,!0)}},["带格式展开"])),u=e("p",[e("span",{class:"render-fold",on:{click:d.bind(this,i,!1)}},[this.isFold?"展开":"收起"]),h])}var p="auto";return p=a.isLeaf?"auto":"pointer",t.renderContent?t.renderContent.call(t._renderProxy,e,{_self:n.$vnode.context,node:a,data:i,store:o}):n.$scopedSlots.default?n.$scopedSlots.default({node:a,data:i}):e("div",{class:"el-tree-node__label",style:"display: flex;align-items: flex-start; cursor:".concat(p,";")},[e("p",{style:"margin:0;margin-top:0px;margin-right:20px;min-width:150px;font-weight: bold;"},[a.label]),e("p",{class:"label-text",style:"color:".concat(s)},[e("span",{style:"padding-right:20px;white-space:".concat(this.whitespace)},[this.isFold?c(i):i.value]),u])])}}},mixins:[A["a"]],props:{node:{type:Object,default:function(){return{}}},props:{default:function(){return{}}},renderContent:Function,renderAfterExpand:{type:Boolean,default:!0},showCheckbox:{type:Boolean,default:!1}},data:function(){return{tree:null,expanded:!1,childNodeRendered:!1,oldChecked:null,oldIndeterminate:null}},watch:{"node.indeterminate":function(e){this.handleSelectChange(this.node.checked,e)},"node.checked":function(e){this.handleSelectChange(e,this.node.indeterminate)},"node.expanded":function(e){var t=this;this.$nextTick((function(){return t.expanded=e,e})),e&&(this.childNodeRendered=!0)}},created:function(){var e=this,t=this.$parent;t.isTree?this.tree=t:this.tree=t.tree;var n=this.tree,a=n.props||{},i=a["children"]||"children";this.$watch("node.data.".concat(i),(function(){e.node.updateChildren()})),this.node.expanded&&(this.expanded=!0,this.childNodeRendered=!0),this.tree.accordion&&this.$on("tree-node-expand",(function(t){e.node!==t&&e.node.collapse()}))},methods:{getNodeKey:function(e){return w(this.tree.nodeKey,e.data)},handleSelectChange:function(e,t){this.oldChecked!==e&&this.oldIndeterminate!==t&&this.tree.$emit("check-change",this.node.data,e,t),this.oldChecked=e,this.indeterminate=t},handleClick:function(){var e=this.tree.store;e.setCurrentNode(this.node),this.tree.$emit("current-change",e.currentNode?e.currentNode.data:null,e.currentNode),this.tree.currentNode=this,this.tree.expandOnClickNode&&this.handleExpandIconClick(),this.tree.checkOnClickNode&&!this.node.disabled&&this.handleCheckChange(null,{target:{checked:!this.node.checked}}),this.tree.$emit("node-click",this.node.data,this.node,this)},handleContextMenu:function(e){this.tree._events["node-contextmenu"]&&this.tree._events["node-contextmenu"].length>0&&(e.stopPropagation(),e.preventDefault()),this.tree.$emit("node-contextmenu",e,this.node.data,this.node,this)},handleExpandIconClick:function(){this.node.isLeaf||(this.expanded?(this.tree.$emit("node-collapse",this.node.data,this.node,this),this.node.collapse()):(this.node.expand(),this.$emit("node-expand",this.node.data,this.node,this)))},handleCheckChange:function(e,t){var n=this;this.node.setChecked(t.target.checked,!this.tree.checkStrictly),this.$nextTick((function(){var e=n.tree.store;n.tree.$emit("check",n.node.data,{checkedNodes:e.getCheckedNodes(),checkedKeys:e.getCheckedKeys(),halfCheckedNodes:e.getHalfCheckedNodes(),halfCheckedKeys:e.getHalfCheckedKeys()})}))},handleChildNodeExpand:function(e,t,n){this.broadcast("ElTreeNode","tree-node-expand",t),this.tree.$emit("node-expand",e,t,n)},handleDragStart:function(e){this.tree.draggable&&this.tree.$emit("tree-node-drag-start",e,this)},handleDragOver:function(e){this.tree.draggable&&(this.tree.$emit("tree-node-drag-over",e,this),e.preventDefault())},handleDrop:function(e){e.preventDefault()},handleDragEnd:function(e){this.tree.draggable&&this.tree.$emit("tree-node-drag-end",e,this)}}},R=M,P=(n("5fed"),Object(u["a"])(R,F,$,!1,null,"1c902320",null)),V=P.exports,z=n("9206"),K=n("526f"),q={name:"ElTree",components:{ElTreeNode:V},mixins:[A["a"]],props:{data:{type:Array},emptyText:{type:String,default:function(){return Object(z["a"])("el.tree.emptyText")}},renderAfterExpand:{type:Boolean,default:!0},nodeKey:String,checkStrictly:Boolean,defaultExpandAll:Boolean,expandOnClickNode:{type:Boolean,default:!0},checkOnClickNode:Boolean,checkDescendants:{type:Boolean,default:!1},autoExpandParent:{type:Boolean,default:!0},defaultCheckedKeys:Array,defaultExpandedKeys:Array,currentNodeKey:[String,Number],renderContent:Function,showCheckbox:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},allowDrag:Function,allowDrop:Function,props:{default:function(){return{children:"children",label:"label",disabled:"disabled"}}},lazy:{type:Boolean,default:!1},highlightCurrent:Boolean,load:Function,filterNodeMethod:Function,accordion:Boolean,indent:{type:Number,default:18},iconClass:String},data:function(){return{store:null,root:null,currentNode:null,treeItems:null,checkboxItems:[],dragState:{showDropIndicator:!1,draggingNode:null,dropNode:null,allowDrop:!0}}},computed:{children:{set:function(e){this.data=e},get:function(){return this.data}},treeItemArray:function(){return Array.prototype.slice.call(this.treeItems)},isEmpty:function(){var e=this.root.childNodes;return!e||0===e.length||e.every((function(e){var t=e.visible;return!t}))}},watch:{defaultCheckedKeys:function(e){this.store.setDefaultCheckedKey(e)},defaultExpandedKeys:function(e){this.store.defaultExpandedKeys=e,this.store.setDefaultExpandedKeys(e)},data:function(e){this.store.setData(e)},checkboxItems:function(e){Array.prototype.forEach.call(e,(function(e){e.setAttribute("tabindex",-1)}))},checkStrictly:function(e){this.store.checkStrictly=e}},created:function(){var e=this;this.isTree=!0,this.store=new E({key:this.nodeKey,data:this.data,lazy:this.lazy,props:this.props,load:this.load,currentNodeKey:this.currentNodeKey,checkStrictly:this.checkStrictly,checkDescendants:this.checkDescendants,defaultCheckedKeys:this.defaultCheckedKeys,defaultExpandedKeys:this.defaultExpandedKeys,autoExpandParent:this.autoExpandParent,defaultExpandAll:this.defaultExpandAll,filterNodeMethod:this.filterNodeMethod}),this.root=this.store.root;var t=this.dragState;this.$on("tree-node-drag-start",(function(n,a){if("function"===typeof e.allowDrag&&!e.allowDrag(a.node))return n.preventDefault(),!1;n.dataTransfer.effectAllowed="move";try{n.dataTransfer.setData("text/plain","")}catch(i){}t.draggingNode=a,e.$emit("node-drag-start",a.node,n)})),this.$on("tree-node-drag-over",(function(n,a){var i=D(n.target,"ElTreeNode"),o=t.dropNode;o&&o!==i&&Object(K["b"])(o.$el,"is-drop-inner");var s=t.draggingNode;if(s&&i){var r=!0,l=!0,c=!0,d=!0;"function"===typeof e.allowDrop&&(r=e.allowDrop(s.node,i.node,"prev"),d=l=e.allowDrop(s.node,i.node,"inner"),c=e.allowDrop(s.node,i.node,"next")),n.dataTransfer.dropEffect=l?"move":"none",(r||l||c)&&o!==i&&(o&&e.$emit("node-drag-leave",s.node,o.node,n),e.$emit("node-drag-enter",s.node,i.node,n)),(r||l||c)&&(t.dropNode=i),i.node.nextSibling===s.node&&(c=!1),i.node.previousSibling===s.node&&(r=!1),i.node.contains(s.node,!1)&&(l=!1),(s.node===i.node||s.node.contains(i.node))&&(r=!1,l=!1,c=!1);var u,h=i.$el.getBoundingClientRect(),p=e.$el.getBoundingClientRect(),f=r?l?.25:c?.45:1:-1,m=c?l?.75:r?.55:0:1,v=-9999,b=n.clientY-h.top;u=b<h.height*f?"before":b>h.height*m?"after":l?"inner":"none";var g=i.$el.querySelector(".el-tree-node__expand-icon").getBoundingClientRect(),_=e.$refs.dropIndicator;"before"===u?v=g.top-p.top:"after"===u&&(v=g.bottom-p.top),_.style.top=v+"px",_.style.left=g.right-p.left+"px","inner"===u?Object(K["a"])(i.$el,"is-drop-inner"):Object(K["b"])(i.$el,"is-drop-inner"),t.showDropIndicator="before"===u||"after"===u,t.allowDrop=t.showDropIndicator||d,t.dropType=u,e.$emit("node-drag-over",s.node,i.node,n)}})),this.$on("tree-node-drag-end",(function(n){var a=t.draggingNode,i=t.dropType,o=t.dropNode;if(n.preventDefault(),n.dataTransfer.dropEffect="move",a&&o){var s={data:a.node.data};"none"!==i&&a.node.remove(),"before"===i?o.node.parent.insertBefore(s,o.node):"after"===i?o.node.parent.insertAfter(s,o.node):"inner"===i&&o.node.insertChild(s),"none"!==i&&e.store.registerNode(s),Object(K["b"])(o.$el,"is-drop-inner"),e.$emit("node-drag-end",a.node,o.node,i,n),"none"!==i&&e.$emit("node-drop",a.node,o.node,i,n)}a&&!o&&e.$emit("node-drag-end",a.node,null,i,n),t.showDropIndicator=!1,t.draggingNode=null,t.dropNode=null,t.allowDrop=!0}))},mounted:function(){this.initTabIndex(),this.$el.addEventListener("keydown",this.handleKeydown)},updated:function(){this.treeItems=this.$el.querySelectorAll("[role=treeitem]"),this.checkboxItems=this.$el.querySelectorAll("input[type=checkbox]")},methods:{filter:function(e){if(!this.filterNodeMethod)throw new Error("[Tree] filterNodeMethod is required when filter");this.store.filter(e)},getNodeKey:function(e){return w(this.nodeKey,e.data)},getNodePath:function(e){if(!this.nodeKey)throw new Error("[Tree] nodeKey is required in getNodePath");var t=this.store.getNode(e);if(!t)return[];var n=[t.data],a=t.parent;while(a&&a!==this.root)n.push(a.data),a=a.parent;return n.reverse()},getCheckedNodes:function(e,t){return this.store.getCheckedNodes(e,t)},getCheckedKeys:function(e){return this.store.getCheckedKeys(e)},getCurrentNode:function(){var e=this.store.getCurrentNode();return e?e.data:null},getCurrentKey:function(){if(!this.nodeKey)throw new Error("[Tree] nodeKey is required in getCurrentKey");var e=this.getCurrentNode();return e?e[this.nodeKey]:null},setCheckedNodes:function(e,t){if(!this.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedNodes");this.store.setCheckedNodes(e,t)},setCheckedKeys:function(e,t){if(!this.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedKeys");this.store.setCheckedKeys(e,t)},setChecked:function(e,t,n){this.store.setChecked(e,t,n)},getHalfCheckedNodes:function(){return this.store.getHalfCheckedNodes()},getHalfCheckedKeys:function(){return this.store.getHalfCheckedKeys()},setCurrentNode:function(e){if(!this.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentNode");this.store.setUserCurrentNode(e)},setCurrentKey:function(e){if(!this.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentKey");this.store.setCurrentNodeKey(e)},getNode:function(e){return this.store.getNode(e)},remove:function(e){this.store.remove(e)},append:function(e,t){this.store.append(e,t)},insertBefore:function(e,t){this.store.insertBefore(e,t)},insertAfter:function(e,t){this.store.insertAfter(e,t)},handleNodeExpand:function(e,t,n){this.broadcast("ElTreeNode","tree-node-expand",t),this.$emit("node-expand",e,t,n)},updateKeyChildren:function(e,t){if(!this.nodeKey)throw new Error("[Tree] nodeKey is required in updateKeyChild");this.store.updateChildren(e,t)},initTabIndex:function(){this.treeItems=this.$el.querySelectorAll(".is-focusable[role=treeitem]"),this.checkboxItems=this.$el.querySelectorAll("input[type=checkbox]");var e=this.$el.querySelectorAll(".is-checked[role=treeitem]");e.length?e[0].setAttribute("tabindex",0):this.treeItems[0]&&this.treeItems[0].setAttribute("tabindex",0)},handleKeydown:function(e){var t=e.target;if(-1!==t.className.indexOf("el-tree-node")){var n=e.keyCode;this.treeItems=this.$el.querySelectorAll(".is-focusable[role=treeitem]");var a,i=this.treeItemArray.indexOf(t);[38,40].indexOf(n)>-1&&(e.preventDefault(),a=38===n?0!==i?i-1:0:i<this.treeItemArray.length-1?i+1:0,this.treeItemArray[a].focus()),[37,39].indexOf(n)>-1&&(e.preventDefault(),t.click());var o=t.querySelector('[type="checkbox"]');[13,32].indexOf(n)>-1&&o&&(e.preventDefault(),o.click())}}}},U=q,J=Object(u["a"])(U,v,b,!1,null,null,null),W=J.exports,H=n("ed08"),G={name:"TreeCard",components:{Tree:W},props:{trees:{type:Object,default:function(){return{}}}},data:function(){return{defaultProps:{children:"children",label:"label"},lists:[],dialogVisible:!1,content:"",title:""}},created:function(){this.lists=Object(H["d"])(this.trees)},methods:{handleClose:function(){this.dialogVisible=!1},handleNodeClick:function(e,t,n){}}},Z=G,Q=(n("c0eb"),Object(u["a"])(Z,f,m,!1,null,"4837e0b3",null)),Y=Q.exports,X=n("156b"),ee=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:"安全规则权限设置",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t},close:e.close}},[e.custom?n("div",[n("div",{staticClass:"tips-box"},[n("p",[e._v("使用安全规则须知：")]),e._v(" "),n("p",[e._v("安全规则为高级数据库权限配置，请注意，使用安全规则后：")]),e._v(" "),n("p",[e._v("- 客户端代码需要根据场景进行修改，详情请 "),n("a",{attrs:{href:"https://cloud.tencent.com/document/product/876/36414",target:"_black"}},[e._v("查看文档")])]),e._v(" "),n("p",[e._v("- 原始权限设置将不再生效。")])]),e._v(" "),n("div",[n("div",{staticClass:"form-button"},[n("el-button",{attrs:{size:"mini"},on:{click:e.format}},[e._v("格式化代码")])],1),e._v(" "),n("div",[n("json-editor",{ref:"jsonEditor",model:{value:e.collectionData,callback:function(t){e.collectionData=t},expression:"collectionData"}})],1)])]):n("div",{staticClass:"permission-list"},[n("el-radio-group",{model:{value:e.authorityradio,callback:function(t){e.authorityradio=t},expression:"authorityradio"}},[n("div",{staticClass:"permission-item"},[n("label",[n("el-radio",{attrs:{label:"READONLY"}},[e._v("所有用户可读，仅创建者及管理员可写")]),e._v(" "),n("div",{staticClass:"permission-tips"},[e._v("适用场景：用户头像、用户公开相册等")])],1)]),e._v(" "),n("div",{staticClass:"permission-item"},[n("label",[n("el-radio",{attrs:{label:"PRIVATE"}},[e._v("仅创建者及管理员可读写")]),e._v(" "),n("div",{staticClass:"permission-tips"},[e._v("适用场景：私密相册、网盘文件等")])],1)]),e._v(" "),n("div",{staticClass:"permission-item"},[n("label",[n("el-radio",{attrs:{label:"ADMINWRITE"}},[e._v("所有用户可读，仅管理员可写")]),e._v(" "),n("div",{staticClass:"permission-tips"},[e._v("适用场景：文章配图、商品图片等")])],1)]),e._v(" "),n("div",{staticClass:"permission-item"},[n("label",[n("el-radio",{attrs:{label:"ADMINONLY"}},[e._v("仅管理员可读写")]),e._v(" "),n("div",{staticClass:"permission-tips"},[e._v("适用场景：业务日志等")])],1)])])],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确 定")])],1)])},te=[],ne=n("fa7e"),ae={components:{JsonEditor:ne["a"]},props:{custom:{type:Boolean,default:!0}},data:function(){return{dialogFormVisible:!1,jsonData:{},collectionData:{read:"doc._openid == auth.openid",write:"doc._openid == auth.openid"},authorityradio:"READONLY"}},watch:{dialog:function(e){this.dialogFormVisible=e}},methods:{open:function(){this.dialogFormVisible=!0},close:function(){this.dialogFormVisible=!1},getValue:function(){return this.$refs.jsonEditor.getValue()},format:function(){try{this.$refs.jsonEditor.format()}catch(e){this.$alert("您输入的代码有误，不能格式化，请检查代码","警告",{confirmButtonText:"确定",type:"error",callback:function(){}})}},save:function(){}}},ie=ae,oe=(n("0a0a"),Object(u["a"])(ie,ee,te,!1,null,"1ea0eccc",null)),se=oe.exports,re=n("3022"),le=n("0472"),ce=n("2f62"),de=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"dialog-add-table"},[n("el-dialog",{attrs:{title:"",width:"70%","close-on-click-modal":!1,"close-on-press-escape":!1,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t},open:e.onDialogOpened,close:e.onDialogClosed}},[n("div",{staticClass:"group group-1"},[n("h3",{staticClass:"title color-d"},[e._v("创建空表")]),e._v(" "),n("div",{staticClass:"flex-r a-i-c"},[n("h5",{staticClass:"new-table-name"},[e._v("数据表名称")]),e._v(" "),n("el-input",{staticClass:"new-table-input",attrs:{size:"small",placeholder:""},model:{value:e.newTableName,callback:function(t){e.newTableName=t},expression:"newTableName"}}),e._v(" "),n("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleCreateNewTable}},[e._v("创建")])],1)]),e._v(" "),n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"group group-2"},[n("div",{staticClass:"flex-r a-i-c"},[n("h3",{staticClass:"title color-d"},[e._v("使用OpenDB表模板创建")]),n("span",[e._v("（openDB是一套开放的数据表设计规范，"),n("a",{staticClass:"m-l-a opendb-link",attrs:{href:"https://gitee.com/dcloud/opendb",target:"_blank"}},[e._v("[详见]")]),e._v("）")])]),e._v(" "),n("div",{staticClass:"flex-r a-i-c db-list"},[n("h4",[e._v("表分类：")]),e._v(" "),n("el-checkbox-group",{staticClass:"flex-f m-l-d",attrs:{size:"mini"},on:{change:e.handleDBChange},model:{value:e.checkedDB,callback:function(t){e.checkedDB=t},expression:"checkedDB"}},e._l(e.dbList,(function(e){return n("el-checkbox",{key:e.name,staticClass:"db-tag",attrs:{label:e.title}})})),1)],1),e._v(" "),n("div",{staticClass:"flex-r step-main m-t-d"},[n("div",{staticClass:"el-card el-card-table flex-c"},[n("div",{staticClass:"el-card__header",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("表")])]),e._v(" "),n("el-table",{ref:"tables",staticClass:"db-table",attrs:{data:e.tables,"highlight-current-row":"","tooltip-effect":"dark",height:"100%"},on:{"row-click":e.handleTableClick,"selection-change":e.handleTableChange}},[n("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),n("el-table-column",{attrs:{prop:"name",label:"表名",width:"200"}}),e._v(" "),n("el-table-column",{attrs:{prop:"title",label:"备注"}})],1)],1),e._v(" "),n("el-tabs",{staticClass:"flex-f flex-c m-l-d tabs",attrs:{type:"border-card"},on:{"tab-click":e.handleTabClick},model:{value:e.tabActiveName,callback:function(t){e.tabActiveName=t},expression:"tabActiveName"}},[n("el-tab-pane",{staticClass:"flex-f flex-r",attrs:{label:"表结构",name:"collection"}},[n("json-editor",{ref:"jsonSchema",staticClass:"flex-f json-view json-editor",attrs:{"read-only":!0},model:{value:e.tableCollection,callback:function(t){e.tableCollection=t},expression:"tableCollection"}})],1),e._v(" "),n("el-tab-pane",{staticClass:"flex-f flex-r",attrs:{label:"表索引",name:"collection_index"}},[n("json-editor",{ref:"tableIndex",staticClass:"flex-f json-view json-editor",attrs:{"read-only":!0}})],1),e._v(" "),n("el-tab-pane",{staticClass:"flex-f flex-r",attrs:{label:"表数据",name:"package"}},["url"===e.tableDataType?n("div",{staticClass:"p-a-d"},[n("div",[e._v("点击下面链接查看详细数据")]),e._v(" "),n("br"),e._v(" "),n("a",{staticClass:"opendb-link",attrs:{href:e.tableData,target:"_blank"}},[e._v(e._s(e.tableData))])]):e._e(),e._v(" "),"url"!==e.tableDataType&&e.tableData.length>2?n("textarea",{staticClass:"flex-f json-view",attrs:{readonly:"readonly"},domProps:{value:e.tableData}}):n("div",{staticClass:"p-a-d"},[n("div",[e._v("无表数据")])])]),e._v(" "),n("el-tab-pane",{staticClass:"flex-f flex-r",attrs:{label:"概述",name:"overview"}},[e.tableOverview?n("div",{staticClass:"flex-f"},[n("div",{staticClass:"overview-item"},[n("div",{staticClass:"k"},[e._v("表名：")]),e._v(" "),n("div",{staticClass:"v"},[e._v(e._s(e.tableOverview.tableName))])]),e._v(" "),n("div",{staticClass:"overview-item"},[n("div",{staticClass:"k"},[e._v("备注：")]),e._v(" "),n("div",{staticClass:"v"},[e._v(e._s(e.tableOverview.tableTitle))])]),e._v(" "),n("div",{staticClass:"overview-item"},[n("div",{staticClass:"k"},[e._v("贡献者：")]),e._v(" "),n("div",{staticClass:"v"},e._l(e.tableOverview.contributors,(function(t){return n("div",{key:t.name},[n("a",{staticClass:"contributor",attrs:{href:t.homepage,target:"_blank"}},[e._v(e._s(t.name))])])})),0)]),e._v(" "),n("div",{staticClass:"overview-item"},[n("div",{staticClass:"k"},[e._v("更新时间：")]),e._v(" "),n("div",{staticClass:"v"},[e._v(e._s(e.tableOverview.updateTime))])])]):e._e()])],1)],1),e._v(" "),1==e.step?n("div",{staticClass:"flex-c step-view"},[n("el-card",{staticClass:"box-card flex-f"},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("覆盖已存在表")])]),e._v(" "),n("el-checkbox-group",{model:{value:e.checkedConflictTables,callback:function(t){e.checkedConflictTables=t},expression:"checkedConflictTables"}},e._l(e.conflictTables,(function(t){return n("el-checkbox",{key:t,staticClass:"old-table-item",attrs:{label:t}},[e._v(e._s(t))])})),1)],1),e._v(" "),n("el-row",{staticStyle:{"text-align":"center","margin-top":"15px"}},[n("el-button",{attrs:{type:"primary"},on:{click:e.step2}},[e._v("确定")])],1)],1):e._e(),e._v(" "),0==e.step?n("div",{staticClass:"flex-r m-t-d"},[n("el-row",{staticClass:"m-l-a"},[n("el-button",{attrs:{disabled:0==e.checkedTables.length,type:"primary",size:"small"},on:{click:e.handleNext}},[e._v("创建选中的表")])],1)],1):e._e()]),e._v(" "),2==e.step?n("div",{staticClass:"flex-r step-view",staticStyle:{"margin-top":"40px"}},[n("div",{staticStyle:{margin:"auto"}},[n("h5",[e._v("正在创建表，请不要关闭或刷新页面")]),e._v(" "),n("el-progress",{attrs:{"show-text":!1,percentage:e.percentage}})],1)]):e._e()])],1)},ue=[],he=(n("96cf"),n("1da1")),pe=(n("a481"),n("1c4c"),n("4f7f"),n("6762"),n("2fdb"),n("5df3"),n("f400"),{name:"AddTableDialog",components:{JsonEditor:ne["a"]},mixins:[s["a"]],data:function(){return{loading:!1,dialogVisible:!1,newTableName:"",tabActiveName:"collection",searchInput:"",searchSelect:"",dbList:[],checkedDB:[],tables:[],checkedTables:[],conflictTables:[],checkedConflictTables:[],newTables:[],step:0,creating:!1,tableCollection:"",tablePackage:"",tableData:"",tableDataType:"",tableOverview:"",tableIndex:"",percentage:50}},computed:Object(o["a"])({},Object(ce["b"])(["appid","is_tcb","spaceid"])),created:function(e){this._total=0},mounted:function(e){},methods:{onDialogOpened:function(){var e=this;this.step=0,this.newTableName="",this.dbList=[],this.checkedDB=[],this.tables=[],this.checkedTables=[],this.newTables=[],this.conflictTables=[],this.checkedConflictTables=[],this.tableData="",this.tableDataType="",this.tableOverview="",this.tableIndex="",this.$nextTick((function(){e.$refs.jsonSchema.setValue({}),e.$refs.tableIndex.setValue({}),e.getOpenDBData()})),window._hmt.push(["_trackEvent","云数据库","新建表","打开对话框"])},onDialogClosed:function(){this.dialogVisible=!1,window._hmt.push(["_trackEvent","云数据库","新建表","关闭对话框"])},open:function(){this.dialogVisible=!0},close:function(e){this.dialogVisible=!1,e&&this.$emit("refresh")},handleCreateNewTable:function(){this.$emit("addTableByName",this.newTableName),window._hmt.push(["_trackEvent","云数据库","新建表","表名创建"])},handleDBChange:function(e){for(var t=this,n=new Map,a=this.checkedDB,i=0;i<this.dbList.length;i++){var o=this.dbList[i];if(2===o.type&&a.includes(o.title))for(var s=o.dependencies,r=0;r<s.length;r++){var l=s[r];n.set(l.name,l)}}var c=[];n.forEach((function(e){c.push(e)})),this.tables=c;for(var d=this.checkedTables,u=d.length;u>=0;u--){var h=n.get(d[u]);h||d.splice(u,1)}this.$nextTick((function(){for(var e=0;e<c.length;e++)d.includes(c[e].name)&&t.$refs.tables.toggleRowSelection(c[e])})),this.resetTableInfo()},handleTableClick:function(e){this.getTableDetail(e.name)},handleTableChange:function(e){for(var t=new Set,n=0;n<e.length;n++)t.add(e[n].name);this.checkedTables=Array.from(t)},handleTabClick:function(e,t){var n=this;"collection"===e.name?this.$nextTick((function(){n.$refs.jsonSchema.refresh()})):"collection_index"===e.name&&this.$nextTick((function(){n.$refs.tableIndex.refresh()}))},getOpenDBData:function(){var e=this;this.loading=!0,this.$api.Database_OpenDB_Search({type:2}).then((function(t){var n=t.data.opendb_pkgs;e.dbList=n,e.loading=!1})).catch((function(){e.loading=!1}))},getTableDetail:function(e){var t=this,n={sid:this.spaceid,name:e};this.$api.Database_OpenDB_Collection_Detail(n).then((function(e){var n=e.data,a=n.package,i=n.collection,o=n.data,s=n.dataType,r=n.updateTime;t.$refs.jsonSchema.setValue(i.schema||""),t.$refs.tableIndex.setValue(i.index||""),t.tablePackage=a,t.tableData="url"!==s?JSON.stringify(o,"",2):o,t.tableDataType=s,t.tableOverview={tableName:a.name.substring(a.name.indexOf("/")+1),tableTitle:a.opendb.title,contributors:a.opendb.contributors,updateTime:r?new Date(1e3*r).toISOString().replace("T"," ").replace("Z","").replace(".000",""):""},t.loading=!1})).catch((function(){t.loading=!1}))},resetTableInfo:function(){this.$refs.jsonSchema.setValue({}),this.$refs.tableIndex.setValue({}),this.tableData="",this.tableDataType="",this.tableOverview="",this.tableIndex=""},handleSearch:function(e){var t=this;this.loading=!0;var n={q:this.searchInput,type:1};this.$api.Database_OpenDB_Search(n).then((function(e){var n=e.data.opendb_pkgs;t.data=t.buildTree(n),t.loading=!1})).catch((function(){t.loading=!1}))},handleNext:function(){0===this.step?(this.step0(),this.step1()):1===this.step&&this.step2()},step0:function(){for(var e=[],t=0;t<this.checkedTables.length;t++){var n=this.checkedTables[t];e.push({name:n,opendb_collection:n})}this.newTables=e},step1:function(){var e=this;this.loading||(this.loading=!0,this.formData.spaceId=this.spaceid,this.$api.Database_Collections(this.formData).then((function(t){e.loading=!1;for(var n=t.data.collections,a=[],i=0;i<e.newTables.length;i++){var o=e.newTables[i],s=n.findIndex((function(e){return e.name===o.name}));s>=0&&a.push(o.name)}e.conflictTables=a,a.length>0?(e.step=1,e.checkedConflictTables=a.slice(0)):e.step2()})).catch((function(){e.loading=!1})))},step2:function(){for(var e=this,t=this.conflictTables.slice(0),n=function(n){var a=t[n],i=e.checkedConflictTables.findIndex((function(e){return e===a}));i>=0&&t.splice(n,1)},a=t.length-1;a>=0;a--)n(a);for(var i=this.newTables,o=function(n){var a=e.newTables[n],o=t.findIndex((function(e){return e===a.name}));o>=0&&i.splice(n,1)},s=this.newTables.length-1;s>=0;s--)o(s);!0!==this.creating&&(this.creating=!0,this.step=2,this.percentage=0,this._total=this.newTables.length,this._createTable(),window._hmt.push(["_trackEvent","云数据库","新建表","opendb创建"]))},_createTable:function(){var e=Object(he["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=Object.assign(this.newTables[0],{provider:this.formData.provider,space_id:this.formData.spaceId,appid:this.formData.appid,initData:1}),e.next=3,this.$api.Database_OpenDB_Create_Collection(t);case 3:if(this.newTables.length>0&&this.newTables.splice(0,1),this.percentage=(this._total-this.newTables.length)/this._total*100,!(this.newTables.length>0)){e.next=10;break}return e.next=8,this._createTable();case 8:e.next=12;break;case 10:this.creating=!1,this.close(!0);case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}}),fe=pe,me=(n("dac8"),Object(u["a"])(fe,de,ue,!1,null,"52dcc8df",null)),ve=me.exports,be=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"drawer-wrapper"},[n("div",{staticClass:"drawer-title"},[n("span",[e._v(e._s("imp"===e.dataMode?"数据导入":"数据导出"))]),e._v(" "),n("div",{staticClass:"drawer-button",on:{click:e.drawerClose}},[n("i",{staticClass:"el-icon-close"})])]),e._v(" "),"imp"===e.dataMode?n("el-form",{staticClass:"drawer-form",attrs:{"label-position":"top","label-width":"100px"}},[n("el-form-item",{attrs:{prop:"",label:"集合名称"}},[e._v(e._s(e.formData.collection))]),e._v(" "),n("el-form-item",{attrs:{prop:"",label:"SpaceID"}},[e._v(e._s(e.formData.spaceId))]),e._v(" "),n("el-form-item",[n("div",{attrs:{slot:"label"},slot:"label"},[n("span",{staticClass:"color"},[e._v("*")]),e._v(" "),n("span",[e._v("上传文件")])]),e._v(" "),n("div",{staticClass:"upload-wrapper"},[n("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{drag:"",action:"","file-list":e.fileList,"on-change":e.onChange,"on-remove":e.onRemove,"auto-upload":!1}},[n("i",{staticClass:"el-icon-upload"}),e._v(" "),n("div",{staticClass:"el-upload__text"},[e._v("\n            将文件拖到此处，或\n            "),n("em",[e._v("点击选择文件")]),e._v(" "),n("p",[e._v("不支持多选，只支持 .json 和 .csv 文件类型，单次上传文件最大 50M")])])])],1)]),e._v(" "),n("el-form-item",[n("div",{attrs:{slot:"label"},slot:"label"},[n("span",{staticClass:"color"},[e._v("*")]),e._v(" "),n("span",[e._v("处理冲突模式")])]),e._v(" "),n("el-select",{attrs:{placeholder:"请选择"},model:{value:e.mode,callback:function(t){e.mode=t},expression:"mode"}},[n("el-option",{attrs:{label:"insert",value:"INSERT"}}),e._v(" "),n("el-option",{attrs:{label:"upsert",value:"UPSERT"}})],1)],1)],1):n("el-form",{staticClass:"drawer-form",attrs:{"label-position":"top","label-width":"100px"}},[n("el-form-item",{attrs:{prop:"",label:"集合名称"}},[e._v(e._s(e.formData.collection))]),e._v(" "),n("el-form-item",{attrs:{prop:"",label:"SpaceID"}},[e._v(e._s(e.formData.spaceId))]),e._v(" "),n("el-form-item",[n("div",{attrs:{slot:"label"},slot:"label"},[n("span",{staticClass:"color"},[e._v("*")]),e._v(" "),n("span",[e._v("导出格式")])]),e._v(" "),n("el-select",{attrs:{disabled:e.loading,placeholder:"请选择"},model:{value:e.fileType,callback:function(t){e.fileType=t},expression:"fileType"}},[n("el-option",{attrs:{label:"JSON",value:"JSON"}}),e._v(" "),n("el-option",{attrs:{label:"CSV",value:"CSV"}})],1)],1),e._v(" "),"CSV"===e.fileType?n("el-form-item",[n("div",{attrs:{slot:"label"},slot:"label"},[n("span",{staticClass:"color"},[e._v("*")]),e._v(" "),n("span",[e._v("字段")])]),e._v(" "),n("el-input",{attrs:{disabled:e.loading,placeholder:"英文逗号隔开，csv文件类型必填"},model:{value:e.fields,callback:function(t){e.fields=t},expression:"fields"}})],1):e._e()],1),e._v(" "),n("div",{staticClass:"drawer-buttongroup"},[n("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.confirm}},[e._v("确定")]),e._v(" "),n("el-button",{attrs:{loading:e.loading},on:{click:e.drawerClose}},[e._v("取消")])],1)],1)},ge=[],_e=n("bc3a"),ye=n.n(_e),ke=n("01ea"),xe=[".json",".csv"],Ce={name:"ImportExport",props:{formData:{type:Object,default:function(){return{}}},dataMode:{type:String,default:"imp"}},data:function(){return{draerVisible:!1,mode:"INSERT",uploadUrl:ke["a"].baseURL+"/file/upload",headers:{token:""},fileList:[],fileType:"JSON",fields:"",loading:!1}},computed:Object(o["a"])({},Object(ce["b"])(["appid","is_tcb","spaceid"])),created:function(e){},mounted:function(e){},methods:{drawerClose:function(){this.$emit("close")},confirm:function(){var e=this;if("imp"===this.dataMode){if(this.loading=!0,0===this.fileList.length)return this.loading=!1,void this.$message.error("您还没有选择文件，请选择后重试");this.getDatabaseCreateImportTask().then((function(t){e.getHostAliyunUploadCredential(t.data,e.fileList[0])})).catch((function(t){e.loading=!1}))}else this.loading=!0,this.$api.Database_Create_Export_Task({provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid,collection:this.formData.collection,fileType:this.fileType,fields:this.fields}).then((function(t){var n=t.data.TaskId;e.loading=!0,e.$emit("uploadSuccess",{taskId:n,mode:"exp"})})).catch((function(){e.loading=!1}))},onChange:function(e){if("ready"===e.status){var t=e.size/1024/1024>50,n=e.name.replace(/.+\./,".").toLowerCase();if(this.fileList=[],-1===xe.indexOf(n))return void this.$message.error("只支持上传 .json 和 .csv 文件类型，请重新选择文件");if(t)return void this.$message.error("上传文件大小超过上限，请选择小于 50M 的文件上传");this.fileType=".json"===n?"JSON":"CSV",this.fileList.push(e)}},onRemove:function(){this.this.fileList=[]},getDatabaseCreateImportTask:function(){var e={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid,collection:this.formData.collection,fileType:this.fileType,mode:this.mode};return this.$api.Database_Create_Import_Task(e)},getHostAliyunUploadCredential:function(e,t){var n=this,a=e.AccessKeyId,i=e.FileKey,o=e.Host,s=e.Policy,r=e.Signature,l=e.TaskId,c=new FormData;c.append("key",i),c.append("policy",s),c.append("OSSAccessKeyId",a),c.append("Signature",r),c.append("file",t.raw),ye.a.post(o,c,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){}}).then((function(e){n.loading=!1,e.status<400&&"string"!==typeof t&&n.$emit("uploadSuccess",{taskId:l,mode:"imp"})})).catch((function(e){n.loading=!1,n.$alert("文件上传失败","警告",{confirmButtonText:"确定",type:"error",callback:function(){}})}))}}},we=Ce,De=(n("69be"),Object(u["a"])(we,be,ge,!1,null,"40995016",null)),Se=De.exports,Ne=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"custom-validate"},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.refreshing,expression:"refreshing"}],staticClass:"custom-validate-area"},[n("div",{staticClass:"flex-r p-a-d custom-validate-head"},[e._m(0),e._v(" "),n("div",{staticClass:"icon-area",on:{click:function(t){return e.openDialog()}}},[n("i",{staticClass:"el-icon-plus"})]),e._v(" "),n("div",{staticClass:"icon-area",on:{click:e.refresh}},[n("i",{staticClass:"el-icon-refresh"})])]),e._v(" "),n("div",{staticClass:"function-list"},e._l(e.functionList,(function(t,a){return n("div",{key:a,staticClass:"function-item"},[n("div",{staticClass:"function-name",on:{click:function(n){return e.getFunctionDetail(t)}}},[e._v(e._s(t))]),e._v(" "),n("div",{staticClass:"function-delete",on:{click:function(n){return e.handleDeleteFunction(t)}}},[n("i",{staticClass:"el-icon-delete"})])])})),0)]),e._v(" "),n("el-dialog",{attrs:{title:"扩展校验函数",width:"50%","close-on-click-modal":!1,"close-on-press-escape":!1,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t},open:e.onDialogOpened,close:e.onDialogClosed}},[n("el-input",{attrs:{size:"mini",placeholder:"函数名称 (字母开头，仅包含_/字母/数字)"},model:{value:e.functionName,callback:function(t){e.functionName=t},expression:"functionName"}}),e._v(" "),n("json-editor",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"jeFunction",staticClass:"m-t-d",attrs:{mode:"javascript"}}),e._v(" "),n("div",{staticClass:"flex-r m-t-d a-i-c"},[n("div",[e._v("Ctrl + Space 显示语法提示")]),e._v(" "),n("el-button",{staticClass:"m-l-a",attrs:{size:"small",type:"primary"},on:{click:e.saveFunction}},[e._v("保存")])],1)],1)],1)},Te=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"flex-f"},[e._v("扩展校验函数 "),n("a",{attrs:{href:"https://uniapp.dcloud.net.cn/uniCloud/schema?id=validatefunction",target:"_blank"}},[n("i",{staticClass:"el-icon-question"})])])}],Ie=n("8325"),je="module.exports = function (rule, value, data, callback) {\n    // rule  当前规则\n    // value 当前规则校验数据\n    // data  全部校验数据\n    // callback 回调，不支持异步，如果执行了callback，return结果无效，callback 将替换 errorMessage 属性\n    // callback('message') 字符串类型表示成功\n    return false\n  }",Oe={name:"CustomValidate",directives:{clipboard:Ie["a"]},components:{JsonEditor:ne["a"]},mixins:[s["a"]],data:function(){return{loading:!1,refreshing:!1,dialogVisible:!1,functionList:[],functionName:"",functionData:"",schemaIndex:1,schemaCacheId:""}},computed:Object(o["a"])({},Object(ce["b"])(["is_tcb","token"])),watch:{spaceid:function(e){}},created:function(){this.refresh()},methods:{openDialog:function(e){var t=this;this.dialogVisible=!0,this._oldName="",e||this.$nextTick((function(){t.updateEditorValue(je)}))},closeDialog:function(){this.dialogVisible=!1},onDialogOpened:function(){var e=this;this.$nextTick((function(){e.$refs.jeFunction.refresh()}))},onDialogClosed:function(){this.functionName="",this.updateEditorValue("")},refresh:function(){this.getFunctionList()},clipboardSuccess:function(){this.$message({message:"复制成功",type:"success",duration:1500})},updateEditorValue:function(e){this.$refs.jeFunction.jsonEditor.setValue(e)},getFunctionList:function(){var e=this;this.refreshing=!0;var t={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid};this.$api.Database_Get_Validate_Function_List(t).then((function(t){e.refreshing=!1,0===t.ret&&(e.functionList=t.data)})).catch((function(){e.refreshing=!1}))},getFunctionDetail:function(e){var t=this;this.openDialog(!0),this._oldName=e;var n={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid,name:e};this.loading=!0,this.$api.Database_Get_Validate_Function(n).then((function(n){t.loading=!1,0===n.ret&&(t.functionName=e,t._data_version=n.data.version||0,t.updateEditorValue(n.data.content))})).catch((function(){t.loading=!1}))},saveFunction:function(){var e=this,t=this._oldName,n=this.functionName,a=t===n;if(a||!this.functionList.includes(n))if(this.checkFunctionName(a?t:n)){var i="validator.js",o=this.$refs.jeFunction.getValue(),s=new FormData,r={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid,name:a?t:n,version:this._data_version};for(var l in a||(r.newName=n),r)s.append(l,r[l]);if(navigator.msSaveBlob){var c=new Blob([o],{type:"application/javascript"});s.append("attachment",c,i)}else{var d=new File([o],i,{type:"application/javascript"});s.append("attachment",d)}this.loading=!0,ye.a.post(ke["a"].baseURL+"/clientdb/save-validator",s,{headers:{"Content-Type":"multipart/form-data",token:this.token}}).then((function(t){var n=t.data;e.loading=!1,0===n.ret&&e.publishClientdb()})).catch((function(){e.loading=!1}))}else this.$alert("函数名不合法（字母开头，仅包含_/字母/数字）","警告",{confirmButtonText:"确定",type:"error",callback:function(){}});else this.$alert("扩展校验函数 "+n+" 已存在","警告",{confirmButtonText:"确定",type:"error",callback:function(){}})},publishClientdb:function(){var e=this;this.loading=!0;var t={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid};this.$api.Database_Publish_Clientdb(t).then((function(t){e.loading=!1;var n=t.ret;0===n&&(e.closeDialog(),e.refresh())})).catch((function(){e.loading=!1}))},checkFunctionName:function(e){return!!e&&/^[a-zA-Z][a-zA-Z0-9_]{0,64}$/.test(e)},handleDeleteFunction:function(e){var t=this;this.$confirm("此操作将永久删除名称为 ".concat(e," 的校验函数, 是否继续?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.deleteFunction(e)}))},deleteFunction:function(e){var t=this,n={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid,name:e};this.$api.Database_Delete_Validate_Function(n).then((function(e){0===e.ret&&t.refresh()})).catch((function(){}))}}},Ee=Oe,Fe=(n("630b"),Object(u["a"])(Ee,Ne,Te,!1,null,"1875117c",null)),$e=Fe.exports,Le=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"schema-container"},[n("div",{staticClass:"schema-header flex-r a-i-c"},[e.schemaEditing?e._e():n("div",[n("el-button",{attrs:{loading:e.loading,type:"primary",size:"mini"},on:{click:function(t){e.schemaEditing=!0}}},[e._v("编辑")])],1),e._v(" "),e.schemaEditing?n("div",[n("el-button",{attrs:{loading:e.schemaUpdating,type:"primary",size:"mini"},on:{click:e.saveJsonSchema}},[e._v("保存")]),e._v(" "),n("el-button",{attrs:{size:"mini"},on:{click:e.cancelSchemaEditing}},[e._v("取消")]),e._v(" "),n("el-button",{attrs:{size:"mini"},on:{click:e.formatJsonSchema}},[e._v("格式化")])],1):e._e(),e._v(" "),n("div",{staticStyle:{"padding-left":"15px","padding-right":"15px"}},[n("el-button",{attrs:{size:"mini"},on:{click:e.exportSchema}},[e._v("schema2code")])],1),e._v(" "),e.schemaRestore?n("div",[n("el-button",{attrs:{size:"mini"},on:{click:e.restoreCache}},[e._v("恢复上次未保存的数据")])],1):e._e(),e._v(" "),n("a",{staticClass:"opendb-link m-l-a",attrs:{href:"https://uniapp.dcloud.net.cn/uniCloud/schema",target:"_blank"}},[e._v("参考DB Schema规范")])]),e._v(" "),n("div",{staticClass:"flex-f json-editor-area scroll-hidden"},[n("json-editor",{ref:"jeSchema",staticClass:"flex-f json-schema",class:{"json-schema-readonly":!e.schemaEditing},attrs:{"cache-id":e.schemaCacheId,"read-only":!e.schemaEditing}})],1),e._v(" "),n("json-schema-export",{ref:"schemaExport"})],1)},Be=[],Ae=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"schema-export"},[n("el-dialog",{attrs:{width:"70%","close-on-click-modal":!1,"close-on-press-escape":!1,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t},open:e.onDialogOpened,close:e.onDialogClosed}},[n("div",{attrs:{name:"title"}},[n("span",{staticClass:"dialog-title"},[e._v("schema2code (HBuilderX 3.1.0+ 支持)")]),e._v(" "),n("a",{staticClass:"to-link",attrs:{href:"https://uniapp.dcloud.net.cn/uniCloud/schema?id=%e5%a6%82%e4%bd%95%e7%bc%96%e5%86%99db-schema",target:"_blank"}},[e._v("推荐在HBuilderX里编辑DB Schema")]),e._v("、"),n("a",{staticClass:"to-link",attrs:{href:"https://uniapp.dcloud.net.cn/uniCloud/schema?id=autocode",target:"_blank"}},[e._v("什么是schema2code？")])]),e._v(" "),n("el-tabs",{attrs:{loading:"loading"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[n("el-tab-pane",{attrs:{name:"tab1",label:"前端页面"}},[n("export-form",{ref:"exportForm"})],1),e._v(" "),n("el-tab-pane",{attrs:{name:"tab2",label:"uniCloud admin页面"}},[n("export-admin",{ref:"exportAdmin"})],1)],1)],1)],1)},Me=[],Re=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"schema-export"},[n("div",{staticClass:"flex-r dialog-content"},[n("div",{staticClass:"group"},[n("div",{staticClass:"group-h"},[n("b",[e._v("表名:")]),e._v("\n        "+e._s(e.tableName)+"\n      ")]),e._v(" "),n("div",{staticClass:"group-c"},[n("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选所有字段")]),e._v(" "),n("div",{staticClass:"p-t-b"}),e._v(" "),n("el-checkbox-group",{on:{change:e.handleCheckedChange},model:{value:e.checkedMembers,callback:function(t){e.checkedMembers=t},expression:"checkedMembers"}},e._l(e.members,(function(e){return n("el-checkbox",{key:e,staticClass:"member-item",attrs:{label:e}})})),1)],1)]),e._v(" "),n("div",{staticClass:"group file-tree"},[n("div",{staticClass:"group-h"},[e._v("导出文件清单")]),e._v(" "),n("div",{staticClass:"group-c",staticStyle:{padding:"0 5px"}},[n("el-radio-group",{staticStyle:{margin:"10px 5px"},model:{value:e.exportMode,callback:function(t){e.exportMode=t},expression:"exportMode"}},[n("el-radio",{attrs:{label:"mode_project"}},[e._v("项目模式")]),e._v(" "),n("el-radio",{attrs:{label:"mode_uni_modules"}},[e._v("uni_modules模式")])],1),e._v(" "),n("el-tree",{directives:[{name:"show",rawName:"v-show",value:"mode_project"==e.exportMode,expression:"exportMode=='mode_project'"}],attrs:{data:e.exportFiles,props:e.defaultProps,"node-key":"id","default-expanded-keys":e.expandedKeys,"highlight-current":!0},on:{"node-click":e.handleNodeClick}}),e._v(" "),n("el-tree",{directives:[{name:"show",rawName:"v-show",value:"mode_uni_modules"==e.exportMode,expression:"exportMode=='mode_uni_modules'"}],attrs:{data:e.exportUniModules,props:e.defaultProps,"node-key":"id","default-expand-all":!0,"highlight-current":!0},on:{"node-click":e.handleNodeClick}})],1)]),e._v(" "),n("div",{staticClass:"group flex-f"},[n("div",{staticClass:"group-h"},[e._v("文件预览")]),e._v(" "),n("json-editor",{ref:"jsonEditorOutput",staticClass:"json-schema json-schema-in-dialog",attrs:{mode:"vue"},model:{value:e.pageData,callback:function(t){e.pageData=t},expression:"pageData"}})],1)]),e._v(" "),n("div",{staticClass:"flex-r"},[n("div",{staticClass:"m-l-a p-t-b flex-r"},[n("el-button",{staticClass:"flex-f",attrs:{size:"mini"},on:{click:function(t){return e.downloadAndImport(0)}}},[e._v("下载zip")]),e._v(" "),n("el-button",{staticClass:"flex-f",attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.downloadAndImport(1)}}},[e._v("导入到HBuilderX")])],1)])])},Pe=[],Ve=n("c4e3"),ze=n.n(Ve),Ke=n("2909"),qe=n("ade3"),Ue=(n("3b2b"),"\n// 表单校验规则由 schema2code 生成，不建议直接修改校验规则，而建议通过 schema2code 生成, 详情: https://uniapp.dcloud.net.cn/uniCloud/schema\n\n{import}\n\nconst validator = {validator}\n\nconst enumConverter = {enumConverter}\n\nexport { validator, enumConverter }\n"),Je="\r\n",We="<uni-forms-item {attributes}>\n  {children}\n</uni-forms-item>",He="<{name} {attributes} />",Ge="<{name} {attributes}></{name}>",Ze="<{name} {attributes}>\n  {children}\n</{name}>",Qe="<uni-group>{children}</uni-group>",Ye=["input","textarea","switch","slider","picker","checkbox-group","radio-group"],Xe={input:"@input",textarea:"@input",switch:"@change",slider:"@change",picker:"@change","checkbox-group":"@change","radio-group":"@change"},et={"@input":"binddata('{name}', $event.detail.value)","@change":"binddata('{name}', $event.detail.value)"},tt={"checkbox-group":'<label class="radio-box">\n    <checkbox class="radio" value="{value}" />{label}\n  </label>',"radio-group":'<label class="radio-box">\n    <radio class="radio" value="{value}" />{label}\n  </label>'},nt={Key:"key",Label:"label",Children:"children",Name:"name",Attributes:"attributes",FormContent:"formContent",FormData:"formData",Rules:"rules",Fields:"fields"},at=[["bsonType"],["arrayType"],["minimum","maximum","exclusiveMinimum","exclusiveMaximum"],["minLength","maxLength"],["enum"],["format"],["pattern"]],it={Show:"componentForShow",Edit:"componentForEdit"},ot={enum:"range",bsonType:"format"},st={switch:":checked",slider:":value","uni-easyinput":"v-model","uni-data-checkbox":"v-model","uni-data-picker":"v-model","uni-file-picker":"v-model"},rt=["label","defaultValue"],lt={input:"uni-input-border",textarea:"uni-textarea-border"},ct=["picker","textarea","uni-data-picker"],dt={"uni-forms":{include:["uni-dateformat"]},"uni-list":{include:["uni-badge","uni-icons"]},"uni-data-picker":{include:["uni-load-more"]},"uni-file-picker":{include:["uni-link"]},"uni-datetime-picker":{include:[]},"uni-data-checkbox":{include:["uni-load-more"]},"uni-easyinput":{include:["uni-load-more"]},"uni-group":{include:[]},"uni-fab":{include:[]}};function ut(e,t){var n=e.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"'+$1+'").split("\t").join("';").split("%>").join("s+='").split("\r").join("\\'")+"';}return s",a=new Function("obj","var s='';with(obj){s+='"+n);return a(t||{})}function ht(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=e;for(var i in t){var o=null;o=n?new RegExp("{"+i+"}","g"):new RegExp("{"+i+"}"),a=a.replace(o,t[i])}return a}function pt(e,t,n){var a=new RegExp("{"+t+"}","g");return e=e.replace(a,n),e}var ft=function(){function e(){Object(_["a"])(this,e),Object(qe["a"])(this,"TITLE","SchemaBuilder:: ")}return Object(y["a"])(e,[{key:"assert",value:function(e,t){if(!e)throw 1===arguments.length?new Error(this.TITLE+"Debug Assert False"):new Error(this.TITLE+"Debug Assert: "+t)}},{key:"fail",value:function(e,t){1===arguments.length?new Error(this.TITLE+"Debug Fail: "+e):new Error(this.TITLE+"Debug Fail: "+e+" detailMessage: "+t)}},{key:"isDefault",value:function(e){throw new Error("close")}},{key:"isNotNull",value:function(e){if(null===e)throw new Error(this.TITLE+"isNotNull")}},{key:"close",value:function(){throw new Error(this.TITLE+"close")}}]),e}(),mt=new ft,vt=function(){function e(){Object(_["a"])(this,e),this._schema=null,this._referenceSchema=[],this._enums={},this._enumForeignkeys={},this._enumStatic={},this._foreignkeys=[],this._validateFunctions=[],this._ruleFields=""}return Object(y["a"])(e,[{key:"load",value:function(e){var t="object"===Object(g["a"])(e)?JSON.parse(JSON.stringify(e)):JSON.parse(e);return this._enumStatic={},this._enumForeignkeys={},this._referenceSchema=[],this._foreignkeys=[],this._validateFunctions=[],this._schema=this._resolve(t),this._schema.required||(this._schema.required=[]),this}},{key:"filter",value:function(e){var t=this._schema,n=t.required,a=t.permission,i=t.componentForEdit,o=t.componentForShow,s=t.properties;if(Array.isArray(e)&&e.length>0){for(var r=[],l=0;l<s.length;l++){var c=s[l];e.indexOf(c.key)>-1&&r.push(c)}return{required:n,fields:e,componentForEdit:i,componentForShow:o,properties:r}}return{required:n,fields:e,componentForEdit:i,componentForShow:o,permission:a,properties:s}}},{key:"resolveForeignkeyFields",value:function(e){for(var t=e.slice(0),n=this._enumForeignkeys,a=0;a<t.length;a++){var i=t[a];n[i]&&(t[a]="".concat(i,"{").concat(n[i],"}"))}return t}},{key:"_resolve",value:function(t){var n=t.required,a=t.permission,i=t.properties,o=[],s=[],r=[],l=[],c=[],d=[];for(var u in i){var h=i[u];e.EXCLUDE_FIELD_LIST.indexOf(u)>-1||(d.push({key:u,value:h}),h.component&&!h.componentForEdit&&(h.componentForEdit=h.component),void 0!==h.componentForEdit&&c.push(u),void 0!==h.componentForShow&&l.push(u),s.push(u),this._defaultField(h)&&o.push(u),this._processEnum(u,h),this._processTree(h),this._processValidateFunction(h),h.properties&&(h.properties=this._resolve(h)))}return d.sort(this._sortComparer),{required:n,componentForEdit:c,componentForShow:l,permission:a,fields:o,allFields:s,noPasswordFields:r,properties:d}}},{key:"_defaultField",value:function(e){return"password"!==e.bsonType&&(!e.forceDefaultValue&&(!e.permission||!1!==e.permission["write"]&&!1!==e.permission[".write"]))}},{key:"_processEnum",value:function(e,t){if(t.enum)if(Array.isArray(t.enum))this._enumStatic[e]=1;else if(t.enum.collection&&t.enum.field){for(var n=t.enum.field,a=n.split(","),i="",o=0;o<a.length;o++){var s=a[o].split("as");if(!(s.length<2)&&(this._foreignkeys.push(t.enum.collection),"text"===s[1].trim())){i=s[0].trim();break}}i&&(this._enumForeignkeys[e]=i)}}},{key:"_processTree",value:function(e){e.enum&&e.enumType&&"tree"===e.enumType&&e.enum.collection&&this._referenceSchema.push(e.enum.collection)}},{key:"_processValidateFunction",value:function(e){var t=e.validateFunction;if("object"===Object(g["a"])(t)){var n=t,a=n.name,i=n.client;if(t=a,!1===i)return}t&&this._validateFunctions.push(t)}},{key:"_sortComparer",value:function(e,t){return e.order>t.order?1:e.order<t.order?-1:0}},{key:"schema",get:function(){return this._schema}},{key:"fields",get:function(){return this._schema.fields}},{key:"allFields",get:function(){return this._schema.allFields}},{key:"foreignkeys",get:function(){return Array.from(new Set(this._foreignkeys))}},{key:"enumStatic",get:function(){return this._enumStatic}},{key:"enumForeignkeys",get:function(){return this._enumForeignkeys}},{key:"noPasswordFields",get:function(){return this._schema.noPasswordFields}},{key:"hasPassword",get:function(){return this.fields.length!==this.noPasswordFields.length}},{key:"referenceSchema",get:function(){return this._referenceSchema}},{key:"validateFunctions",get:function(){return this._validateFunctions}}]),e}();Object(qe["a"])(vt,"EXCLUDE_FIELD_LIST",["_id"]);var bt=function(){function e(){Object(_["a"])(this,e)}return Object(y["a"])(e,[{key:"build",value:function(e){this._i18n={};for(var t=e.properties,n=0;n<t.length;n++){var a=t[n];this.processNode(a.key,a.value)}}},{key:"processNode",value:function(t,n){for(var a=this._i18n,i=e.LocaleFields,o=0;o<i.length;o++){var s=i[o],r=n[s];if("object"===Object(g["a"])(r))for(var l in r){var c=r[l];a[l]||(a[l]={}),a[l][t]||(a[l][t]={}),a[l][t][s]=c}}n.enum&&this.processEnum(t,n),n.errorMessage&&this.processErrorMessage(t,n),(n.componentForEdit||n.componentForShow)&&this.processComponent(t,n)}},{key:"processEnum",value:function(e,t){var n=t.enum;if(n&&n.length&&"object"===Object(g["a"])(n[0].text))for(var a=this._i18n,i=0;i<n.length;i++){var o=n[i],s=o.value,r=o.text;for(var l in r)a[l]||(a[l]={}),a[l][e]||(a[l][e]={}),a[l][e].enum||(a[l][e].enum=[]),a[l][e].enum.push({value:s,text:r[l]})}}},{key:"processErrorMessage",value:function(t,n){var a=n.errorMessage;if(a&&"object"===Object(g["a"])(a)){var i=this._i18n,o=e.ErrorMessage;for(var s in a){var r=a[s];if(o.includes(s)&&"object"===Object(g["a"])(r))for(var l in r)this.undefinedToObject(i,[l,t,"errorMessage"]),i[l][t].errorMessage[s]=r[l];else o.includes(s)||"string"!==typeof r||(this.undefinedToObject(i,[s,t,"errorMessage"]),i[s][t].errorMessage=a[s])}}}},{key:"processComponent",value:function(e,t){t.componentForEdit&&"object"===Object(g["a"])(t.componentForEdit.props)&&this.processComponentProps(e,t.componentForEdit.props,"componentForEdit"),t.componentForShow&&"object"===Object(g["a"])(t.componentForShow.props)&&this.processComponentProps(e,t.componentForShow.props,"componentForShow")}},{key:"processComponentProps",value:function(e,t,n){var a=this._i18n;for(var i in t){var o=t[i];if("object"===Object(g["a"])(o))for(var s in o)this.undefinedToObject(a,[s,e,n,"props",i]),a[s][e][n]["props"][i]=o[s]}}},{key:"undefinedToObject",value:function(e,t){for(var n=e,a=0;a<t.length;a++){var i=t[a];n[i]||(n[i]={}),n=n[i]}}}]),e}();Object(qe["a"])(bt,"LocaleFields",["title","label","description"]),Object(qe["a"])(bt,"ErrorMessage",["required","minimum","maximum","exclusiveMinimum","exclusiveMaximum","minLength","maxLength","format","pattern"]);var gt=function(){function e(){Object(_["a"])(this,e),this._imports=""}return Object(y["a"])(e,[{key:"build",value:function(e){var t=e.required,n=e.properties;this._validator=new Set;for(var a={},i=0;i<n.length;i++){var o=n[i],s=this._buildRule(t,o.key,o.value,o);Object.keys(s).length>0&&(a[o.key]=s)}this._imports=this.buildImports(),this._enumDataString=JSON.stringify(this._buildEnumData(n),null,2)||"{}";var r=JSON.stringify(a,null,2);return r=this._processFunctionString(r,['"validateExpr": "function','validateFunction": "']),r=Ue.replace(/\{import\}/,this.imports).replace(/\{validator\}/,r).replace(/\{enumConverter\}/,this._enumDataString),r}},{key:"buildImports",value:function(){for(var e=this.validators,t=[],n=0;n<e.length;n++){var a=e[n];t.push("import ".concat(a," from './validateFunction/").concat(a,".js'"))}return t.join(Je)}},{key:"_buildRule",value:function(e,t,n,a){var i=n.errorMessage,o=[];if(e.indexOf(t)>-1){var s={required:!0};i&&(s.errorMessage="string"===typeof i?i:i["required"]||""),o.push(s)}for(var r=0;r<at.length;r++){for(var l={},c=at[r],d=0;d<c.length;d++){var u=c[d];"arrayType"===ot[u]&&"array"!==a.bsonType||void 0!==n[u]&&(l[ot[u]||u]=n[u])}if(l.range&&!Array.isArray(l.range)&&delete l.range,Object.keys(l).length>0&&void 0!==i)if("string"===typeof i)l.errorMessage=i;else if("object"===Object(g["a"])(i)){var h=c.findIndex((function(e){return void 0!==i[e]}));l.errorMessage=i[c[h]]}Object.keys(l).length>0&&o.push(l)}this._addValidateFunction(o,n);var p={rules:o};return this._processDefaultProperties(p,n),p}},{key:"_buildEnumData",value:function(e){for(var t={},n=0;n<e.length;n++){var a=e[n],i=a.key,o=a.value;if(o.enum&&Array.isArray(o.enum)&&o.enum.length&&"object"===Object(g["a"])(o.enum[0])){var s={};if("int"===o.bsonType||"string"===o.bsonType)for(var r=0;r<o.enum.length;r++){var l=o.enum[r];s[l.value]=l.text}else s=o.enum;t[i+"_valuetotext"]=s}}return t}},{key:"_addValidateFunction",value:function(e,t){var n=t.validateFunction;if("object"===Object(g["a"])(n)){var a=n,i=a.name,o=a.client;if(n=i,!1===o)return}n&&(e.push({validateFunction:"".concat(n)}),this._validator.add(n))}},{key:"_processFunctionString",value:function(e,t){for(var n=e.split("\n"),a=0;a<n.length;a++)for(var i=n[a],o=0;o<t.length;o++){var s=t[o];if(i.includes(s)){n[a]=i.replace(/\"/g,"");break}}return n.join("\n")}},{key:"_processDefaultProperties",value:function(e,t){for(var n=0;n<rt.length;n++){var a=rt[n];void 0!==t[a]&&(e[a]=t[a])}void 0===e.label&&void 0!==t.title&&(e.label=t.title)}},{key:"validators",get:function(){return Array.from(this._validator)}},{key:"imports",get:function(){return this._imports}}]),e}(),_t=function(){function e(){Object(_["a"])(this,e),this._formTemplate=null,this._formData=null,this._formBuilderDefault=new kt,this._formShowBuilderDefault=new xt,this._components=[],this._schema=null}return Object(y["a"])(e,[{key:"load",value:function(e,t){this._schema=e,this._components=[],this._formBuilderDefault.referenceSchema=t,this._formShowBuilderDefault.referenceSchema=t;var n=this._fixComponent(e),a=n.required,i=n.properties;this._required=a,this._properties=i}},{key:"build",value:function(e){var t=this._schema;return this._formData=this._buildFormData(t,e),this._formOptions=this._buildFormOptions(t,e),this._formTemplate=this._buildForm(this._processGroup(this._properties),t.required,e),{collection:e.collection,formTemplate:this._formTemplate,formData:this._formData,formOptions:this._formOptions}}},{key:"_fixComponent",value:function(e){for(var t=e.required,n=e.properties,a=Object.keys(lt),i=[],o=[],s=0;s<n.length;s++){var r=n[s],l=r.key,c=r["value"],d=t.includes(l),u=c.componentForEdit||c.component;u||(u=this._formBuilderDefault.getComponent(l,c,it.Edit,d)),u&&(c.componentForEdit=u,this._components.push(u.name));var h=c.componentForShow;h||(h=this._formShowBuilderDefault.getComponent(l,c,d)),h&&(c.componentForShow=h,this._components.push(h.name)),(c.componentForEdit||c.componentForShow)&&(o.push(r),i.push(l),Ct.fixDefaultProperties(a,l,c,it.Edit))}return{required:i,properties:o}}},{key:"_buildForm",value:function(e,t,n){for(var a=new Array(e.length),i=0;i<e.length;i++){var o=e[i],s=void 0;s=o.type&&"group"===o.type?this._buildFormGroup(o,t,n):this._buildComponent(o,t,n),a[i]=s}return a.join(Je)}},{key:"_buildFormData",value:function(e,t){for(var n=e.required,a=e.properties,i=e.fields,o=e[t.pageType],s={},r=0;r<a.length;r++){var l=a[r],c=l.key,d=l.value;(i.indexOf(c)>-1||o.indexOf(c)>-1)&&(s[c]=Ct.getDefaultValue(d,n.includes(c),t.pageType))}return JSON.stringify(s,null,2)}},{key:"_buildFormOptions",value:function(e,t){for(var n=e.properties,a=e.fields,i=e[t.pageType],o={},s=0;s<n.length;s++){var r=n[s],l=r.key,c=r.value;(a.indexOf(l)>-1||i.indexOf(l)>-1)&&c.enum&&Array.isArray(c.enum)&&(o["".concat(l,"_localdata")]=c.enum.slice(0))}return JSON.stringify(o,null,2)}},{key:"_processGroup",value:function(e){for(var t=[],n={},a=0;a<e.length;a++){var i=e[a],o=i.value.group;void 0!==o?(n[o]||(n[o]={type:"group",title:o,children:[]},t.push(n[o])),n[o].children.push(i)):t.push(i)}return t}},{key:"_buildFormGroup",value:function(e,t,n){for(var a=new Array(e.children.length),i=0;i<e.children.length;i++){var o=e.children[i];a[i]=this._buildComponent(o,t,n)}var s=this._formatAll(Qe,{children:a.join(Je)});return s}},{key:"_buildComponent",value:function(e,t,n){var a=this,i=e.key,o=e.value,s=e.value[n.pageType],r="";if(Array.isArray(s)){var l=[];s.forEach((function(e){l.push(a._buildComponentChild(i,e,n))})),r=l.join(Je)}else r=this._buildComponentChild(i,s,n);var c=t.includes(i);return this._buildFormItem(i,o,c,r)}},{key:"_buildFormItem",value:function(e,t,n,a){var i=[],o={name:e,label:t.label||t.title||""};for(var s in o){var r=s,l=o[s];i.push("".concat(r,'="').concat(l,'"'))}n&&i.push("required");var c=i.join(" ");return this._formatAll(We,Object(qe["a"])({attributes:c},nt.Children,a))}},{key:"_buildComponentChild",value:function(e,t,n){var a="",i=t.name,o=t.childrenData,s=t.children;if(o||s){var r;tt[t.name]&&(t.children=tt[i]);var l="";if(o){for(var c=[],d=0;d<o.length;d++){var u=o[d];c.push(this._formatAll(t.children,u))}l=c.join(Je)}else l=t.children;a=this._formatAll(Ze,(r={},Object(qe["a"])(r,nt.Name,i),Object(qe["a"])(r,nt.Attributes,this._buildAttributes(e,t,n)),Object(qe["a"])(r,nt.Children,l),r),!0)}else{var h,p=ct.includes(i)?Ge:He;a=this._formatAll(p,(h={},Object(qe["a"])(h,nt.Name,i),Object(qe["a"])(h,nt.Attributes,this._buildAttributes(e,t,n)),h),!0)}return a}},{key:"_buildAttributes",value:function(e,t,n){var a=t.props,i=[];for(var o in a){var s=o,r=a[o];"string"!==typeof r&&(s=":"+s),Array.isArray(r)&&(r=JSON.stringify(r)),s=s.replace(/::/g,":"),i.push("".concat(s,'="').concat(r,'"'))}return i.join(" ")}},{key:"_format",value:function(e,t,n){var a=new RegExp("{"+t+"}","g");return e=e.replace(a,n),e}},{key:"_formatAll",value:function(e,t,n){var a=e;for(var i in t){var o=null;o=n?new RegExp("{"+i+"}","g"):new RegExp("{"+i+"}"),a=a.replace(o,t[i])}return a}},{key:"formTemplate",get:function(){return this._formTemplate}},{key:"formData",get:function(){return this._formData}},{key:"components",get:function(){return this._components}},{key:"properties",get:function(){return this._properties}}]),e}(),yt=function(){function e(){Object(_["a"])(this,e),this._formTemplate=null,this._formData=null,this._formBuilderDefault=new kt,this._components=[],this._schema=null}return Object(y["a"])(e,[{key:"build",value:function(e){}},{key:"formTemplate",get:function(){return this._formTemplate}},{key:"formData",get:function(){return this._formData}},{key:"components",get:function(){return this._components}}]),e}(),kt=function(){function e(){Object(_["a"])(this,e),this._referenceSchema=null}return Object(y["a"])(e,[{key:"getComponent",value:function(e,t,n,a){if(t.enumType&&"tree"===t.enumType)return this._tree(e,t);if(t.enum)return this._array(e,t);if("file"===t.bsonType)return this._file(e,t);if("array"===t.bsonType&&"file"===t.arrayType)return this._file(e,t,!0);switch(t.bsonType){case"array":return this._array(e,t);case"string":case"password":return this._string(t,a);case"int":case"double":return this._number(t,a);case"bool":return this._bool(t);case"timestamp":return this._timestamp(t);case"fileurls":return this._fileurls(t)}return null}},{key:"process",value:function(e,t,n,a){if(t.enumType&&"tree"===t.enumType)this._tree(e,t);else if(t.enum)this._array(e,t);else switch(t.bsonType){case"array":this._array(e,t);break;case"string":case"password":this._string(t,a);break;case"int":this._number(t,a);break;case"bool":this._bool(t);break;case"timestamp":this._timestamp(t);break;case"fileurls":this._fileurls(t);break}}},{key:"_getParentkey",value:function(){for(var e="",t="",n=this._referenceSchema.properties,a=0;a<n.length;a++){var i=n[a],o=i.key,s=i.value;if(s.parentKey){t=s.parentKey,e=o;break}}return{parentKey:e,selfKey:t}}},{key:"_file",value:function(t,n,a){var i={};return n.fileMediaType&&(i["file-mediatype"]=n.fileMediaType),n.fileExtName&&(i["file-extname"]=n.fileExtName),e.FILE_PROPERTIES.forEach((function(t){void 0!==n[t]&&(i[e.FILE_MAPPING[t]]=n[t])})),i["return-type"]=!0===a?"array":"object",{name:"uni-file-picker",props:i}}},{key:"_tree",value:function(t,n){var a={};e.ENUM_PROPERTIES.forEach((function(t){void 0!==n[t]&&(a[e.ENUM_MAPPING[t]]=n[t])}));var i=this._getParentkey(),o=i.selfKey,s=i.parentKey;return o&&(a["self-field"]=o),s&&(a["parent-field"]=s),{name:"uni-data-picker",props:a}}},{key:"_picker",value:function(e,t){return{name:"picker",props:{":range":"formOptions.".concat(e,"_range")},children:"<view>{{formData.".concat(e," === -1 ? '").concat(t.description||"","' : formOptions.").concat(e,"_range[formData.").concat(e,"]}}</view>")}}},{key:"_array",value:function(t,n){var a={};return e.ENUM_PROPERTIES.forEach((function(t){void 0!==n[t]&&(a[e.ENUM_MAPPING[t]]=n[t])})),"array"===n.bsonType&&(a.multiple=!0),{name:"uni-data-checkbox",props:a}}},{key:"_string",value:function(e){var t={};return void 0!==e.description&&(t.placeholder=e.description),{name:"uni-easyinput",props:t}}},{key:"_number",value:function(t,n){var a=n&&(void 0!==t.minimum||void 0!==t.maximum),i=a?"slider":"uni-easyinput",o={};return a?(e.STEP_PROPERTIES.forEach((function(n){void 0!==t[n]&&(o[e.STEP_MAPPING[n]]=t[n])})),o["show-value"]=!0):(void 0!==t.description&&(o.placeholder=t.description),o.type="number"),{name:i,props:o}}},{key:"_bool",value:function(e){return{name:"switch"}}},{key:"_timestamp",value:function(e){var t={"return-type":"timestamp"};return{name:"uni-datetime-picker",props:t}}},{key:"_fileurls",value:function(e){var t={};return{name:"uni-file-picker",props:t}}},{key:"referenceSchema",get:function(){return this._referenceSchema},set:function(e){this._referenceSchema=e}}]),e}();Object(qe["a"])(kt,"STEP_PROPERTIES",["minimum","maximum"]),Object(qe["a"])(kt,"STEP_MAPPING",{minimum:":min",maximum:":max"}),Object(qe["a"])(kt,"ENUM_PROPERTIES",["minLength","maxLength"]),Object(qe["a"])(kt,"ENUM_MAPPING",{minLength:":min",maxLength:":max"}),Object(qe["a"])(kt,"FILE_PROPERTIES",["maxLength"]),Object(qe["a"])(kt,"FILE_MAPPING",{maxLength:":limit"});var xt=function(){function e(){Object(_["a"])(this,e),this._referenceSchema=null}return Object(y["a"])(e,[{key:"getComponent",value:function(e,t,n){switch(t.bsonType){case"timestamp":return this._timestamp(t)}return null}},{key:"_timestamp",value:function(e){var t={timestamp:!0};return{name:"uni-datetime-picker",props:t}}},{key:"referenceSchema",get:function(){return this._referenceSchema},set:function(e){this._referenceSchema=e}}]),e}();Object(qe["a"])(xt,"STEP_PROPERTIES",["minimum","maximum"]),Object(qe["a"])(xt,"STEP_MAPPING",{minimum:":min",maximum:":max"}),Object(qe["a"])(xt,"ENUM_PROPERTIES",["minLength","maxLength"]),Object(qe["a"])(xt,"ENUM_MAPPING",{minLength:":min",maxLength:":max"});var Ct=function(){function e(){Object(_["a"])(this,e)}return Object(y["a"])(e,null,[{key:"getDefaultValue",value:function(e,t,n){var a=e.bsonType,i=e.defaultValue,o=e[n],s=o||{},r=s.props;return o&&r&&void 0!==r.value?r.value:void 0===i||"object"===Object(g["a"])(i)&&Object.keys(i).includes("$env")?"array"===a||"fileArray"===a?[]:"string"===a?"":"int"!==a||!t||void 0===e.minimum&&void 0===e.maximum?null:void 0!==e.minimum?e.minimum:0:i}},{key:"isUniDataComponent",value:function(e,t){var n=e[t]||{};return n.name.includes("uni-data-")}},{key:"isClientdbComponent",value:function(e,t){var n=e[t]||{};return n.name.includes("uni-data-")&&e.enum&&!Array.isArray(e.enum)}},{key:"fixDefaultProperties",value:function(t,n,a,i){var o=a[i],s=o.name;o.props||(o.props={});var r=o.props;if(Ye.includes(s)){var l=Xe[s];void 0===r[l]&&(r[l]=pt(et[l],"name",n))}if(t.includes(s)){r.class||(r.class="");var c=lt[s];r.class.includes(c)||(r.class=(r.class+" "+c).trim())}if(st[s]?r[st[s]]="formData.".concat(n):r[":value"]="formData.".concat(n),e.isClientdbComponent(a,i)){var d=a.enum;for(var u in d)r[u]=d[u]}else e.isUniDataComponent(a,i)&&a.enum&&(r[":localdata"]="formOptions.".concat(n,"_localdata"));"password"===a.bsonType&&(o.name="uni-easyinput",r.type="password"),"string"===a.bsonType&&a.trim&&(r.trim=a.trim)}}]),e}(),wt=function(){function e(){Object(_["a"])(this,e)}return Object(y["a"])(e,[{key:"build",value:function(e,t,n){for(var a=t||["add","edit"],i=n||["新增","修改",""],o=new Array(a.length),s=0;s<a.length;s++){var r={navigationBarTitleText:i[s]},l={path:"pages/"+e+"/"+a[s],style:r};o[s]=l}return{pages:o,globalStyle:{navigationBarTextStyle:"black",navigationBarTitleText:"uni-app",navigationBarBackgroundColor:"#F8F8F8",backgroundColor:"#F8F8F8"}}}}]),e}(),Dt=function(){function e(){Object(_["a"])(this,e),this._uni=[],this._admin=[],this._uniModules=[]}return Object(y["a"])(e,[{key:"reset",value:function(){this._uni=[],this._admin=[],this._uniModules=[]}},{key:"build",value:function(t){this.reset(),this._validators=t.validators,this._collection=t.collection,this._components=t.components,this._uni=this.buildUni(this._components),this._admin=this.buildAdmin(this._components),this._uniModules=this.buildUniModules(e.pages),this._adminUniModules=this.buildUniModules(e.pagesAdmin)}},{key:"buildUni",value:function(t){var n=[],a=this.buildValidator();n.push({id:"js_sdk",label:"js_sdk",children:[{label:"validator",children:a}]});var i=this.buildPage(e.pages);n.push({id:"pages",label:"pages",children:[{id:"pages_children",label:this._collection,children:i}]});var o=this.buildComponent(t);return n.push({label:"uni_modules",children:o}),n.push({label:"pages.json",command:"pages"}),n}},{key:"buildAdmin",value:function(t){var n=[],a=this.buildValidator();n.push({id:"js_sdk",label:"js_sdk",children:[{label:"validator",children:a}]});var i=this.buildPage(e.pagesAdmin);n.push({id:"pages",label:"pages",children:[{id:"pages_children",label:this._collection,children:i}]});var o=this.buildComponent(t);return n.push({label:"uni_modules",children:o}),n.push({label:"pages.json",command:"pages"}),n}},{key:"buildUniModules",value:function(e){var t=[],n=[{label:"uni_modules",children:[{label:this._collection,children:t}]}];t.push({label:"uniCloud",children:[{label:"database",children:[{label:this._collection+".schema.json",command:"schema_json"}]}]});var a=this.buildValidator();t.push({label:"js_sdk",children:[{label:"validator",children:a}]});var i=this.buildPage(e);return t.push({label:"pages",children:[{label:this._collection,children:i}]}),t.push({label:"changelog.md",command:"changelog_md"},{label:"package.json",command:"package_json"},{label:"readme.md",command:"readme_md"}),n}},{key:"buildPage",value:function(e){var t=[];return e.forEach((function(e){var n=e+".vue",a="page_"+e;t.push({label:n,command:a})})),t}},{key:"buildComponent",value:function(e){var t=[];return e.forEach((function(e){t.push({label:e,children:[{label:e+".vue"}]})})),t}},{key:"buildValidator",value:function(){var e=[];this._validators.forEach((function(t){e.push({label:t+".js"})}));var t=[];return e.length&&t.push({label:"validateFunction",children:e}),t.push({label:this._collection+".js",command:"validatorClient"}),t}},{key:"uni",get:function(){return this._uni}},{key:"admin",get:function(){return this._admin}},{key:"uniModules",get:function(){return this._uniModules}},{key:"adminUniModules",get:function(){return this._adminUniModules}}]),e}();Object(qe["a"])(Dt,"pages",["add","edit","list","detail"]),Object(qe["a"])(Dt,"pagesAdmin",["add","edit","list"]);var St=function(){function e(){Object(_["a"])(this,e)}return Object(y["a"])(e,[{key:"build",value:function(t){for(var n=t.permission,a=t.properties,i=n||e.default,o=0;o<a.length;o++){var s=a[o],r=s.key,l=s.value;void 0!==l["db-permission"]&&(i[r]=l["db-permission"])}return e.tpl.replace(/\{permission\}/,JSON.stringify(i,null,2))}}]),e}();Object(qe["a"])(St,"tpl","module.exports = {permission}"),Object(qe["a"])(St,"default",{read:!1,create:!1,delete:!1,update:!1});var Nt=function(){function e(){Object(_["a"])(this,e),this._loader=new vt,this._locale=new bt,this._ruleBuilder=new gt,this._formBuilder=new _t,this._pageBuilder=new wt,this._formBuilderShow=new yt,this._permissionBuilder=new St,this._fileTreeBuilder=new Dt,this._collectionQuery=""}return Object(y["a"])(e,[{key:"load",value:function(e){return mt.assert(e,"schema invalid"),this._loader.load(e),this._loader.schema}},{key:"build",value:function(t,n){var a=n.collection,i=n.referenceSchema;this._collection=a;var o=this._loader.schema.components,s=this._loader.filter(t),r=this._ruleBuilder.build(s),l=this.buildFormPage(s,a,i),c=this._permissionBuilder.build(this._loader.schema),d=JSON.stringify(this._pageBuilder.build(a),null,2);return this._fileTreeBuilder.build({collection:a,validators:this._ruleBuilder.validators,components:e.includeComponents}),{components:o,formPage:l,permission:c,validatorClient:r,pages:d}}},{key:"buildFormPage",value:function(e,t,n){var a;n&&(a=(new vt).load(n).schema),this._formBuilder.load(e,a);var i=this._formBuilder.build({pageType:it.Edit,collection:t});return{edit:i}}},{key:"loader",get:function(){return this._loader}},{key:"schema",get:function(){return this._loader.schema}},{key:"fields",get:function(){return this._loader.fields}},{key:"fileTreeBuilder",get:function(){return this._fileTreeBuilder}},{key:"noPasswordFields",get:function(){return this._loader.noPasswordFields}},{key:"components",get:function(){for(var t=[],n=e.includeComponents.concat(this._formBuilder.components),a=0;a<n.length;a++){var i=n[a];dt[i]&&t.push.apply(t,Object(Ke["a"])(dt[i].include))}return Array.from(new Set(t.concat(n)))}},{key:"fixProperties",get:function(){for(var e={},t=this._formBuilder.properties,n=0;n<t.length;n++){var a=t[n];e[a.key]=a.value}return e}},{key:"ruleBuilder",get:function(){return this._ruleBuilder}},{key:"pageBuilder",get:function(){return this._pageBuilder}},{key:"collectionQuery",get:function(){var e=this._loader.foreignkeys,t="";return t=e.length?this._collection+","+e.join(","):this._collection,t}}]),e}();Object(qe["a"])(Nt,"includeComponents",["uni-forms","uni-group","uni-list","uni-load-more","uni-fab","uni-datetime-picker","uni-file-picker","uni-dateformat"]),Nt.template=ut,Nt.templateFormat=ht,window.SchemaBuilder=Nt;var Tt=Nt,It='\n<template>\n  <view class="uni-container">\n    <uni-forms ref="form" :value="formData" validate-trigger="submit" err-show-type="toast">\n      {formTemplate}\n\n      <view class="uni-button-group">\n        <button type="primary" class="uni-button" @click="submit">提交</button>\n      </view>\n    </uni-forms>\n  </view>\n</template>\n\n<script>\n  import { validator } from \'../../js_sdk/validator/{collection}.js\';\n\n  const db = uniCloud.database();\n  const dbCollectionName = \'{collection}\';\n\n  function getValidator(fields) {\n    let reuslt = {}\n    for (let key in validator) {\n      if (fields.indexOf(key) > -1) {\n        reuslt[key] = validator[key]\n      }\n    }\n    return reuslt\n  }\n\n  export default {\n    data() {\n      return {\n        formData: {formData},\n        formOptions: {formOptions},\n        rules: {\n          ...getValidator({fields})\n        }\n      }\n    },\n    onReady() {\n      this.$refs.form.setRules(this.rules)\n    },\n    methods: {\n      /**\n       * 触发表单提交\n       */\n      submit() {\n        uni.showLoading({\n          mask: true\n        })\n        this.$refs.form.submit().then((res) => {\n          this.submitForm(res)\n        }).catch((errors) => {\n          uni.hideLoading()\n        })\n      },\n\n      submitForm(value) {\n        // 使用 clientDB 提交数据\n        db.collection(dbCollectionName).add(value).then((res) => {\n          uni.showToast({\n            icon: \'none\',\n            title: \'新增成功\'\n          })\n          this.getOpenerEventChannel().emit(\'refreshData\')\n          setTimeout(() => uni.navigateBack(), 500)\n        }).catch((err) => {\n          uni.showModal({\n            content: err.message || \'请求服务失败\',\n            showCancel: false\n          })\n        }).finally(() => {\n          uni.hideLoading()\n        })\n      }\n    }\n  }\n<\/script>\n\n<style>\n  .uni-container {\n    padding: 15px;\n  }\n\n  .uni-input-border,\n  .uni-textarea-border {\n    width: 100%;\n    font-size: 14px;\n    color: #666;\n    border: 1px #e5e5e5 solid;\n    border-radius: 5px;\n    box-sizing: border-box;\n  }\n\n  .uni-input-border {\n    padding: 0 10px;\n    height: 35px;\n\n  }\n\n  .uni-textarea-border {\n    padding: 10px;\n    height: 80px;\n  }\n\n  .uni-button-group {\n    margin-top: 50px;\n    display: flex;\n    justify-content: center;\n  }\n\n  .uni-button {\n    width: 184px;\n    padding: 12px 20px;\n    font-size: 14px;\n    border-radius: 4px;\n    line-height: 1;\n    margin: 0;\n  }\n</style>\n\n',jt=It,Ot='\n<template>\n  <view class="uni-container">\n    <uni-forms ref="form" :value="formData" validate-trigger="submit" err-show-type="toast">\n      {formTemplate}\n\n      <view class="uni-button-group">\n        <button type="primary" class="uni-button" @click="submit">提交</button>\n      </view>\n    </uni-forms>\n  </view>\n</template>\n\n<script>\n  import { validator } from \'../../js_sdk/validator/{collection}.js\';\n\n  const db = uniCloud.database();\n  const dbCollectionName = \'{collection}\';\n\n  function getValidator(fields) {\n    let reuslt = {}\n    for (let key in validator) {\n      if (fields.indexOf(key) > -1) {\n        reuslt[key] = validator[key]\n      }\n    }\n    return reuslt\n  }\n\n  export default {\n    data() {\n      return {\n        formData: {formData},\n        formOptions: {formOptions},\n        rules: {\n          ...getValidator({fields})\n        }\n      }\n    },\n    onLoad(e) {\n      const id = e.id\n      this.formDataId = id\n      this.getDetail(id)\n    },\n    onReady() {\n      this.$refs.form.setRules(this.rules)\n    },\n    methods: {\n      /**\n       * 触发表单提交\n       */\n      submit() {\n        uni.showLoading({\n          mask: true\n        })\n        this.$refs.form.submit().then((res) => {\n          this.submitForm(res)\n        }).catch((errors) => {\n          uni.hideLoading()\n        })\n      },\n\n      submitForm(value) {\n        // 使用 clientDB 提交数据\n        db.collection(dbCollectionName).doc(this.formDataId).update(value).then((res) => {\n          uni.showToast({\n            icon: \'none\',\n            title: \'修改成功\'\n          })\n          this.getOpenerEventChannel().emit(\'refreshData\')\n          setTimeout(() => uni.navigateBack(), 500)\n        }).catch((err) => {\n          uni.showModal({\n            content: err.message || \'请求服务失败\',\n            showCancel: false\n          })\n        }).finally(() => {\n          uni.hideLoading()\n        })\n      },\n\n      /**\n       * 获取表单数据\n       * @param {Object} id\n       */\n      getDetail(id) {\n        uni.showLoading({\n          mask: true\n        })\n        db.collection(dbCollectionName).doc(id){db_no_password_field}.get().then((res) => {\n          const data = res.result.data[0]\n          if (data) {\n            this.formData = data\n          }\n        }).catch((err) => {\n          uni.showModal({\n            content: err.message || \'请求服务失败\',\n            showCancel: false\n          })\n        }).finally(() => {\n          uni.hideLoading()\n        })\n      }\n    }\n  }\n<\/script>\n\n<style>\n  .uni-container {\n    padding: 15px;\n  }\n\n  .uni-input-border,\n  .uni-textarea-border {\n    width: 100%;\n    font-size: 14px;\n    color: #666;\n    border: 1px #e5e5e5 solid;\n    border-radius: 5px;\n    box-sizing: border-box;\n  }\n\n  .uni-input-border {\n    padding: 0 10px;\n    height: 35px;\n\n  }\n\n  .uni-textarea-border {\n    padding: 10px;\n    height: 80px;\n  }\n\n  .uni-button-group {\n    margin-top: 50px;\n    display: flex;\n    justify-content: center;\n  }\n\n  .uni-button {\n    width: 184px;\n    padding: 12px 20px;\n    font-size: 14px;\n    border-radius: 4px;\n    line-height: 1;\n    margin: 0;\n  }\n</style>\n',Et=Ot,Ft='<template>\n  <view class="container">\n    <unicloud-db ref="udb" v-slot:default="{data, pagination, loading, hasMore, error}" collection="{collection}" field="{field}">\n      <view v-if="error">{{error.message}}</view>\n      <view v-else-if="data">\n        <uni-list>\n          <uni-list-item v-for="(item, index) in data" :key="index" showArrow :clickable="true" @click="handleItemClick(item._id)">\n            <view slot="body">\n              \x3c!-- 此处默认显示为_id，请根据需要自行修改为其他字段 --\x3e\n              {{item._id}}\n            </view>\n          </uni-list-item>\n        </uni-list>\n      </view>\n      <uni-load-more :status="loading?\'loading\':(hasMore ? \'more\' : \'noMore\')"></uni-load-more>\n    </unicloud-db>\n    <uni-fab ref="fab" horizontal="right" vertical="bottom" :pop-menu="false" @fabClick="fabClick" />\n  </view>\n</template>\n\n<script>\n  export default {\n    data() {\n      return {\n        loadMore: {\n          contentdown: \'\',\n          contentrefresh: \'\',\n          contentnomore: \'\'\n        }\n      }\n    },\n    onPullDownRefresh() {\n      this.$refs.udb.loadData({\n        clear: true\n      }, () => {\n        uni.stopPullDownRefresh()\n      })\n    },\n    onReachBottom() {\n      this.$refs.udb.loadMore()\n    },\n    methods: {\n      handleItemClick(id) {\n        uni.navigateTo({\n          url: \'./detail?id=\' + id\n        })\n      },\n      fabClick() {\n        // 打开新增页面\n        uni.navigateTo({\n          url: \'./add\',\n          events: {\n            // 监听新增数据成功后, 刷新当前页面数据\n            refreshData: () => {\n              this.$refs.udb.loadData({\n                clear: true\n              })\n            }\n          }\n        })\n      }\n    }\n  }\n<\/script>\n\n<style>\n</style>\n',$t=Ft,Lt='<template>\n  <view class="container">\n    <unicloud-db ref="udb" v-slot:default="{data, loading, error, options}" :options="options" collection="{queryCollection}" field="{queryField}" :where="queryWhere" :getone="true" :manual="true">\n      <view v-if="error">{{error.message}}</view>\n      <view v-else-if="loading">\n        <uni-load-more :contentText="loadMore" status="loading"></uni-load-more>\n      </view>\n      <view v-else-if="data">\n        {content}\n      </view>\n    </unicloud-db>\n    <view class="btns">\n      <button type="primary" @click="handleUpdate">修改</button>\n      <button type="warn" class="btn-delete" @click="handleDelete">删除</button>\n    </view>\n  </view>\n</template>\n\n<script>\n  // 由schema2code生成，包含校验规则和enum静态数据\n  import { enumConverter } from \'../../js_sdk/validator/{collection}.js\';\n\n  export default {\n    data() {\n      return {\n        queryWhere: \'\',\n        loadMore: {\n          contentdown: \'\',\n          contentrefresh: \'\',\n          contentnomore: \'\'\n        },\n        options: {\n          // 将scheme enum 属性静态数据中的value转成text\n          ...enumConverter\n        }\n      }\n    },\n    onLoad(e) {\n      this._id = e.id\n    },\n    onReady() {\n      if (this._id) {\n        this.queryWhere = \'_id=="\' + this._id + \'"\'\n      }\n    },\n    methods: {\n      handleUpdate() {\n        // 打开修改页面\n        uni.navigateTo({\n          url: \'./edit?id=\' + this._id,\n          events: {\n            // 监听修改页面成功修改数据后, 刷新当前页面数据\n            refreshData: () => {\n              this.$refs.udb.loadData({\n                clear: true\n              })\n            }\n          }\n        })\n      },\n      handleDelete() {\n        this.$refs.udb.remove(this._id, {\n          success: (res) => {\n            // 删除数据成功后跳转到list页面\n            uni.navigateTo({\n              url: \'./list\'\n            })\n          }\n        })\n      }\n    }\n  }\n<\/script>\n\n<style>\n  .container {\n    padding: 10px;\n  }\n\n  .btns {\n    margin-top: 10px;\n    display: flex;\n    flex-direction: row;\n  }\n\n  .btns button {\n    flex: 1;\n  }\n\n  .btn-delete {\n    margin-left: 10px;\n  }\n</style>\n',Bt='<%for (let i = 0; i < fields.length; i++){let fieldName = fields[i];let item = properties[fieldName];%>\n  <view><%=END_OF_LINE%>\n    <text><%=(item.title || item.label || fields[i])%>:</text><%=END_OF_LINE%>\n    <%if(item.bsonType==\'timestamp\'){%><uni-dateformat :date="data.<%=fields[i]%>" :threshold="[0, 0]" />\n    <%}else{%>\n      <%if(enumStatic[fieldName]){%>\n        <%if(item.bsonType===\'array\'){%>\n          <uni-data-picker :localdata="options.<%=fieldName%>_valuetotext" :value="data.<%=fieldName%>" :multiple="true" :readonly="true" :arrow="false" :border="false" split="," />\n        <%}else{%>\n          <text>{{options.<%=fieldName%>_valuetotext[data.<%=fieldName%>]}}</text>\n        <%}%>\n      <%}else if(enumForeignkeys[fieldName]){%>\n        <text>{{data.<%=fieldName%>[0].<%=enumForeignkeys[fieldName]%>}}</text>\n      <%}else if(item.bsonType==\'bool\'){%>\n        <text>{{data.<%=fieldName%> == true ? <%=char%>✅<%=char%> : <%=char%>❌<%=char%>}}</text>\n      <%}else if(item.bsonType==\'file\'){%>\n          <uni-file-picker v-if="data.<%=fieldName%>.fileType == <%=char%>image<%=char%>" :value="data.<%=fieldName%>" :file-mediatype="data.<%=fieldName%>.fileType" return-type="object" readonly></uni-file-picker>\n          <uni-link v-else :href="data.<%=fieldName%>.url" :text="data.<%=fieldName%>.url"></uni-link>\n      <%}else if(item.bsonType==\'array\' && item.arrayType==\'file\'){%>\n        <template v-for="(file, j) in data.<%=fieldName%>">\n            <uni-file-picker v-if="file.fileType == <%=char%>image<%=char%>" :value="file" :file-mediatype="file.fileType" readonly></uni-file-picker>\n            <uni-link v-else :href="file.url" :text="file.url"></uni-link>\n        </template>\n      <%}else if(item.bsonType==\'string\' && item.format==\'url\'){%>\n          <uni-link :href="data.<%=fieldName%>" :text="data.<%=fieldName%>"></uni-link>\n      <%}else if(item.bsonType==\'string\' && item.format==\'email\'){%>\n          <uni-link :href="<%=char%>mailto:<%=char%>+data.<%=fieldName%>" :text="data.<%=fieldName%>"></uni-link>\n      <%}else if(item.bsonType==\'string\' && item.format==\'tel\'){%>\n          <uni-link :href="<%=char%>tel:<%=char%>+data.<%=fieldName%>" :text="data.<%=fieldName%>"></uni-link>\n      <%}else{%>\n        <text>{{data.<%=fieldName%>}}</text>\n      <%}%>\n    <%}%><%=END_OF_LINE%>\n  </view>\n<%=END_OF_LINE%>\n<%}%>\n',At={tpl_page:Lt,tpl_fields:Bt},Mt={id:"",displayName:"",version:"1.0.0",description:"",keywords:[],repository:"",engines:{HBuilderX:"^3.1.0"},dcloudext:{category:["uniCloud","Admin插件"],sale:{regular:{price:"0.00"},sourcecode:{price:"0.00"}},contact:{qq:""},declaration:{ads:"无",data:"无",permissions:"无"},npmurl:""},uni_modules:{dependencies:[],encrypt:[],platforms:{cloud:{tcb:"y",aliyun:"y"},client:{App:{"app-vue":"y","app-nvue":"u"},"H5-mobile":{Safari:"y","Android Browser":"y","微信浏览器(Android)":"y","QQ浏览器(Android)":"y"},"H5-pc":{Chrome:"y",IE:"u",Edge:"y",Firefox:"y",Safari:"y"},"小程序":{"微信":"y","阿里":"y","百度":"y","字节跳动":"y",QQ:"y"},"快应用":{"华为":"u","联盟":"u"}}}}},Rt={name:"CloudDatabaseSchemaExportForm",directives:{clipboard:Ie["a"]},components:{JsonEditor:ne["a"]},mixins:[s["a"]],data:function(){return{loading:!1,tableName:"",checkAll:!1,members:[],checkedMembers:[],checkedCount:0,pageData:"",exportTableName:"",exportFiles:[],defaultProps:{children:"children",label:"label"},exportMode:"mode_project",expandedKeys:["js_sdk","pages","pages_children"],exportUniModules:[]}},computed:Object(o["a"])(Object(o["a"])({},Object(ce["b"])(["is_tcb","token"])),{},{isIndeterminate:function(){return this.checkedMembers.length>0&&this.checkedMembers.length!==this.members.length}}),watch:{spaceid:function(e){}},created:function(){this._schemaBuilder=new Tt,this._collection=null,this._bulldResult={},this._exportSelectedCommand=null,this._treeSelected=null},methods:{load:function(e,t,n){var a=this;this.tableName=e,this._collection=e,this._schemaData=t,this._referenceSchema=n,this._schemaProperties=t.properties,this.$nextTick((function(){a.build()}))},clipboardSuccess:function(){this.$message({message:"复制成功",type:"success",duration:1500})},handleCheckAllChange:function(e){var t=this;this.checkedMembers=e?this.members:[],this.updateCheckBox(),this.$nextTick((function(){t.buildFromSchemaData(t.checkedMembers)}))},handleCheckedChange:function(e){var t=this;this.checkedCount=e.length,this.updateCheckBox(),this.$nextTick((function(){t.buildFromSchemaData(t.checkedMembers)}))},handleNodeClick:function(e){var t=e["command"],n=this._bulldResult[t];this._exportSelectedCommand=void 0!==n?t:null,this.updatePreview(n)},updateCheckBox:function(){this.checkAll=this.checkedMembers.length>0&&this.checkedMembers.length===this.members.length},updatePreview:function(e){void 0!==e?this.$refs.jsonEditorOutput.setValue(e,!1):this.$refs.jsonEditorOutput.setValue("仅自动生成的文件会在此处显示代码。三方库不会显示代码。",!1)},build:function(){var e=this._schemaBuilder.load(this._schemaData),t=e.fields,n=e.allFields;this.members=n.slice(0),this.checkedMembers=t.slice(0),this.checkedCount=this.checkedMembers.length,this.updateCheckBox(),this.exportTableName=this._collection,this.buildFromSchemaData(this.checkedMembers),this.buildFileTree()},buildFromSchemaData:function(e){var t=this._schemaBuilder.build(e,{collection:this._collection,referenceSchema:this._referenceSchema}),n=t.formPage,a=t.validatorClient,i=this._schemaBuilder.loader,o=this._schemaProperties,s=JSON.stringify(e),r=i.resolveForeignkeyFields(e),l=this._schemaBuilder.pageBuilder.build(this._collection,["add","edit","list","detail"],["新增","编辑","列表","详情"]);l=JSON.stringify(l,null,4);var c=Tt.templateFormat(At.tpl_page,{queryCollection:this._schemaBuilder.collectionQuery,queryField:r.join(","),collection:this._collection,content:Tt.template(At.tpl_fields,{fields:e,properties:o,enums:i.enums,enumStatic:i.enumStatic,enumForeignkeys:i.enumForeignkeys,char:"'",END_OF_LINE:"\n"})}),d=JSON.parse(JSON.stringify(Mt));d.id=this._collection,d.displayName=this._collection,d.keywords=[this._collection],d.uni_modules.dependencies=this._schemaBuilder.components,d=JSON.stringify(d,null,2),this._bulldResult={schema_json:JSON.stringify(this._schemaData,null,2),page_add:Tt.templateFormat(jt,Object.assign({fields:s},n.edit)),page_edit:Tt.templateFormat(Et,Object.assign({fields:s,db_no_password_field:i.fields.length?".field('".concat(i.fields.join(","),"')"):""},n.edit)),page_list:Tt.templateFormat($t,Object.assign({field:i.fields.join(","),fields:s},n.edit)),page_detail:c,validatorClient:a,pages:l,changelog_md:"",package_json:d,readme_md:"# "+this._collection},this.$refs.jsonEditorOutput.setValue("",!1),this.updatePreview(this._bulldResult[this._exportSelectedCommand])},buildFileTree:function(){this.exportFiles=this._schemaBuilder.fileTreeBuilder.uni,this.exportUniModules=this._schemaBuilder.fileTreeBuilder.uniModules},buildZip:function(){var e=Object(he["a"])(regeneratorRuntime.mark((function e(){var t,n,a,i,o,s,r,l,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.exportTableName||this.tableName,n=this._bulldResult,a=n.page_add,i=n.page_edit,o=n.page_list,s=n.page_detail,r=n.validatorClient,l=n.pages,c=new ze.a,c.file("js_sdk/validator/"+t+".js",r),c.file("pages/"+t+"/add.vue",a),c.file("pages/"+t+"/edit.vue",i),c.file("pages/"+t+"/list.vue",o),c.file("pages/"+t+"/detail.vue",s),c.file("pages.json",l),e.abrupt("return",c.generateAsync({type:"blob"}));case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),downloadAndImport:function(){var e=Object(he["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:"mode_uni_modules"===this.exportMode?this.downloadUniModules(t):this.downloadZip(t);case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),downloadZip:function(){var e=Object(he["a"])(regeneratorRuntime.mark((function e(t){var n,a,i,o,s,r,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.buildZip();case 2:for(s in n=e.sent,a="opendb-form-project.zip",i=new FormData,o={provider:this.formData.provider,space_id:this.formData.spaceId,appid:this.formData.appid,name:this._collection,functions:this._schemaBuilder.loader.validateFunctions.toString(),dependency:this._schemaBuilder.components.toString()},t&&(o.import=1),o)i.append(s,o[s]);navigator.msSaveBlob?(r=new Blob([n],{type:"application/zip"}),i.append("attachment",r,a)):(l=new File([n],a,{type:"application/zip"}),i.append("attachment",l)),ye.a.post(ke["a"].baseURL+"/opendb/schema-to-code-for-modules",i,{headers:{"Content-Type":"multipart/form-data",token:this.token}}).then((function(e){var n=e.data,a=n.ret,i=n.data,o=i.import_url,s=i.download_url;if(0===a){var r=t?o:s;window.open(r)}}));case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),buildUniModulesZip:function(){var e=Object(he["a"])(regeneratorRuntime.mark((function e(){var t,n,a,i,o,s,r,l,c,d,u,h;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.exportTableName||this.tableName,n=this._bulldResult,a=n.schema_json,i=n.page_add,o=n.page_edit,s=n.page_list,r=n.page_detail,l=n.validatorClient,c=n.changelog_md,d=n.package_json,u=n.readme_md,h=new ze.a,h.file("uniCloud/database/"+t+".schema.json",a),h.file("js_sdk/validator/"+t+".js",l),h.file("pages/"+t+"/add.vue",i),h.file("pages/"+t+"/edit.vue",o),h.file("pages/"+t+"/list.vue",s),h.file("pages/"+t+"/detail.vue",r),h.file("changelog.md",c),h.file("package.json",d),h.file("readme.md",u),e.abrupt("return",h.generateAsync({type:"blob"}));case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),downloadUniModules:function(){var e=Object(he["a"])(regeneratorRuntime.mark((function e(t){var n,a,i,o,s,r,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.buildUniModulesZip();case 2:for(s in n=e.sent,a="opendb-form-project.zip",i=new FormData,o={provider:this.formData.provider,space_id:this.formData.spaceId,appid:this.formData.appid,name:this._collection,functions:this._schemaBuilder.loader.validateFunctions.toString(),uni_modules:1},t&&(o.import=1),o)i.append(s,o[s]);navigator.msSaveBlob?(r=new Blob([n],{type:"application/zip"}),i.append("attachment",r,a)):(l=new File([n],a,{type:"application/zip"}),i.append("attachment",l)),ye.a.post(ke["a"].baseURL+"/opendb/schema-to-code-for-modules",i,{headers:{"Content-Type":"multipart/form-data",token:this.token}}).then((function(e){var n=e.data,a=n.ret,i=n.data,o=i.import_url,s=i.download_url;if(0===a){var r=t?o:s;window.open(r)}}));case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}},Pt=Rt,Vt=(n("0dae"),Object(u["a"])(Pt,Re,Pe,!1,null,"3268fba2",null)),zt=Vt.exports,Kt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"schema-export-form"},[n("div",{staticClass:"flex-r dialog-content"},[n("div",{staticClass:"group"},[n("div",{staticClass:"group-h"},[n("b",[e._v("表名:")]),e._v("\n        "+e._s(e.tableName)+"\n      ")]),e._v(" "),n("div",{staticClass:"group-c"},[n("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选所有字段")]),e._v(" "),n("div",{staticClass:"p-t-b"}),e._v(" "),n("el-checkbox-group",{on:{change:e.handleCheckedChange},model:{value:e.checkedMembers,callback:function(t){e.checkedMembers=t},expression:"checkedMembers"}},e._l(e.members,(function(e){return n("el-checkbox",{key:e,staticClass:"member-item",attrs:{label:e}})})),1)],1)]),e._v(" "),n("div",{staticClass:"group file-tree"},[n("div",{staticClass:"group-h"},[e._v("导出文件清单")]),e._v(" "),n("div",{staticClass:"group-c",staticStyle:{padding:"0 5px"}},[n("el-radio-group",{staticStyle:{margin:"10px 5px"},model:{value:e.exportMode,callback:function(t){e.exportMode=t},expression:"exportMode"}},[n("el-radio",{attrs:{label:"mode_project"}},[e._v("项目模式")]),e._v(" "),n("el-radio",{attrs:{label:"mode_uni_modules"}},[e._v("uni_modules模式")])],1),e._v(" "),n("el-tree",{directives:[{name:"show",rawName:"v-show",value:"mode_project"==e.exportMode,expression:"exportMode=='mode_project'"}],attrs:{data:e.exportFiles,props:e.defaultProps,"node-key":"id","default-expanded-keys":e.expandedKeys,"highlight-current":!0},on:{"node-click":e.handleNodeClick}}),e._v(" "),n("el-tree",{directives:[{name:"show",rawName:"v-show",value:"mode_uni_modules"==e.exportMode,expression:"exportMode=='mode_uni_modules'"}],attrs:{data:e.exportUniModules,props:e.defaultProps,"node-key":"id","default-expand-all":!0,"highlight-current":!0},on:{"node-click":e.handleNodeClick}})],1)]),e._v(" "),n("div",{staticClass:"group flex-f"},[n("div",{staticClass:"group-h"},[e._v("文件预览")]),e._v(" "),n("json-editor",{ref:"jsonEditorOutput",staticClass:"json-schema json-schema-in-dialog",attrs:{mode:"vue"},model:{value:e.pageData,callback:function(t){e.pageData=t},expression:"pageData"}})],1)]),e._v(" "),n("div",{staticClass:"flex-r a-i-c"},[n("p",{staticStyle:{"font-size":"12px",color:"#999"}},[e._v("提示: 导出 uni_modules 模式需要 uniCloud admin 基础框架 1.3+")]),e._v(" "),n("div",{staticClass:"m-l-a p-t-b flex-r"},[n("el-button",{staticClass:"flex-f",attrs:{size:"mini"},on:{click:function(t){return e.downloadAndImport(0)}}},[e._v("下载zip")]),e._v(" "),n("el-button",{staticClass:"flex-f",attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.downloadAndImport(1)}}},[e._v("导入到HBuilderX")])],1)])])},qt=[],Ut=n("0657"),Jt=n.n(Ut),Wt='\n<template>\n  <view class="uni-container">\n    <uni-forms ref="form" :value="formData" validateTrigger="bind">\n      {formTemplate}\n\n      <view class="uni-button-group">\n        <button type="primary" class="uni-button" style="width: 100px;" @click="submit">提交</button>\n        <navigator open-type="navigateBack" style="margin-left: 15px;">\n            <button class="uni-button" style="width: 100px;">返回</button>\n        </navigator>\n      </view>\n    </uni-forms>\n  </view>\n</template>\n\n<script>\n  import { validator } from \'../../js_sdk/validator/{collection}.js\';\n\n  const db = uniCloud.database();\n  const dbCmd = db.command;\n  const dbCollectionName = \'{collection}\';\n\n  function getValidator(fields) {\n    let reuslt = {}\n    for (let key in validator) {\n      if (fields.includes(key)) {\n        reuslt[key] = validator[key]\n      }\n    }\n    return reuslt\n  }\n\n  export default {\n    data() {\n      return {\n        formData: {formData},\n        formOptions: {formOptions},\n        rules: {\n          ...getValidator({fields})\n        }\n      }\n    },\n    onReady() {\n      this.$refs.form.setRules(this.rules)\n    },\n    methods: {\n      /**\n       * 触发表单提交\n       */\n      submit() {\n        uni.showLoading({\n          mask: true\n        })\n        this.$refs.form.submit().then((res) => {\n          this.submitForm(res)\n        }).catch((errors) => {\n          uni.hideLoading()\n        })\n      },\n\n      submitForm(value) {\n        // 使用 clientDB 提交数据\n        db.collection(dbCollectionName).add(value).then((res) => {\n          uni.showToast({\n            title: \'新增成功\'\n          })\n          this.getOpenerEventChannel().emit(\'refreshData\')\n          setTimeout(() => uni.navigateBack(), 500)\n        }).catch((err) => {\n          uni.showModal({\n            content: err.message || \'请求服务失败\',\n            showCancel: false\n          })\n        }).finally(() => {\n          uni.hideLoading()\n        })\n      }\n    }\n  }\n<\/script>\n',Ht=Wt,Gt='\n<template>\n  <view class="uni-container">\n    <uni-forms ref="form" :value="formData" validateTrigger="bind">\n      {formTemplate}\n\n      <view class="uni-button-group">\n        <button type="primary" class="uni-button" style="width: 100px;" @click="submit">提交</button>\n        <navigator open-type="navigateBack" style="margin-left: 15px;">\n            <button class="uni-button" style="width: 100px;">返回</button>\n        </navigator>\n      </view>\n    </uni-forms>\n  </view>\n</template>\n\n<script>\n  import { validator } from \'../../js_sdk/validator/{collection}.js\';\n\n  const db = uniCloud.database();\n  const dbCmd = db.command;\n  const dbCollectionName = \'{collection}\';\n\n  function getValidator(fields) {\n    let reuslt = {}\n    for (let key in validator) {\n      if (fields.includes(key)) {\n        reuslt[key] = validator[key]\n      }\n    }\n    return reuslt\n  }\n\n  export default {\n    data() {\n      return {\n        formData: {formData},\n        formOptions: {formOptions},\n        rules: {\n          ...getValidator({fields})\n        }\n      }\n    },\n    onLoad(e) {\n      const id = e.id\n      this.formDataId = id\n      this.getDetail(id)\n    },\n    onReady() {\n      this.$refs.form.setRules(this.rules)\n    },\n    methods: {\n      /**\n       * 触发表单提交\n       */\n      submit() {\n        uni.showLoading({\n          mask: true\n        })\n        this.$refs.form.submit().then((res) => {\n          this.submitForm(res)\n        }).catch((errors) => {\n          uni.hideLoading()\n        })\n      },\n\n      submitForm(value) {\n        // 使用 clientDB 提交数据\n        db.collection(dbCollectionName).doc(this.formDataId).update(value).then((res) => {\n          uni.showToast({\n            title: \'修改成功\'\n          })\n          this.getOpenerEventChannel().emit(\'refreshData\')\n          setTimeout(() => uni.navigateBack(), 500)\n        }).catch((err) => {\n          uni.showModal({\n            content: err.message || \'请求服务失败\',\n            showCancel: false\n          })\n        }).finally(() => {\n          uni.hideLoading()\n        })\n      },\n\n      /**\n       * 获取表单数据\n       * @param {Object} id\n       */\n      getDetail(id) {\n        uni.showLoading({\n          mask: true\n        })\n        db.collection(dbCollectionName).doc(id){db_no_password_field}.get().then((res) => {\n          const data = res.result.data[0]\n          if (data) {\n            this.formData = data\n          }\n        }).catch((err) => {\n          uni.showModal({\n            content: err.message || \'请求服务失败\',\n            showCancel: false\n          })\n        }).finally(() => {\n          uni.hideLoading()\n        })\n      }\n    }\n  }\n<\/script>\n\n',Zt=Gt,Qt='\n<template>\n  <view>\n    <view class="uni-header">\n      <view class="uni-group">\n        <view class="uni-title"></view>\n        <view class="uni-sub-title"></view>\n      </view>\n      <view class="uni-group">\n        <input class="uni-search" type="text" v-model="query" @confirm="search" placeholder="请输入搜索内容" />\n        <button class="uni-button" type="default" size="mini" @click="search">搜索</button>\n        <button class="uni-button" type="default" size="mini" @click="navigateTo(\'./add\')">新增</button>\n        <button class="uni-button" type="default" size="mini" :disabled="!selectedIndexs.length" @click="delTable">批量删除</button>\n      </view>\n    </view>\n    <view class="uni-container">\n      <unicloud-db ref="udb" collection="{collectionQuery}" field="{field}" :where="where" page-data="replace"\n        :orderby="orderby" :getcount="true" :page-size="options.pageSize" :page-current="options.pageCurrent"\n        v-slot:default="{data,pagination,loading,error,options}" :options="options">\n        <uni-table :loading="loading" :emptyText="error.message || \'没有更多数据\'" border stripe type="selection" @selection-change="selectionChange">\n          <uni-tr>\n            {tableHeader}\n            <uni-th width="204" align="center">操作</uni-th>\n          </uni-tr>\n          <uni-tr v-for="(item,index) in data" :key="index">\n            {tableContent}\n            <uni-td align="center">\n              <view class="uni-group">\n                <button @click="navigateTo(\'./edit?id=\'+item._id, false)" class="uni-button" size="mini" type="primary">修改</button>\n                <button @click="confirmDelete(item._id)" class="uni-button" size="mini" type="warn">删除</button>\n              </view>\n            </uni-td>\n          </uni-tr>\n        </uni-table>\n        <view class="uni-pagination-box">\n          <uni-pagination show-icon :page-size="pagination.size" v-model="pagination.current" :total="pagination.count"\n            @change="onPageChanged" />\n        </view>\n      </unicloud-db>\n    </view>\n  </view>\n</template>\n\n<script>\n  import { enumConverter } from \'../../js_sdk/validator/{collection}.js\';\n\n  const db = uniCloud.database()\n  // 表查询配置\n  const dbOrderBy = \'\' // 排序字段\n  const dbSearchFields = [] // 模糊搜索字段，支持模糊搜索的字段列表\n  // 分页配置\n  const pageSize = 20\n  const pageCurrent = 1\n\n  export default {\n    data() {\n      return {\n        query: \'\',\n        where: \'\',\n        orderby: dbOrderBy,\n        selectedIndexs: [],\n        options: {\n          pageSize,\n          pageCurrent,\n          ...enumConverter\n        },\n        imageStyles: {\n          width: 64,\n          height: 64\n        }\n      }\n    },\n    methods: {\n      getWhere() {\n        const query = this.query.trim()\n        if (!query) {\n          return \'\'\n        }\n        const queryRe = new RegExp(query, \'i\')\n        return dbSearchFields.map(name => queryRe + \'.test(\' + name + \')\').join(\' || \')\n      },\n      search() {\n        const newWhere = this.getWhere()\n        const isSameWhere = newWhere === this.where\n        this.where = newWhere\n        if (isSameWhere) { // 相同条件时，手动强制刷新\n          this.loadData()\n        }\n      },\n      loadData(clear = true) {\n        this.$refs.udb.loadData({\n          clear\n        })\n      },\n      onPageChanged(e) {\n        this.$refs.udb.loadData({\n          current: e.current\n        })\n      },\n      navigateTo(url, clear) {\n        // clear 表示刷新列表时是否清除页码，true 表示刷新并回到列表第 1 页，默认为 true\n        uni.navigateTo({\n          url,\n          events: {\n            refreshData: () => {\n              this.loadData(clear)\n            }\n          }\n        })\n      },\n      // 多选处理\n      selectedItems() {\n        var dataList = this.$refs.udb.dataList\n        return this.selectedIndexs.map(i => dataList[i]._id)\n      },\n      // 批量删除\n      delTable() {\n        this.$refs.udb.remove(this.selectedItems())\n      },\n      // 多选\n      selectionChange(e) {\n        this.selectedIndexs = e.detail.index\n      },\n      confirmDelete(id) {\n        this.$refs.udb.remove(id)\n      }\n    }\n  }\n<\/script>\n<style>\n</style>\n',Yt='\n<%for (let i = 0; i < fields.length; i++){let item = properties[fields[i]];%>\n<uni-th align="center"><%=(item.label || item.title || fields[i])%></uni-th>\n<%}%>\n',Xt='\n<%for (var i = 0; i < fields.length; i++){let fieldName = fields[i];let item = properties[fieldName];%>\n<%if(item.bsonType==\'timestamp\'){%>\n<uni-td align="center">\n    <uni-dateformat :date="item.<%=fieldName%>" :threshold="[0, 0]" />\n</uni-td>\n<%}else{%>\n<uni-td align="center">\n<%=formatEnum(item, fieldName, enumStatic, enumForeignkeys, fixProperties[fieldName])%>\n</uni-td>\n<%}%>\n<%}%>\n',en={name:"CloudDatabaseSchemaExportAdmin",directives:{clipboard:Ie["a"]},components:{JsonEditor:ne["a"]},mixins:[s["a"]],data:function(){return{loading:!1,tableName:"",checkAll:!1,members:[],checkedMembers:[],checkedCount:0,pageData:"",exportTableName:"",exportFiles:[],defaultProps:{children:"children",label:"label"},exportMode:"mode_project",expandedKeys:["js_sdk","pages","pages_children"],exportUniModules:[]}},computed:Object(o["a"])(Object(o["a"])({},Object(ce["b"])(["is_tcb","token"])),{},{isIndeterminate:function(){return this.checkedMembers.length>0&&this.checkedMembers.length!==this.members.length}}),watch:{spaceid:function(e){}},created:function(){this._schemaBuilder=new Tt,this._collection=null,this._bulldResult={},this._exportSelectedCommand=null,this._treeSelected=null,this._hasFunction=!1},methods:{load:function(e,t,n){var a=this;this.tableName=e,this._collection=e,this._schemaData=t,this._referenceSchema=n,this._schemaProperties=t.properties,this.$nextTick((function(){a.build()}))},clipboardSuccess:function(){this.$message({message:"复制成功",type:"success",duration:1500})},handleCheckAllChange:function(e){var t=this;this.checkedMembers=e?this.members:[],this.updateCheckBox(),this.$nextTick((function(){t.buildFromSchemaData(t.checkedMembers)}))},handleCheckedChange:function(e){var t=this;this.checkedCount=e.length,this.updateCheckBox(),this.$nextTick((function(){t.buildFromSchemaData(t.checkedMembers)}))},handleNodeClick:function(e){var t=e["command"],n=this._bulldResult[t];this._exportSelectedCommand=void 0!==n?t:null,this.updatePreview(n)},updateCheckBox:function(){this.checkAll=this.checkedMembers.length>0&&this.checkedMembers.length===this.members.length},updatePreview:function(e){void 0!==e?this.$refs.jsonEditorOutput.setValue(e,!1):this.$refs.jsonEditorOutput.setValue("仅自动生成的文件会在此处显示代码。三方库不会显示代码。",!1)},build:function(){var e=this._schemaBuilder.load(this._schemaData),t=e.fields,n=e.allFields;this.members=n.slice(0),this.checkedMembers=t.slice(0),this.checkedCount=this.checkedMembers.length,this.updateCheckBox(),this.exportTableName=this._collection,this.buildFromSchemaData(this.checkedMembers),this.buildFileTree()},buildFromSchemaData:function(e){var t=this._schemaBuilder.build(e,{collection:this._collection,referenceSchema:this._referenceSchema}),n=t.formPage,a=t.validatorClient,i=this._schemaBuilder.loader,o=this._schemaProperties,s=this._schemaBuilder.fixProperties,r=i.resolveForeignkeyFields(e),l=Tt.templateFormat(Qt,{collectionQuery:this._schemaBuilder.collectionQuery,collection:this._collection,field:r.join(","),tableHeader:Tt.template(Yt,{fields:e,properties:o}),tableContent:Tt.template(Xt,{fields:e,enums:i.enums,properties:o,fixProperties:s,enumStatic:i.enumStatic,enumForeignkeys:i.enumForeignkeys,formatEnum:this.formatEnum.bind(this)})}),c=this._schemaBuilder.pageBuilder.build(this._collection,["add","edit","list"],["新增","编辑","列表"]);c=JSON.stringify(c,null,4);var d=JSON.stringify(e),u=JSON.parse(JSON.stringify(Mt));u.id=this._collection,u.displayName=this._collection,u.keywords=[this._collection],u.uni_modules.dependencies=this._schemaBuilder.components,u=JSON.stringify(u,null,2),this._bulldResult={schema_json:JSON.stringify(this._schemaData,null,2),page_add:Tt.templateFormat(Ht,Object.assign({fields:d},n.edit)),page_edit:Tt.templateFormat(Zt,Object.assign({fields:d,db_no_password_field:i.fields.length?".field('".concat(i.fields.join(","),"')"):""},n.edit)),page_list:l,validatorClient:a,pages:c,changelog_md:"",package_json:u,readme_md:"# "+this._collection},this.$refs.jsonEditorOutput.setValue("",!1),this.updatePreview(this._bulldResult[this._exportSelectedCommand])},formatEnum:function(e,t,n,a,i){if(n[t])return"array"===e.bsonType?'<uni-data-picker :localdata="options.'.concat(t,'_valuetotext" :value="item.').concat(t,'" :border="false" :readonly="true" split="," />'):"{{options.".concat(t,"_valuetotext[item.").concat(t,"]}}");if(a[t])return"{{item.".concat(t,"[0] && item.").concat(t,"[0].").concat(a[t],"}}");if(i&&i.componentForShow){var o=i.componentForShow.name;return"<".concat(o,' :value="item.').concat(t,'" />')}return"bool"===e.bsonType?"{{item.".concat(t," == true ? '✅' : '❌'}}"):"file"===e.bsonType?'<uni-file-picker v-if="item.'.concat(t,".fileType == 'image'\" :value=\"item.").concat(t,'" :file-mediatype="item.').concat(t,'.fileType" return-type="object" :imageStyles="imageStyles" readonly></uni-file-picker>\n                <uni-link v-else :href="item.').concat(t,'.url" :text="item.').concat(t,'.url"></uni-link>'):"array"===e.bsonType&&"file"===e.arrayType?'<template v-for="(file, j) in item.'.concat(t,'">\n                    <uni-file-picker v-if="file.fileType == \'image\'" :value="file" :file-mediatype="file.fileType" :imageStyles="imageStyles" readonly></uni-file-picker>\n                    <uni-link v-else :href="file.url" :text="file.url"></uni-link>\n                </template>'):"string"===e.bsonType&&"tel"===e.format?"<uni-link :href=\"'tel:'+item.".concat(t,'" :text="item.').concat(t,'"></uni-link>'):"string"===e.bsonType&&"email"===e.format?"<uni-link :href=\"'mailto:'+item.".concat(t,'" :text="item.').concat(t,'"></uni-link>'):"{{item.".concat(t,"}}")},buildFileTree:function(){this.exportFiles=this._schemaBuilder.fileTreeBuilder.admin,this.exportUniModules=this._schemaBuilder.fileTreeBuilder.adminUniModules},downloadAndImport:function(){var e=Object(he["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:"mode_uni_modules"===this.exportMode?this.downloadUniModules(t):this.downloadZip(t);case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),buildZip:function(){var e=Object(he["a"])(regeneratorRuntime.mark((function e(){var t,n,a,i,o,s,r,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.exportTableName||this.tableName,n=this._bulldResult,a=n.validatorClient,i=n.page_add,o=n.page_edit,s=n.page_list,r=n.pages,l=new ze.a,l.file("js_sdk/validator/"+t+".js",a),l.file("pages/"+t+"/add.vue",i),l.file("pages/"+t+"/edit.vue",o),l.file("pages/"+t+"/list.vue",s),l.file("pages.json",r),e.abrupt("return",l.generateAsync({type:"blob"}));case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),downloadZip:function(){var e=Object(he["a"])(regeneratorRuntime.mark((function e(t){var n,a,i,o,s,r,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.buildZip();case 2:if(n=e.sent,this._hasFunction||t){e.next=6;break}return Jt()(n,this._collection),e.abrupt("return");case 6:for(s in a=new FormData,i="opendb-form-project.zip",o={provider:this.formData.provider,space_id:this.formData.spaceId,appid:this.formData.appid,name:this._collection,dependency:this._schemaBuilder.components.toString()},t&&(o.import=1),o)a.append(s,o[s]);navigator.msSaveBlob?(r=new Blob([n],{type:"application/zip"}),a.append("attachment",r,i)):(l=new File([n],i,{type:"application/zip"}),a.append("attachment",l)),ye.a.post(ke["a"].baseURL+"/opendb/schema-to-code-for-modules",a,{headers:{"Content-Type":"multipart/form-data",token:this.token}}).then((function(e){var n=e.data,a=n.ret,i=n.data,o=i.import_url,s=i.download_url;if(0===a){var r=t?o:s;window.open(r)}}));case 13:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),buildUniModulesZip:function(){var e=Object(he["a"])(regeneratorRuntime.mark((function e(){var t,n,a,i,o,s,r,l,c,d,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.exportTableName||this.tableName,n=this._bulldResult,a=n.schema_json,i=n.page_add,o=n.page_edit,s=n.page_list,r=n.validatorClient,l=n.changelog_md,c=n.package_json,d=n.readme_md,u=new ze.a,u.file("uniCloud/database/"+t+".schema.json",a),u.file("js_sdk/validator/"+t+".js",r),u.file("pages/"+t+"/add.vue",i),u.file("pages/"+t+"/edit.vue",o),u.file("pages/"+t+"/list.vue",s),u.file("changelog.md",l),u.file("package.json",c),u.file("readme.md",d),e.abrupt("return",u.generateAsync({type:"blob"}));case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),downloadUniModules:function(){var e=Object(he["a"])(regeneratorRuntime.mark((function e(t){var n,a,i,o,s,r,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.buildUniModulesZip();case 2:for(s in n=e.sent,a="opendb-form-project.zip",i=new FormData,o={provider:this.formData.provider,space_id:this.formData.spaceId,appid:this.formData.appid,name:this._collection,functions:this._schemaBuilder.loader.validateFunctions.toString(),uni_modules:1},t&&(o.import=1),o)i.append(s,o[s]);navigator.msSaveBlob?(r=new Blob([n],{type:"application/zip"}),i.append("attachment",r,a)):(l=new File([n],a,{type:"application/zip"}),i.append("attachment",l)),ye.a.post(ke["a"].baseURL+"/opendb/schema-to-code-for-modules",i,{headers:{"Content-Type":"multipart/form-data",token:this.token}}).then((function(e){var n=e.data,a=n.ret,i=n.data,o=i.import_url,s=i.download_url;if(0===a){var r=t?o:s;window.open(r)}}));case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}},tn=en,nn=(n("c9ad"),Object(u["a"])(tn,Kt,qt,!1,null,"265279ae",null)),an=nn.exports,on=n("b83a"),sn={name:"CloudDatabaseSchemaExport",components:{exportForm:zt,exportAdmin:an},mixins:[s["a"]],data:function(){return{loading:!1,activeTab:"tab1",dialogVisible:!1}},computed:Object(o["a"])({},Object(ce["b"])(["is_tcb","token"])),watch:{spaceid:function(e){}},created:function(){this._collection=null,this._schemaData=null,this._schemaBuilder=new Tt},methods:{show:function(e,t){this.dialogVisible=!0,this._collection=e,this._schemaData=t},onDialogOpened:function(){var e=this;this.$nextTick((function(){e.build()}))},onDialogClosed:function(){this.dialogVisible=!1},build:function(){var e=this;this._schemaBuilder.load(this._schemaData);var t=this._schemaBuilder.loader.referenceSchema;if(t.length){var n=t[0];this.loadSchema(n,(function(t){if(t)e.buildContinue(t||null);else{var a="加载关联表 [".concat(n,"] 时出现错误，请检查是否存在");e.$alert(a,"警告",{confirmButtonText:"确定",type:"error",callback:function(){}})}}))}else this.buildContinue()},buildContinue:function(e){this.$refs.exportForm.load(this._collection,this._schemaData,e),this.$refs.exportAdmin.load(this._collection,this._schemaData,e)},loadSchema:function(e,t){var n=this;this.loading=!0;var a={provider:this.formData.provider,space_id:this.formData.spaceId,name:e};this.$api.Database_OpenDB_Table_Info(a).then((function(e){n.loading=!1;var a=e.data.opendb_schema,i="";try{i="string"===typeof a?on["a"].parse(a):JSON.stringify(a,null,2)}catch(o){i=a}t(i)})).catch((function(){t(),n.loading=!1}))}}},rn=sn,ln=(n("d369"),Object(u["a"])(rn,Ae,Me,!1,null,"7d25bdb5",null)),cn=ln.exports,dn='\n{\n  "bsonType": "object",\n  "required": [],\n  "permission": {\n    "read": false,\n    "create": false,\n    "update": false,\n    "delete": false\n  },\n  "properties": {\n    "_id": {\n      "description": "ID，系统自动生成"\n    }\n  }\n}',un={name:"CloudDatabaseSchema",directives:{clipboard:Ie["a"]},components:{JsonEditor:ne["a"],jsonSchemaExport:cn},mixins:[s["a"]],data:function(){return{loading:!1,tableName:"",schemaIndex:1,schemaCacheId:"",schemaRestore:!1,schemaUpdating:!1,schemaEditing:!1}},computed:Object(o["a"])({},Object(ce["b"])(["is_tcb","token"])),watch:{spaceid:function(e){}},created:function(){this._collectionName=null},methods:{exportSchema:function(){var e=JSON.parse(this.$refs.jeSchema.getValue());this.$refs.schemaExport.show(this._collectionName,e)},refresh:function(e){var t=this;this._collectionName=e,this.tableName=e,this.getTableSchema(),this.schemaCacheId=this.formData.spaceId+"-"+e,this.$nextTick((function(){t.schemaRestore=t.$refs.jeSchema.hasCache()}))},clipboardSuccess:function(){this.$message({message:"复制成功",type:"success",duration:1500})},fullScreen:function(){this.$refs.jeSchema.fullScreen()},formatJsonSchema:function(){try{this.$refs.jeSchema.format()}catch(e){this.$alert("不能格式化，请检查是否有语法错误，如果代码中包含注释，请在HBuilderX 3.0.0+中编辑，web控制台格式化功能暂不支持注释","警告",{confirmButtonText:"确定",type:"error",callback:function(){}})}},getTableSchema:function(){var e=this;this.loading=!0,this._opendb_name="",this._schemaData={},this.$refs.jeSchema.setValue("",!1);var t={provider:this.formData.provider,space_id:this.formData.spaceId,appid:this.formData.appid,name:this._collectionName};this.$api.Database_OpenDB_Table_Info(t).then((function(t){e.loading=!1;var n=t.data,a=n.opendb_name,i=n.opendb_schema,o=n.version;e._opendb_name=a;var s=i||dn;try{e._schemaData="string"===typeof s?JSON.stringify(JSON.parse(s),null,2):JSON.stringify(s,null,2)}catch(r){e._schemaData=s}e._opendb_version=o||0,e._schemaData&&e.$refs.jeSchema.setValue(e._schemaData,!1)})).catch((function(){e.loading=!1}))},saveJsonSchema:function(){var e=this;try{this.$refs.jeSchema.getValue(!0)}catch(n){return void this.$alert("您输入的JSON格式有误，请检查","警告",{confirmButtonText:"确定",type:"error",callback:function(){}})}this.schemaUpdating=!0;var t={provider:this.formData.provider,space_id:this.formData.spaceId,appid:this.formData.appid,name:this._collectionName,opendb_name:this._opendb_name,schema:this.$refs.jeSchema.getValue(!0),version:this._opendb_version};this.$api.Database_OpenDB_Edit_Schema(t).then((function(t){e.schemaUpdating=!1;var n=t.ret;if(0===n){var a=t.data.version;e._opendb_version=a||0,e._schemaData=e.$refs.jeSchema.getValue(!0),e.publishClientdb()}e.$refs.jeSchema.clearCache()})).catch((function(){e.schemaUpdating=!1}))},publishClientdb:function(){var e=this;this.schemaUpdating=!0;var t={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid};this.$api.Database_Publish_Clientdb(t).then((function(t){e.schemaUpdating=!1;var n=t.ret;0===n&&(e.schemaEditing=!1)})).catch((function(){e.schemaUpdating=!1}))},fullScreenJsonSchema:function(){this.$refs.jeSchema.fullScreen()},cancelSchemaEditing:function(){this.schemaEditing=!1,this.$refs.jeSchema.setValue(this._schemaData,!1),this.$refs.jeSchema.clearCache()},restoreCache:function(){this.$refs.jeSchema.restoreCache(),this.schemaRestore=!1}}},hn=un,pn=(n("393c"),Object(u["a"])(hn,Le,Be,!1,null,"1a519210",null)),fn=pn.exports,mn="{}",vn={name:"CloudDatabase",components:{DatabaseNav:p,treeCard:Y,editor:X["a"],safetyRules:se,drawer:le["a"],addTable:ve,importExport:Se,jsonSchema:fn,customValidate:$e},mixins:[s["a"]],data:function(){return{loading:!1,databaseLoading:!1,databaseIndexLoading:!1,navList:[],dataBaseData:[],collectionData:"{}",defaultProps:{children:"children",label:"label"},IndexFormData:{collection:"",field:{},options:{name:"",unique:"",sparse:!1,expireAfterSeconds:0,expireAfterSecondsCheck:!1}},IndexFieldList:[],tableData:[],drawer:!1,drawerIndex:!1,darwerkey:"",jsonData:JSON.parse(mn),searchValue:"",isAdd:!0,activeIndex:0,activeName:"0",pageData:{page:1,total:0,size:10,sizes:[10,20,30,40,50,100]},authorityradio:{AclTag:"READONLY"},dialogShow:!1,drawerVisible:!1,dataMode:"imp",impExpData:{type:!1},tableJson:"{}",schemaUpdating:!1,schemaEditing:!1,schemaTimer:(new Date).getTime(),wordWrap:!1,batchVisible:!1,names:[],batchloading:!1}},computed:Object(o["a"])(Object(o["a"])({},Object(ce["b"])(["is_tcb","appid"])),{},{noFillIn:function(){var e=this.tableData.find((function(e){return"_id_"===e.name}));return!!(e&&1===this.tableData.length||this.tableData.length<=0)}}),watch:{spaceid:function(e){var t=this;this.activeIndex=0,this.dataBaseData=[],this.tableData=[],this.pageData={page:1,total:0,size:10,sizes:[10,20,30,40,50,100]},e&&(this.getCollections(),this.$nextTick((function(){t.$refs.customValidate.refresh()})))}},created:function(){this._cacheDataBaseData=[],this.spaceid&&this.getCollections()},methods:{expireAfterSecondSwitch:function(e){e&&this.IndexFieldList.length>0&&(this.IndexFieldList=[this.IndexFieldList[0]])},selectable:function(e,t){return e.name},handleSelectionChange:function(e){var t=this;this.names=[],e.forEach((function(e){e.name&&t.names.push(e.name)}))},batchDel:function(){var e=this,t=this.$createElement,n=null;n=t("div",null,[t("div",{style:"display:flex; align-items: center;"},[t("span",{class:"el-icon-warning",style:"font-size:22px;color:#e6a23c;margin-right:10px;"},null),t("p",null,[t("span",null,"即将批量删除 "),t("span",{style:"color:#ff5a5f"},this.names.length),t("span",null," 个数据表"),t("br",null,null),t("span",null,"此操作将永久删除数据表，表内所有数据都会被删除且不可找回，请确认是否继续?")])])]),this.$msgbox({title:"提示",message:n,showCancelButton:!0,confirmButtonText:"确定删除",cancelButtonText:"取消",confirmButtonClass:"el-button--danger"}).then((function(t){e.getDatabaseDeleteCollectionBatch(e.names)}))},setWordWrap:function(){this.$refs.jsonEditor.setWordWrap()},wordWrapChange:function(e){this.wordWrap=e},tabclick:function(){this.$refs.jsonSchema.refresh(this.formData.collection)},drawrClose:function(){this.$refs.upload.closeDrawer()},uploadSuccess:function(e){var t=e.taskId,n=e.mode;this.$refs.upload.closeDrawer(),"imp"!==n?this.expLoopRefresh(t):this.loopRefresh(t)},fakeClick:function(e){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(t)},exportRaw:function(e,t){var n=window.URL||window.webkitURL||window,a=new Blob([t]),i=document.createElementNS("http://www.w3.org/1999/xhtml","a");i.href=n.createObjectURL(a),i.download=e,this.fakeClick(i)},expLoopRefresh:function(e){var t=this,n={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid,taskId:e};this.$api.Database_Query_Export_Status(n).then((function(n){var a=n.data,i=a.Status,s=a.DownloadUrl;t.impExpData=Object(o["a"])(Object(o["a"])({},n.data),{},{type:!0,mode:"exp"}),clearTimeout(t.timer),"WAITING"!==i&&"RUNNING"!==i?("SUCCESS"===i&&(window.location=s),t.timer=setTimeout((function(){Object.assign(t.impExpData,n.data,{type:!1,mode:"exp"})}),5e3)):t.timer=setTimeout((function(){t.expLoopRefresh(e)}),1500)})).catch((function(e){}))},loopRefresh:function(e){var t=this,n={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid,taskId:e};this.$api.Database_Query_Import_Status(n).then((function(n){var a=n.data;t.impExpData=Object(o["a"])(Object(o["a"])({},a),{},{type:!0,mode:"imp"}),clearTimeout(t.timer),!a||"WAITING"!==a.Status&&"NEW"!==a.Status&&"RUNNING"!==a.Status?(t.updateTable(),t.timer=setTimeout((function(){Object.assign(t.impExpData,a,{type:!1,mode:"imp"})}),3e3)):t.timer=setTimeout((function(){t.loopRefresh(e)}),1500)}))},dataImport:function(){this.dataMode="imp",this.drawerVisible=!0},dataExport:function(){this.dataMode="exp",this.drawerVisible=!0},safety:function(){this.authorityradio.AclTag="",this.$refs.safety.open()},handleSubmit:function(){this.getDatabaseModifySafeRule()},handleSizeChange:function(e){this.pageData.size=e,this.pageData.page=1,this.getCollectionData(this.formData.collection,this.filter||"")},handleCurrentChange:function(e){this.pageData.page=e,this.getCollectionData(this.formData.collection,this.filter||"")},navChange:function(e){var t=e.detail,n=e.index;this.pageData.page=1,this.activeIndex=n,this.dataBaseData=[],this.tableData=[],this.getContent(t.name),this.$refs.jsonSchema.refresh(this.formData.collection)},refresh:function(){this.getCollections()},addTable:function(){this.$refs.addTableDialog.open()},addTableByName:function(e){var t=this;if(e){var n=/^[a-zA-Z_]([a-zA-Z0-9-_]{0,30})$/g;if(n.test(e)){var a=this.navList.findIndex((function(t){return t.name===e}));-1===a?(this.formData.name=e,this.loading=!0,this.$refs.addTableDialog.close(!1),this.$api.Database_Create_Collection(this.formData).then((function(n){t.getCollections(e)}))):this.$alert("数据表名重复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})}else this.$alert("只允许字母、数字、_ 和 -，且必须以字母或下划线打头且长度不超过30个字符","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})}else this.$alert("数据表名不能为空","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})},updateTable:function(){this.getContent(this.navList[this.activeIndex].name)},rename:function(e){var t=this;this.$prompt("数据表名称","新建数据表",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:e.detail.name||"",inputValidator:function(n){if(!n)return"数据表名不能为空";var a=/^[a-zA-Z_]([a-zA-Z0-9-_]{0,30})$/g;if(!a.test(n))return"只允许字母、数字、_ 和 -，且必须以字母或下划线打头且长度不超过30个字符";var i=t.navList.findIndex((function(e){return e.name===n}));return-1!==i&&e.index!==i?"数据表名重复":void 0}}).then((function(n){var a=n.value,i=t.navList.findIndex((function(e){return e.name===a}));if(e.index!==i){t.formData.name=a;var o={provider:t.formData.provider,spaceId:t.formData.spaceId,appid:t.appid,collectionInfo:JSON.stringify([{OldTableName:e.detail.name,NewTableName:a}])};t.loading=!0,t.$api.Database_Rename_Collection(o).then((function(e){t.getCollections(a)}))}})).catch((function(){}))},del:function(e){var t=this;this.$confirm("该数据表将被删除，删除后该表内所有数据都会被删除且不可找回， 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.getDatabaseDeleteCollection(e.detail.name,e.index)}))},add:function(){this.collectionDataID="",this.collectionData={},this.drawer=!0,this.isAdd=!0},addIndexDrawer:function(){this.drawerIndex=!0,this.IndexFormData.field={},this.IndexFormData.options={name:"",unique:"",sparse:!1,expireAfterSeconds:0,expireAfterSecondsCheck:!1},this.IndexFieldList=[]},updateIndex:function(){this.getDatabaseRunCommandLists(this.navList[this.activeIndex].name)},addIndex:function(){this.IndexFieldList.push({value:"",name:"1"})},delIndex:function(e,t){this.IndexFieldList.splice(e,1)},delIndexData:function(e){var t=this;this.$confirm("此操作将永久删除名称为 ".concat(e.name," 的索引, 是否继续?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.getDatabaseRunCommandDelete(t.formData.collection,e.name)}))},confirmIndex:function(){var e={};this.IndexFieldList.forEach((function(t){e[t.value]=t.name})),this.IndexFormData.field=e;var t=this.IndexFormData;if(""!==t.options.name)if(""!==t.options.unique)if(t.options.expireAfterSecondsCheck&&""===t.options.expireAfterSeconds)this.$alert("请设置过期时间","警告",{confirmButtonText:"确定",type:"error",callback:function(){}});else if(0!==this.IndexFieldList.length){for(var n=!1,a=0;a<this.IndexFieldList.length;a++){var i=this.IndexFieldList[a];if(""===i.value){this.$alert("索引字段不能为空","警告",{confirmButtonText:"确定",type:"error",callback:function(){}}),n=!0;break}if(""===i.name){this.$alert("请选择升序或降序","警告",{confirmButtonText:"确定",type:"error",callback:function(){}}),n=!0;break}}n||this.getDatabaseRunCommandCreate()}else this.$alert("索引字段不能为空","警告",{confirmButtonText:"确定",type:"error",callback:function(){}});else this.$alert("索引属性不能为空","警告",{confirmButtonText:"确定",type:"error",callback:function(){}});else this.$alert("索引名称不能为空","警告",{confirmButtonText:"确定",type:"error",callback:function(){}})},handleClose:function(e){e()},drawerClose:function(){this.$refs.drawer.closeDrawer(),this.$refs.drawerIndex.closeDrawer()},changed:function(e){},confirm:function(){try{var e=JSON.parse(this.getValue()),t=Object(H["d"])(e);if(0===t.length)return void this.$alert("您当前没有输入任何内容，请确认后重试","警告",{confirmButtonText:"确定",type:"error",callback:function(){}});if(Object(re["isArray"])(e))return void this.$alert("只能创建一条数据，最外层不能为数组","警告",{confirmButtonText:"确定",type:"error",callback:function(){}});this.collectionDataID?this.getDatabaseUpdate(this.getValue(),JSON.stringify({_id:this.collectionDataID})):this.getDatabaseInsert(this.getValue())}catch(n){this.$alert("您输入的代码有误，请检查","警告",{confirmButtonText:"确定",type:"error",callback:function(){}})}},manage:function(e,t){this.isAdd=!1,this.collectionData=JSON.parse(JSON.stringify(e)),this.collectionDataID=this.collectionData["_id"],delete this.collectionData["_id"],this.drawer=!0,this.darwerkey=(new Date).getTime()},deleteData:function(e,t){this.getDatabaseDelete({_id:e._id})},serachChange:function(e){if(""!==this.searchValue){var t=this.searchValue.split(":");try{var n=JSON.parse("{".concat(t[0],":").concat(t[1],"}"));this.getDatabaseFind(n)}catch(a){this.$alert('您输入的格式有误，格式为 "fileid": "value"，注意字段需要使用英文双引号包裹，请检查后重试',"提示",{confirmButtonText:"确定",type:"warning",callback:function(){}})}}else this.getDatabaseFind("")},getCollections:function(e,t){var n=this;this.loading=!0,this.formData.spaceId=this.spaceid,this.$api.Database_Collections(this.formData).then((function(a){var i=a.data.collections;n.navList=i,n.$nextTick((function(){n.loading=!1,t&&n.$message({type:"success",message:"删除数据表成功!"}),i&&i.length>0&&n.$nextTick((function(){if(e){var t=n.navList.findIndex((function(t){return t.name===e}));n.activeIndex=t}n.IndexFormData.collection=n.navList[n.activeIndex].name;var a=n.navList[n.activeIndex].name,o=n.$refs.nav.$refs[a][0];o&&(n.$refs.scrollView.scrollTop=o.offsetTop),n.getContent(i[n.activeIndex].name),n.$refs.jsonSchema&&n.$refs.jsonSchema.refresh(n.formData.collection)}))}))})).catch((function(){n.loading=!1}))},getContent:function(e){this.getCollectionData(e),this.getDatabaseRunCommandLists(e),this.is_tcb&&this.getDatabaseSafeRule(e)},getCollectionData:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2?arguments[2]:void 0;this.databaseLoading=!0,this.formData.collection=e,this.IndexFormData.collection=e;var i={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid,collection:e,filter:n,pageSize:this.pageData.size,page:this.pageData.page},o=this.activeIndex;this.$api.Database_Find(i).then((function(e){if(o===t.activeIndex){var n=e.data,i=n.data,s=n.total;t.pageData.total=s,t.dataBaseData=i,t.$nextTick((function(){"del"===a&&t.$message({type:"success",message:"删除记录成功!"}),"update"===a&&t.$message({message:"修改记录成功",type:"success"}),"inster"===a&&t.$message({message:"添加记录成功",type:"success"}),t.databaseLoading=!1}))}})).catch((function(){t.databaseLoading=!1}))},getCollectionDataTotal:function(e){var t=this;this.pageData.page=1;var n={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid,body:{command:"count",collection:e,query:{}}};this.$api.Database_Run_Command(n).then((function(n){var a=n.data.Result,i=JSON.parse(a);t.pageData.total=i,t.getCollectionData(e)}))},getDatabaseInsert:function(e){var t=this;this.databaseLoading=!0;var n=Object(o["a"])(Object(o["a"])({},this.formData),{},{doc:e});this.$api.Database_Insert(n).then((function(e){t.getCollectionData(n.collection,"","inster"),t.drawer=!1})).catch((function(){t.databaseLoading=!1}))},getDatabaseUpdate:function(e,t){var n=this;this.databaseLoading=!0;var a=Object(o["a"])(Object(o["a"])({},this.formData),{},{doc:e,filter:t});this.$api.Database_Update(a).then((function(e){n.drawer=!1,n.getCollectionData(a.collection,"","update")})).catch((function(){n.databaseLoading=!1}))},getDatabaseDelete:function(e){var t=this;this.databaseLoading=!0;var n={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid,collection:this.IndexFormData.collection,filter:e};this.$api.Database_Delete(n).then((function(e){t.getCollectionData(n.collection,"","del")})).catch((function(){t.databaseLoading=!1}))},getDatabaseFind:function(e){this.filter=e,this.pageData.page=1,this.getCollectionData(this.formData.collection,e)},getDatabaseDeleteCollection:function(e,t){var n=this,a=Object(o["a"])(Object(o["a"])({},this.formData),{},{name:e});delete a.collection,this.loading=!0,this.$api.Database_Delete_Collection(a).then((function(e){var a="";n.activeIndex===t?n.activeIndex=0:a=n.formData.collection,n.$refs.table&&n.$refs.table.clearSelection(),n.getCollections(a,!0)}))},getDatabaseRunCommandCreate:function(){var e=this,t={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid,collection:this.IndexFormData.collection,name:this.IndexFormData.options.name,unique:this.IndexFormData.options.unique,sparse:this.IndexFormData.options.sparse,field:this.IndexFormData.field};this.IndexFormData.options.expireAfterSecondsCheck&&(t.expireAfterSeconds=this.IndexFormData.options.expireAfterSeconds),this.databaseIndexLoading=!0,this.$api.Database_Create_Index(t).then((function(t){e.$message({message:"添加索引成功",type:"success"}),e.getDatabaseRunCommandLists(e.formData.collection),e.databaseIndexLoading=!1,e.drawerIndex=!1})).catch((function(){e.databaseIndexLoading=!1}))},getDatabaseRunCommandLists:function(e){var t=this;this.IndexFormData.collection=e;var n={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid,collection:e};this.databaseIndexLoading=!0;var a=this.activeIndex;this.$api.Database_List_Index(n).then((function(e){if(a===t.activeIndex){var n=e.data.indexes;t.tableData=n,t.databaseIndexLoading=!1}})).catch((function(){t.databaseIndexLoading=!1}))},getDatabaseRunCommandDelete:function(e,t){var n=this,a={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid,collection:e,name:t};this.databaseIndexLoading=!0,this.$api.Database_Delete_Index(a).then((function(t){n.getDatabaseRunCommandLists(e)})).catch((function(){n.databaseIndexLoading=!1}))},getDatabaseSafeRule:function(e){var t=this,n={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid,collection:e};this.$api.Database_Safe_Rule(n).then((function(e){var n=e.data;t.authorityradio=n}))},getDatabaseModifySafeRule:function(){var e=this,t={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid,collection:this.formData.collection,aclTag:this.authorityradio.AclTag};this.$api.Database_Modify_Safe_Rule(t).then((function(t){e.$message({message:"权限更新成功",type:"success"})}))},getDatabaseDeleteCollectionBatch:function(e){var t=this,n={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid,names:e};this.batchloading=!0,this.$api.Database_Delete_Collection_Batch(n).then((function(e){t.$refs.table.clearSelection(),t.batchloading=!1,t.batchVisible=!1,t.getCollections()})).catch((function(){t.batchloading=!1}))},getValue:function(){return this.$refs.jsonEditor.getStringValue()},format:function(){try{this.$refs.jsonEditor.format()}catch(e){this.$alert("您输入的代码有误，不能格式化，请检查代码","警告",{confirmButtonText:"确定",type:"error",callback:function(){}})}},fullScreen:function(){this.$refs.jsonEditor.fullScreen()}}},bn=vn,gn=(n("e4e9"),Object(u["a"])(bn,a,i,!1,null,"3e390fa7",null));t["default"]=gn.exports},7103:function(e,t,n){},7233:function(e,t,n){"use strict";n("98f0")},"793c":function(e,t,n){},"7cba":function(e,t,n){"use strict";n("08c7")},"821e":function(e,t,n){},"98f0":function(e,t,n){},"9eaa":function(e,t,n){},"9f72":function(e,t,n){},a2a8:function(e,t){e.exports={load:function(e,t){if(e||(e="/editor/min"),window.monaco)t();else{var n={paths:{vs:e+"/vs","vs/nls":{availableLanguages:{"*":"zh-cn"}}}},a="".concat(n.paths.vs,"/loader.js"),i=function(){if(window.LOADER_PENDING&&window.require.config(n),window.require(["vs/editor/editor.main"],(function(){t()})),window.LOADER_PENDING){window.LOADER_PENDING=!1;var e=window.LOADER_CALLBACKS;if(e&&e.length){var a=e.shift();while(a)a.fn.call(a.window),a=e.shift()}}};if(window.LOADER_PENDING)window.LOADER_CALLBACKS=window.LOADER_CALLBACKS||[],window.LOADER_CALLBACKS.push({window:this,fn:i});else if("undefined"===typeof window.require){var o=window.document.createElement("script");o.type="text/javascript",o.src=a,o.addEventListener("load",i),window.document.body.appendChild(o),window.LOADER_PENDING=!0}else i()}}}},c0eb:function(e,t,n){"use strict";n("9f72")},c9ad:function(e,t,n){"use strict";n("1451")},d369:function(e,t,n){"use strict";n("7103")},dac8:function(e,t,n){"use strict";n("9eaa")},db99:function(e,t,n){},e4e9:function(e,t,n){"use strict";n("db99")},ed08:function(e,t,n){"use strict";n.d(t,"e",(function(){return s})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return l})),n.d(t,"d",(function(){return c})),n.d(t,"b",(function(){return d}));n("28a5"),n("3835"),n("f5766"),n("a481"),n("6b54");var a=n("53ca"),i=n("61f7"),o=n("3751");function s(e,t){if(0===arguments.length)return null;var n,i=t||"{y}-{m}-{d} {h}:{i}:{s}";"object"===Object(a["a"])(e)?n=e:("string"===typeof e&&/^[0-9]+$/.test(e)&&(e=parseInt(e)),"number"===typeof e&&10===e.toString().length&&(e*=1e3),n=new Date(e));var o={y:n.getFullYear(),m:n.getMonth()+1,d:n.getDate(),h:n.getHours(),i:n.getMinutes(),s:n.getSeconds(),a:n.getDay()},s=i.replace(/{([ymdhisa])+}/g,(function(e,t){var n=o[t];return"a"===t?["日","一","二","三","四","五","六"][n]:n.toString().padStart(2,"0")}));return s}function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"time";"object"!==Object(a["a"])(e)&&(e=e.replace(/-/g,"/"));var i=new Date(e);switch(n){case"time":i.setHours(i.getHours()+t);break;case"day":i.setDate(i.getDate()+t);break;case"month":i.setMonth(i.getMonth()+t);break;case"year":i.setFullYear(i.getFullYear()+t);break}var o=i.getFullYear(),s=i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1,r=i.getDate()<10?"0"+i.getDate():i.getDate(),l=i.getHours()<10?"0"+i.getHours():i.getHours(),c=i.getMinutes()<10?"0"+i.getMinutes():i.getMinutes(),d=i.getSeconds()<10?"0"+i.getSeconds():i.getSeconds();return"time"===n?o+"-"+s+"-"+r+" "+l+":"+c+":"+d:o+"/"+s+"/"+r}function l(e,t){return e=new Date(e.replace("-","/").replace("-","/")),t=new Date(t.replace("-","/").replace("-","/")),e<=t}function c(e){var t=[];for(var n in e){var a=Object(i["a"])(e[n])||Object(o["a"])(e[n]),s={label:n,value:a?JSON.stringify(e[n]):e[n]};a&&(s.children=c(e[n])),t.push(s)}return t}function d(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(){var i=this,o=arguments;if(t&&clearTimeout(t),a){var s=!t;t=setTimeout((function(){t=null}),n),s&&e.apply(i,o)}else t=setTimeout((function(){e.apply(i,o)}),n)}}}}]);
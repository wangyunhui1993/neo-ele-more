(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-093d645a"],{6310:function(t,a,e){},d350:function(t,a,e){"use strict";e("6310")},d9b9:function(t,a,e){"use strict";var i=e("5530"),s=e("2f62");a["a"]={data:function(){return{formData:{appid:"",provider:""}}},watch:{appid:function(t){this.formData.appid=t},spaceid:function(t){this.formData.spaceId=t,this.value=t},is_tcb:function(t){this.formData.provider=t?"tcb":"aliyun"}},created:function(){this.spaceid?(this.formData.appid=this.appid,this.formData.spaceId=this.spaceid,this.formData.provider=this.is_tcb?"tcb":"aliyun"):this.$router.push({path:"/"})},computed:Object(i["a"])({},Object(s["b"])(["appid","is_tcb","spaceid","spaceval"])),methods:{}}},fa58:function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("Card",{attrs:{padding:"0px"}},[e("div",{staticClass:"function-header",attrs:{slot:"header"},slot:"header"},[e("el-button",{attrs:{disabled:t.loading,type:"primary",size:"mini"},on:{click:t.open}},[t._v("新建回档")]),t._v(" "),e("el-button",{attrs:{loading:t.loading,size:"mini"},on:{click:t.reload}},[t._v("刷新")])],1),t._v(" "),e("div",[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.taskLists,stripe:""}},[e("el-table-column",{attrs:{type:"expand",width:"50px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"table-retreated"},[e("div",{staticClass:"table-retreated-box header"},[e("div",{staticClass:"table-retreated-item"},[t._v("待回档集合")]),t._v(" "),e("div",{staticClass:"table-retreated-item"},[t._v("回档后集合")])]),t._v(" "),t._l(a.row.collections,(function(a,i){return e("div",{key:i,staticClass:"table-retreated-box"},[e("div",{staticClass:"table-retreated-item"},[t._v(t._s(a.OldTableName))]),t._v(" "),e("div",{staticClass:"table-retreated-item"},[t._v(t._s(a.NewTableName))])])}))],2)]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"createTime",label:"回档时间",align:"center"}}),t._v(" "),e("el-table-column",{attrs:{prop:"restoreTime",label:"创建时间",align:"center"}}),t._v(" "),e("el-table-column",{attrs:{prop:"status",label:"回档状态",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[0===a.row.status?e("span",[t._v("待执行")]):t._e(),t._v(" "),1===a.row.status?e("span",[t._v("运行中")]):t._e(),t._v(" "),2===a.row.status?e("span",[t._v("已完成")]):t._e(),t._v(" "),3===a.row.status?e("span",{staticStyle:{color:"red"}},[t._v("失败")]):t._e()]}}])})],1)],1)]),t._v(" "),e("el-dialog",{attrs:{title:"新建回档任务",visible:t.dialogVisible,width:"750px"},on:{"update:visible":function(a){t.dialogVisible=a}}},[e("el-form",{attrs:{model:t.formData,"label-width":"80px"}},[e("el-form-item",{attrs:{label:"回档时间"}},[e("el-col",{attrs:{span:11}},[e("el-select",{attrs:{placeholder:"请选择可回档时间"},on:{change:t.timeChange},model:{value:t.dataValue,callback:function(a){t.dataValue=a},expression:"dataValue"}},t._l(t.dateLists,(function(t){return e("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1)],1),t._v(" "),e("el-form-item",{attrs:{label:"回档集合"}},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tabelLoading,expression:"tabelLoading"}],staticClass:"dialog-table",attrs:{data:t.collections,stripe:""},on:{select:t.select,"select-all":t.selectAll}},[e("el-table-column",{attrs:{type:"selection",width:"50"}}),t._v(" "),e("el-table-column",{attrs:{prop:"OldTableName",label:"可回档集合",align:"left"}}),t._v(" "),e("el-table-column",{attrs:{prop:"name",label:"回档后集合",align:"left"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-input",{attrs:{size:"mini"},model:{value:a.row.NewTableName,callback:function(e){t.$set(a.row,"NewTableName",e)},expression:"scope.row.NewTableName"}}),t._v(" "),t.colVal(a.row.NewTableName)?e("p",{staticClass:"dialog-text"},[t._v("集合名已存在")]):t._e()]}}])})],1)],1)],1),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(a){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),e("el-button",{attrs:{type:"primary",disabled:t.isEdit||0===t.formData.collections.length,loading:t.submitLoading},on:{click:t.submit}},[t._v("确 定")])],1)],1)],1)},s=[],o=(e("7f7f"),e("20d6"),e("ac6a"),e("d9b9")),l={mixins:[o["a"]],data:function(){return{dialogVisible:!1,tabelLoading:!1,submitLoading:!1,formData:{collections:[]},time:"",dataValue:[],dateLists:[],tableData:[],collections:[],collectionsData:[],taskLists:[],loading:!1,aliBackupIds:[]}},computed:{isEdit:function(){var t=this,a=!1;return this.formData.collections.forEach((function(e){-1===t.collectionsData.indexOf(e.NewTableName)||(a=!0)})),a}},created:function(){this.getCollections(),this.getDatabaseListRestoreTask(),this.getDatabaseListRestoreTime()},methods:{reload:function(){this.getDatabaseListRestoreTask()},colVal:function(t){return-1!==this.collectionsData.indexOf(t)},select:function(t){this.formData.collections=t},selectAll:function(t){this.formData.collections=t},timeChange:function(t){this.time=t,this.getDatabaseListRestoreCollections(t)},open:function(){this.dialogVisible=!0},submit:function(){this.formData.collections.length<=0?this.$alert("请选择要回档的合集","提示",{confirmButtonText:"知道了",type:"warning",showClose:!1}):this.getDatabaseRestoreCollection()},getDatabaseRestoreCollection:function(){var t=this,a={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid,time:this.time,collectionInfo:JSON.stringify(this.formData.collections)};if(this.aliBackupIds.length>0){var e=this.dateLists.findIndex((function(a){return a===t.time}));a.backupId=this.aliBackupIds[e]}this.submitLoading=!0,this.$api.Database_Restore_Collection(a).then((function(a){t.$message({message:"回档成功",type:"success",duration:1500}),t.submitLoading=!1,t.dialogVisible=!1,t.getDatabaseListRestoreTask()})).catch((function(){t.submitLoading=!1}))},getDatabaseListRestoreTime:function(){var t=this;this.$api.Database_List_Restore_Time(this.formData).then((function(a){t.dateLists=a.data.times,a.data.backupIds&&(t.aliBackupIds=a.data.backupIds)}))},getDatabaseListRestoreCollections:function(t){var a=this,e={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid,time:t};if(this.aliBackupIds.length>0){var i=this.dateLists.findIndex((function(a){return a===t}));e.backupId=this.aliBackupIds[i]}this.tabelLoading=!0,this.$api.Database_List_Restore_Collections(e).then((function(t){var e=t.data.collections;a.collections=[],e.forEach((function(t){a.collections.push({OldTableName:t,NewTableName:t+"_bak"})})),a.tabelLoading=!1})).catch((function(){a.tabelLoading=!1}))},getDatabaseListRestoreTask:function(){var t=this,a={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid};this.loading=!0,this.$api.Database_List_Restore_Task(a).then((function(a){var e=a.data.tasks;t.taskLists=e,t.loading=!1})).catch((function(){t.loading=!1}))},getCollections:function(){var t=this,a={provider:this.formData.provider,spaceId:this.formData.spaceId,appid:this.formData.appid};this.$api.Database_Collections(a).then((function(a){var e=a.data.collections;e.forEach((function(a){t.collectionsData.push(a.name)}))}))}}},n=l,c=(e("d350"),e("2877")),r=Object(c["a"])(n,i,s,!1,null,"64e42f47",null);a["default"]=r.exports}}]);